var Elements,Utils,__extends=this&&this.__extends||function(){var a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,t){a.__proto__=t}||function(a,t){for(var e in t)t.hasOwnProperty(e)&&(a[e]=t[e])})(t,e)};return function(t,e){function i(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();!function(a){var t=function(){function a(a,t,e,i,s,h){void 0===h&&(h=!0),this.oAssetData={},this.assetsLoaded=0,this.textData={},this.scale=1,this.frameInc=0,this.fps=15,this.curFrame=0,this.totalAssets=t.length,this.showBar=h;for(var o=0;o<t.length;o++)-1!=t[o].file.indexOf(".json")?this.loadJSON(t[o]):this.loadImage(t[o]);h&&(this.oLoaderImgData=preAssetLib.getData("loader"))}return a.prototype.render=function(){ctx.fillStyle="#000000",ctx.fillRect(0,0,canvas.width,canvas.height);var a=Math.min(Math.min(canvas.width/900,1),canvas.height/800),t=this.oLoaderImgData.oData.oAtlasData[oImageIds.logo].x,e=this.oLoaderImgData.oData.oAtlasData[oImageIds.logo].y,i=this.oLoaderImgData.oData.oAtlasData[oImageIds.logo].width,s=this.oLoaderImgData.oData.oAtlasData[oImageIds.logo].height;ctx.drawImage(this.oLoaderImgData.img,t,e,i,s,canvas.width/2-i/2*a,canvas.height/2-70-s/2*a,i*a,s*a);t=this.oLoaderImgData.oData.oAtlasData[oImageIds.underBar].x,e=this.oLoaderImgData.oData.oAtlasData[oImageIds.underBar].y,i=this.oLoaderImgData.oData.oAtlasData[oImageIds.underBar].width,s=this.oLoaderImgData.oData.oAtlasData[oImageIds.underBar].height;ctx.drawImage(this.oLoaderImgData.img,t,e,Math.max(i/this.totalAssets*this.assetsLoaded,1),s,canvas.width/2-i/2*a,canvas.height/2+140-s/2*a,Math.max(i/this.totalAssets*this.assetsLoaded,1)*a,s*a);t=this.oLoaderImgData.oData.oAtlasData[oImageIds.overBar].x,e=this.oLoaderImgData.oData.oAtlasData[oImageIds.overBar].y,i=this.oLoaderImgData.oData.oAtlasData[oImageIds.overBar].width,s=this.oLoaderImgData.oData.oAtlasData[oImageIds.overBar].height;ctx.drawImage(this.oLoaderImgData.img,t,e,i,s,canvas.width/2-i/2*a,canvas.height/2+140-s/2*a,i*a,s*a)},a.prototype.displayNumbers=function(){ctx.textAlign="left",ctx.font="bold 40px arial",ctx.fillStyle="#ffffff",ctx.fillText(Math.round(this.assetsLoaded/this.totalAssets*100)+"%",canvas.width/2+0,canvas.height/2+51)},a.prototype.loadExtraAssets=function(a,t){this.showBar=!1,this.totalAssets=t.length,this.assetsLoaded=0,this.loadedCallback=a;for(var e=0;e<t.length;e++)-1!=t[e].file.indexOf(".json")?this.loadJSON(t[e]):this.loadImage(t[e])},a.prototype.loadJSON=function(a){var t=this,e=new XMLHttpRequest;e.open("GET",a.file,!0),e.onreadystatechange=function(){4==e.readyState&&200==e.status&&(t.textData[a.id]=JSON.parse(e.responseText),++t.assetsLoaded,t.checkLoadComplete())},e.send(null)},a.prototype.loadImage=function(a){var t=this,e=new Image;e.onload=function(){t.oAssetData[a.id]={},t.oAssetData[a.id].img=e,t.oAssetData[a.id].oData={};var i=t.getSpriteSize(a.file);0!=i[0]?(t.oAssetData[a.id].oData.spriteWidth=i[0],t.oAssetData[a.id].oData.spriteHeight=i[1]):(t.oAssetData[a.id].oData.spriteWidth=t.oAssetData[a.id].img.width,t.oAssetData[a.id].oData.spriteHeight=t.oAssetData[a.id].img.height),a.oAnims&&(t.oAssetData[a.id].oData.oAnims=a.oAnims),a.oAtlasData?t.oAssetData[a.id].oData.oAtlasData=a.oAtlasData:t.oAssetData[a.id].oData.oAtlasData={none:{x:0,y:0,width:t.oAssetData[a.id].oData.spriteWidth,height:t.oAssetData[a.id].oData.spriteHeight}},++t.assetsLoaded,t.checkLoadComplete()},e.src=a.file},a.prototype.getSpriteSize=function(a){for(var t=new Array,e="",i="",s=0,h=a.lastIndexOf("."),o=!0;o;)h--,0==s&&this.isNumber(a.charAt(h))?e=a.charAt(h)+e:0==s&&e.length>0&&"x"==a.charAt(h)?(h--,s=1,i=a.charAt(h)+i):1==s&&this.isNumber(a.charAt(h))?i=a.charAt(h)+i:1==s&&i.length>0&&"_"==a.charAt(h)?(o=!1,t=[parseInt(i),parseInt(e)]):(o=!1,t=[0,0]);return t},a.prototype.isNumber=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},a.prototype.checkLoadComplete=function(){this.assetsLoaded==this.totalAssets&&this.loadedCallback()},a.prototype.onReady=function(a){this.loadedCallback=a},a.prototype.getImg=function(a){return this.oAssetData[a].img},a.prototype.getData=function(a){return this.oAssetData[a]},a}();a.AssetLoader=t}(Utils||(Utils={})),function(a){var t=function(){function a(a,t,e,i){this.x=0,this.y=0,this.rotation=0,this.radius=10,this.removeMe=!1,this.frameInc=0,this.animType="loop",this.offsetX=0,this.offsetY=0,this.scaleX=1,this.scaleY=1,this.alpha=1,this.oImgData=a,this.oAnims=this.oImgData.oData.oAnims,this.fps=t,this.radius=e,this.animId=i,this.centreX=Math.round(this.oImgData.oData.spriteWidth/2),this.centreY=Math.round(this.oImgData.oData.spriteHeight/2)}return a.prototype.updateAnimation=function(a){this.frameInc+=this.fps*a},a.prototype.changeImgData=function(a,t){this.oImgData=a,this.oAnims=this.oImgData.oData.oAnims,this.animId=t,this.centreX=Math.round(this.oImgData.oData.spriteWidth/2),this.centreY=Math.round(this.oImgData.oData.spriteHeight/2),this.resetAnim()},a.prototype.resetAnim=function(){this.frameInc=0},a.prototype.setFrame=function(a){this.fixedFrame=a},a.prototype.setAnimType=function(a,t,e){switch(void 0===e&&(e=!0),this.animId=t,this.animType=a,e&&this.resetAnim(),a){case"loop":break;case"once":this.maxIdx=this.oAnims[this.animId].length-1}},a.prototype.render=function(a){if(a.save(),a.translate(this.x,this.y),a.rotate(this.rotation),a.scale(this.scaleX,this.scaleY),a.globalAlpha=this.alpha,null!=this.animId){var t=this.oAnims[this.animId].length,e=Math.floor(this.frameInc);this.curFrame=this.oAnims[this.animId][e%t];var i=this.curFrame*this.oImgData.oData.spriteWidth%this.oImgData.img.width,s=Math.floor(this.curFrame/(this.oImgData.img.width/this.oImgData.oData.spriteWidth))*this.oImgData.oData.spriteHeight;if("once"==this.animType&&e>this.maxIdx){this.fixedFrame=this.oAnims[this.animId][t-1],this.animId=null,null!=this.animEndedFunc&&this.animEndedFunc();i=this.fixedFrame*this.oImgData.oData.spriteWidth%this.oImgData.img.width,s=Math.floor(this.fixedFrame/(this.oImgData.img.width/this.oImgData.oData.spriteWidth))*this.oImgData.oData.spriteHeight}}else i=this.fixedFrame*this.oImgData.oData.spriteWidth%this.oImgData.img.width,s=Math.floor(this.fixedFrame/(this.oImgData.img.width/this.oImgData.oData.spriteWidth))*this.oImgData.oData.spriteHeight;a.drawImage(this.oImgData.img,i,s,this.oImgData.oData.spriteWidth,this.oImgData.oData.spriteHeight,-this.centreX+this.offsetX,-this.centreY+this.offsetY,this.oImgData.oData.spriteWidth,this.oImgData.oData.spriteHeight),a.restore()},a.prototype.renderSimple=function(a){if(null!=this.animId){var t=this.oAnims[this.animId].length,e=Math.floor(this.frameInc);this.curFrame=this.oAnims[this.animId][e%t];var i=this.curFrame*this.oImgData.oData.spriteWidth%this.oImgData.img.width,s=Math.floor(this.curFrame/(this.oImgData.img.width/this.oImgData.oData.spriteWidth))*this.oImgData.oData.spriteHeight;if("once"==this.animType&&e>this.maxIdx){this.fixedFrame=this.oAnims[this.animId][t-1],this.animId=null,null!=this.animEndedFunc&&this.animEndedFunc();i=this.fixedFrame*this.oImgData.oData.spriteWidth%this.oImgData.img.width,s=Math.floor(this.fixedFrame/(this.oImgData.img.width/this.oImgData.oData.spriteWidth))*this.oImgData.oData.spriteHeight}}else i=this.fixedFrame*this.oImgData.oData.spriteWidth%this.oImgData.img.width,s=Math.floor(this.fixedFrame/(this.oImgData.img.width/this.oImgData.oData.spriteWidth))*this.oImgData.oData.spriteHeight;a.drawImage(this.oImgData.img,i,s,this.oImgData.oData.spriteWidth,this.oImgData.oData.spriteHeight,this.x-(this.centreX-this.offsetX)*this.scaleX,this.y-(this.centreY-this.offsetY)*this.scaleY,this.oImgData.oData.spriteWidth*this.scaleX,this.oImgData.oData.spriteHeight*this.scaleY)},a}();a.AnimSprite=t}(Utils||(Utils={})),function(a){var t=function(){function a(a,t,e){void 0===e&&(e=0),this.x=0,this.y=0,this.rotation=0,this.radius=10,this.removeMe=!1,this.offsetX=0,this.offsetY=0,this.scaleX=1,this.scaleY=1,this.oImgData=a,this.radius=t,this.setFrame(e)}return a.prototype.setFrame=function(a){this.frameNum=a},a.prototype.render=function(a){a.save(),a.translate(this.x,this.y),a.rotate(this.rotation),a.scale(this.scaleX,this.scaleY);var t=this.frameNum*this.oImgData.oData.spriteWidth%this.oImgData.img.width,e=Math.floor(this.frameNum/(this.oImgData.img.width/this.oImgData.oData.spriteWidth))*this.oImgData.oData.spriteHeight;a.drawImage(this.oImgData.img,t,e,this.oImgData.oData.spriteWidth,this.oImgData.oData.spriteHeight,-this.oImgData.oData.spriteWidth/2+this.offsetX,-this.oImgData.oData.spriteHeight/2+this.offsetY,this.oImgData.oData.spriteWidth,this.oImgData.oData.spriteHeight),a.restore()},a}();a.BasicSprite=t}(Utils||(Utils={})),function(a){var t=function(){function a(a,t){var e=this;this.prevHitTime=0,this.pauseIsOn=!1,this.isDown=!1,this.allowClick=!1,this.isBugBrowser=t,this.keyDownEvtFunc=function(a){e.keyDown(a)},this.keyUpEvtFunc=function(a){e.keyUp(a)},a.addEventListener("contextmenu",function(a){return a.preventDefault()}),a.addEventListener("click",function(a){e.allowClick&&(butEventHandler("copyLinkFromGameEnd1",null),e.allowClick=!1)}),a.addEventListener("touchstart",function(a){for(var t=0;t<a.changedTouches.length;t++)e.hitDown(a,a.changedTouches[t].pageX,a.changedTouches[t].pageY,a.changedTouches[t].identifier)},!1),a.addEventListener("touchend",function(a){if(!e.allowClick)for(var t=0;t<a.changedTouches.length;t++)e.hitUp(a,a.changedTouches[t].pageX,a.changedTouches[t].pageY,a.changedTouches[t].identifier)},!1),a.addEventListener("touchcancel",function(a){if(!e.allowClick)for(var t=0;t<a.changedTouches.length;t++)e.hitCancel(a,a.changedTouches[t].pageX,a.changedTouches[t].pageY,a.changedTouches[t].identifier)},!1),a.addEventListener("touchmove",function(a){if(!e.allowClick)for(var t=0;t<a.changedTouches.length;t++)e.move(a,a.changedTouches[t].pageX,a.changedTouches[t].pageY,a.changedTouches[t].identifier,!0)},!1),a.addEventListener("mousedown",function(a){e.isDown=!0,e.hitDown(a,a.pageX,a.pageY,1)},!1),a.addEventListener("mouseup",function(a){e.isDown=!1,e.hitUp(a,a.pageX,a.pageY,1)},!1),a.addEventListener("mousemove",function(a){e.move(a,a.pageX,a.pageY,1,e.isDown)},!1),a.addEventListener("mouseout",function(a){2!=a.button&&(clearButtonOvers(),e.isDown=!1,e.hitCancel(a,Math.abs(a.pageX),Math.abs(a.pageY),1))},!1),this.aHitAreas=new Array,this.aKeys=new Array}return a.prototype.hitDown=function(a,t,e,i){if(hasFocus||visibleResume(),!this.pauseIsOn){var s=(new Date).getTime();t*=canvasScale,e*=canvasScale;for(var h=0;h<this.aHitAreas.length;h++)if(this.aHitAreas[h].rect){var o=canvas.width*this.aHitAreas[h].align[0],r=canvas.height*this.aHitAreas[h].align[1];if(t>o+this.aHitAreas[h].area[0]&&e>r+this.aHitAreas[h].area[1]&&t<o+this.aHitAreas[h].area[2]&&e<r+this.aHitAreas[h].area[3]){if(this.aHitAreas[h].aTouchIdentifiers.push(i),this.aHitAreas[h].oData.hasLeft=!1,!this.aHitAreas[h].oData.isDown){if(this.aHitAreas[h].oData.isDown=!0,this.aHitAreas[h].oData.x=t,this.aHitAreas[h].oData.y=e,s-this.prevHitTime<500&&("game"!=gameState||"pause"==this.aHitAreas[h].id)&&isBugBrowser)return;"copyLinkFromGameEnd1"==this.aHitAreas[h].id?this.allowClick=!0:this.aHitAreas[h].callback(this.aHitAreas[h].id,this.aHitAreas[h].oData)}break}}this.prevHitTime=s,this.allowClick||(a.preventDefault(),a.stopPropagation())}},a.prototype.hitUp=function(a,t,e,i){if(ios9FirstTouch||(playSound("silence"),ios9FirstTouch=!0),!this.pauseIsOn){a.preventDefault(),a.stopPropagation(),t*=canvasScale,e*=canvasScale;for(var s=0;s<this.aHitAreas.length;s++)if(this.aHitAreas[s].rect){var h=canvas.width*this.aHitAreas[s].align[0],o=canvas.height*this.aHitAreas[s].align[1];if(t>h+this.aHitAreas[s].area[0]&&e>o+this.aHitAreas[s].area[1]&&t<h+this.aHitAreas[s].area[2]&&e<o+this.aHitAreas[s].area[3]){for(var r=0;r<this.aHitAreas[s].aTouchIdentifiers.length;r++)this.aHitAreas[s].aTouchIdentifiers[r]==i&&(this.aHitAreas[s].aTouchIdentifiers.splice(r,1),r-=1);0==this.aHitAreas[s].aTouchIdentifiers.length&&(this.aHitAreas[s].oData.isDown=!1,this.aHitAreas[s].oData.multiTouch&&(this.aHitAreas[s].oData.x=t,this.aHitAreas[s].oData.y=e,this.aHitAreas[s].callback(this.aHitAreas[s].id,this.aHitAreas[s].oData)));break}}}},a.prototype.hitCancel=function(a,t,e,i){a.preventDefault(),a.stopPropagation(),t*=canvasScale,e*=canvasScale;for(var s=0;s<this.aHitAreas.length;s++)this.aHitAreas[s].oData.isDown&&(this.aHitAreas[s].oData.isDown=!1,this.aHitAreas[s].aTouchIdentifiers=new Array,this.aHitAreas[s].oData.multiTouch&&(this.aHitAreas[s].oData.x=t,this.aHitAreas[s].oData.y=e,this.aHitAreas[s].callback(this.aHitAreas[s].id,this.aHitAreas[s].oData)))},a.prototype.move=function(a,t,e,i,s){if(!this.pauseIsOn&&(t*=canvasScale,e*=canvasScale,this.mouseX=t,this.mouseY=e,s))for(var h=0;h<this.aHitAreas.length;h++)if(this.aHitAreas[h].rect){var o=canvas.width*this.aHitAreas[h].align[0],r=canvas.height*this.aHitAreas[h].align[1];if(t>o+this.aHitAreas[h].area[0]&&e>r+this.aHitAreas[h].area[1]&&t<o+this.aHitAreas[h].area[2]&&e<r+this.aHitAreas[h].area[3])this.aHitAreas[h].oData.hasLeft=!1,this.aHitAreas[h].oData.isDraggable&&!this.aHitAreas[h].oData.isDown&&(this.aHitAreas[h].oData.isDown=!0,this.aHitAreas[h].oData.isBeingDragged=!0,this.aHitAreas[h].oData.x=t,this.aHitAreas[h].oData.y=e,this.aHitAreas[h].aTouchIdentifiers.push(i),this.aHitAreas[h].oData.multiTouch&&this.aHitAreas[h].callback(this.aHitAreas[h].id,this.aHitAreas[h].oData)),this.aHitAreas[h].oData.isDraggable&&(this.aHitAreas[h].oData.isBeingDragged=!0,this.aHitAreas[h].oData.x=t,this.aHitAreas[h].oData.y=e,this.aHitAreas[h].callback(this.aHitAreas[h].id,this.aHitAreas[h].oData),this.aHitAreas[h]&&(this.aHitAreas[h].oData.isBeingDragged=!1));else if(this.aHitAreas[h].oData.isDown&&!this.aHitAreas[h].oData.hasLeft){for(var n=0;n<this.aHitAreas[h].aTouchIdentifiers.length;n++)this.aHitAreas[h].aTouchIdentifiers[n]==i&&(this.aHitAreas[h].aTouchIdentifiers.splice(n,1),n-=1);0==this.aHitAreas[h].aTouchIdentifiers.length&&(this.aHitAreas[h].oData.hasLeft=!0,this.aHitAreas[h].oData.isBeingDragged||(this.aHitAreas[h].oData.isDown=!1),this.aHitAreas[h].oData.multiTouch&&this.aHitAreas[h].callback(this.aHitAreas[h].id,this.aHitAreas[h].oData))}}},a.prototype.keyDown=function(a){for(var t=0;t<this.aKeys.length;t++)a.keyCode==this.aKeys[t].keyCode&&(a.preventDefault(),this.aKeys[t].oData.isDown=!0,this.aKeys[t].callback(this.aKeys[t].id,this.aKeys[t].oData))},a.prototype.keyUp=function(a){for(var t=0;t<this.aKeys.length;t++)a.keyCode==this.aKeys[t].keyCode&&(a.preventDefault(),this.aKeys[t].oData.isDown=!1,this.aKeys[t].callback(this.aKeys[t].id,this.aKeys[t].oData))},a.prototype.checkKeyFocus=function(){window.focus(),this.aKeys.length>0&&(window.removeEventListener("keydown",this.keyDownEvtFunc,!1),window.removeEventListener("keyup",this.keyUpEvtFunc,!1),window.addEventListener("keydown",this.keyDownEvtFunc,!1),window.addEventListener("keyup",this.keyUpEvtFunc,!1))},a.prototype.addKey=function(a,t,e,i){null==e&&(e=new Object),this.aKeys.push({id:a,callback:t,oData:e,keyCode:i}),this.checkKeyFocus()},a.prototype.removeKey=function(a){for(var t=0;t<this.aKeys.length;t++)this.aKeys[t].id==a&&(this.aKeys.splice(t,1),t-=1)},a.prototype.addHitArea=function(a,t,e,i,s,h){void 0===h&&(h=!1),null==e&&(e=new Object),h&&this.removeHitArea(a),s.scale||(s.scale=1),s.align||(s.align=[0,0]);var o=new Array;switch(i){case"image":var r;r=new Array(s.aPos[0]-s.oImgData.oData.oAtlasData[s.id].width/2*s.scale,s.aPos[1]-s.oImgData.oData.oAtlasData[s.id].height/2*s.scale,s.aPos[0]+s.oImgData.oData.oAtlasData[s.id].width/2*s.scale,s.aPos[1]+s.oImgData.oData.oAtlasData[s.id].height/2*s.scale),this.aHitAreas.push({id:a,aTouchIdentifiers:o,callback:t,oData:e,rect:!0,area:r,align:s.align});break;case"rect":this.aHitAreas.push({id:a,aTouchIdentifiers:o,callback:t,oData:e,rect:!0,area:s.aRect,align:s.align})}},a.prototype.removeHitArea=function(a){for(var t=0;t<this.aHitAreas.length;t++)this.aHitAreas[t].id==a&&(this.aHitAreas.splice(t,1),t-=1)},a.prototype.resetAll=function(){for(var a=0;a<this.aHitAreas.length;a++)this.aHitAreas[a].oData.isDown=!1,this.aHitAreas[a].oData.isBeingDragged=!1,this.aHitAreas[a].aTouchIdentifiers=new Array;this.isDown=!1},a}();a.UserInput=t}(Utils||(Utils={})),function(a){var t=function(){function a(a){this.updateFreq=10,this.updateInc=0,this.frameAverage=0,this.display=1,this.log="",this.render=function(a){this.frameAverage+=this.delta/this.updateFreq,++this.updateInc>=this.updateFreq&&(this.updateInc=0,this.display=this.frameAverage,this.frameAverage=0),a.textAlign="left",ctx.font="10px Helvetica",a.fillStyle="#333333",a.beginPath(),a.rect(0,this.canvasHeight-15,40,15),a.closePath(),a.fill(),a.fillStyle="#ffffff",a.fillText(Math.round(1e3/(1e3*this.display))+" fps "+this.log,5,this.canvasHeight-5)},this.canvasHeight=a}return a.prototype.update=function(a){this.delta=a},a}();a.FpsMeter=t}(Utils||(Utils={})),function(a){var t=function(){function a(){this.x=0,this.y=0,this.targY=0,this.incY=0,this.renderState=null,this.oImgData=assetLib.getData("horizon0")}return a.prototype.render=function(){canvas.width>canvas.height?ctx.drawImage(this.oImgData.img,0,(1-canvas.height/canvas.width)/2*this.oImgData.img.height,this.oImgData.img.width,canvas.height/canvas.width*this.oImgData.img.height,0,0,canvas.width,canvas.height):ctx.drawImage(this.oImgData.img,(1-canvas.width/canvas.height)/2*this.oImgData.img.width,0,canvas.width/canvas.height*this.oImgData.img.width,this.oImgData.img.height,0,0,canvas.width,canvas.height)},a}();a.Background=t}(Elements||(Elements={})),function(a){var t=function(){function t(a,t){this.timer=.3,this.endTime=0,this.posY=0,this.numberSpace=65,this.incY=0,this.flareRot=0,this.cashInc=0,this.lightningX=0,this.lightningY=0,this.lightningScale=1,this.posInc=0,this.startInc=100,this.startNum=3,this.tutInc=100,this.jaggedFrameScale=2,this.screenTweenIndex=0,this.aMapPoints=new Array([-39,-39],[198,41],[188,-148],[-109,-164],[-68,131]),this.lightningZapInc=0,this.lightningZapId=-1e3,this.copySuccess=0,this.oSplashLogoImgData=assetLib.getData("splashLogo"),this.oUiElementsImgData=assetLib.getData("uiElements"),this.oGameElementsImgData=assetLib.getData("gameElements"),this.oNumbers0ImgData=assetLib.getData("numbers0"),this.oNumbers1ImgData=assetLib.getData("numbers1"),this.oNumbers2ImgData=assetLib.getData("numbers2"),this.panelType=a,this.aButs=t,this.oTopFlareImgData=assetLib.getData("flare")}return t.prototype.update=function(){this.incY+=10*delta},t.prototype.tweenCharInfo=function(){this.panelTween&&this.panelTween.kill(),this.panelY=100,this.panelTween=TweenLite.to(this,.5,{panelY:0,ease:"Cubic.easeOut"})},t.prototype.startSequence=function(){this.startTween&&this.startTween.kill(),this.startNum=4,this.nextStartNumber()},t.prototype.tweenFinish=function(){this.endInc=500,TweenLite.to(this,.5,{endInc:0,ease:"Cubic.easeOut"}),playSound("raceEnd"),userInput.removeHitArea("pause"),userInput.removeHitArea("steerLeft"),userInput.removeHitArea("steerRight"),userInput.removeKey("steerRight"),userInput.removeKey("steerLeft"),setTimeout(function(){0==gameType?initGameEnd0():initGameEnd1()},3e3)},t.prototype.nextStartNumber=function(){var a=this;this.startNum--,playSound("countDown"),this.startTween=TweenLite.to(this,.2,{startInc:0,ease:"Back.easeOut",onComplete:function(){a.startTween=TweenLite.to(a,.1,{startInc:49,delay:.6,ease:"Cubic.easeIn",onComplete:function(){a.startNum>1?a.nextStartNumber():(a.startInc=50,playSound("raceStart"),firstRun&&(a.tutInc=100,a.tutTween=TweenLite.to(a,.3,{tutInc:0,ease:"Cubic.easeOut",onComplete:function(){a.tutTween=TweenLite.to(a,.3,{tutInc:100,delay:3,ease:"Cubic.easeIn",onComplete:function(){firstRun=!1}})}})))}})}})},t.prototype.lightningHit=function(a,t){var e=this;this.lightningTween&&this.lightningTween.kill(),this.lightningX=a,this.lightningY=t,this.lightningScale=1,this.lightningTween=TweenLite.to(this,.2,{lightningScale:0,ease:"Bounce.easeOut",onComplete:function(){e.lightningTween=TweenLite.to(e,.2,{lightningScale:1,ease:"Cubic.easeIn",onComplete:function(){e.lightningZapInc=e.incY}})}})},t.prototype.jigglePos=function(){this.cashTween&&this.cashTween.kill(),this.posInc=-50,this.posTween=TweenLite.to(this,1,{posInc:0,ease:"Elastic.easeOut"})},t.prototype.jiggleCash=function(){this.cashTween&&this.cashTween.kill(),this.cashInc=-50,this.cashTween=TweenLite.to(this,1,{cashInc:0,ease:"Elastic.easeOut"})},t.prototype.startTween1=function(){this.posY=500,TweenLite.to(this,.5,{posY:0,ease:"Back.easeOut"}),this.charY=500,TweenLite.to(this,.5,{charY:0,ease:"Cubic.easeOut"}),this.butsY=500,TweenLite.to(this,.5,{butsY:0,ease:"Cubic.easeOut"})},t.prototype.endScreenTween0=function(){var t,e=this;this.screenTween&&this.screenTween.kill(),0==this.screenTweenIndex&&(this.aScreenIncs=new Array(1e3,1e3,1e3,1e3,1e3)),this.screenTween=TweenLite.to(this.aScreenIncs,.2,((t={})[this.screenTweenIndex]=0,t.ease="Cubic.easeOut",t.onComplete=function(){if(e.screenTweenIndex++,e.screenTweenIndex<e.aScreenIncs.length)e.endScreenTween0();else if("upgrades"!=prevGameState){playSound("earnCoins"+Math.floor(4*Math.random()));for(var t=0;t<2*(14-userCharPos);t++){var i=new a.CoinShower(assetLib.getData("coin"),Math.random()*(canvas.width/2)+.25*canvas.width,Math.random()*(canvas.height/2)+.25*canvas.height);aEffects.push(i)}"gameEnd0"==gameState?saveDataHandler.updateCash(25*aPosPoints[userCharPos]+50):saveDataHandler.updateCash(2*(25*aPosPoints[userCharPos]+50)),saveDataHandler.saveData(),e.jiggleCash()}},t))},t.prototype.endScreenTween1=function(){var t;t=-1==challengeTime?20:raceTime>challengeTime?5:20,playSound("earnCoins"+Math.floor(4*Math.random()));for(var e=0;e<t;e++){var i=new a.CoinShower(assetLib.getData("coin"),Math.random()*(canvas.width/2)+.25*canvas.width,Math.random()*(canvas.height/2)+.25*canvas.height);aEffects.push(i)}saveDataHandler.updateCash(5*t),saveDataHandler.saveData(),this.jiggleCash()},t.prototype.removeBut=function(a){for(var t=0;t<this.aButs.length;t++)this.aButs[t].id==a&&(this.aButs.splice(t,1),t-=1)},t.prototype.switchBut=function(a,t,e,i,s){void 0===i&&(i=null),void 0===s&&(s=null);for(var h=null,o=0;o<this.aButs.length;o++)this.aButs[o].id==a&&(this.aButs[o].id=t,this.aButs[o].idOver=e,h=this.aButs[o],i&&(this.aButs[o].aPos=i),s&&(this.aButs[o].align=s));return h},t.prototype.addTextBar=function(a,t,e,i,s){ctx.fillStyle=s,ctx.fillRect(a,t,e,i),ctx.beginPath(),ctx.arc(a,t+i/2,i/2,0,2*Math.PI),ctx.fill(),ctx.beginPath(),ctx.arc(a+e,t+i/2,i/2,0,2*Math.PI),ctx.fill()},t.prototype.render=function(a){switch(void 0===a&&(a=!0),a||this.addButs(ctx),this.panelType){case"splash":ctx.fillStyle="rgba(0, 0, 0, 0.35)",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.drawImage(this.oSplashLogoImgData.img,canvas.width/2-this.oSplashLogoImgData.img.width/2,canvas.height/2-this.oSplashLogoImgData.img.height/2-this.posY);break;case"start":var t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].height,h=.1*Math.sin(.5*this.incY)+.1+1;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,0-.5*(canvas.width*h-canvas.width),0-.5*(canvas.height*h-canvas.height),canvas.width*h,canvas.height*h);var o=assetLib.getData("titleLogo"),r=(h=1,.42*canvas.height-o.img.height/2);(canvas.height>canvas.width-200||-1!=challengeTime)&&(r=Math.max(.55*canvas.height-330-o.img.height/2,-15)),ctx.drawImage(o.img,0,0,o.img.width,o.img.height,canvas.width/2-o.img.width/2*h,r+10*Math.sin(.4*this.incY)+this.posY,o.img.width*h,o.img.height*h);var n=.55*canvas.height;t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar0].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar0].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar0].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar0].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,-this.charY+Math.abs(20*Math.sin(.3*this.incY))-20,n-s/2-150,i,s);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar1].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar1].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar1].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar1].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,.5*-this.charY+Math.abs(20*Math.sin(.28*this.incY+1))-20,n-s/2,i,s);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar3].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar3].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar3].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar3].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,-this.charY+Math.abs(20*Math.sin(.26*this.incY+2))-20,n-s/2+100,i,s);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar2].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar2].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar2].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar2].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,2*-this.charY+Math.abs(20*Math.sin(.24*this.incY+3))-20,n-s/2-30,i,s),n=.55*canvas.height;t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar5].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar5].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar5].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar5].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width-i+.5*this.charY-Math.abs(20*Math.sin(.3*this.incY))+20,n-s/2,i,s);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar4].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar4].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar4].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar4].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width-i+this.charY-Math.abs(20*Math.sin(.28*this.incY+1))+20,n-s/2-135,i,s);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar6].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar6].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar6].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar6].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width-i+2*this.charY-Math.abs(20*Math.sin(.26*this.incY+2))+20,n-s/2-20,i,s);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar7].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar7].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar7].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar7].height;if(ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width-i+this.charY-Math.abs(20*Math.sin(.24*this.incY+3))+20,n-s/2+90,i,s),-1==challengeTime);else{t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.acceptChallengeBg].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.acceptChallengeBg].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.acceptChallengeBg].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.acceptChallengeBg].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width/2-i/2,.75*canvas.height-s/2-15+this.butsY,i,s);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+challengeChar]].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+challengeChar]].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+challengeChar]].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+challengeChar]].height;B=.5,ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width/2-236,.75*canvas.height-s*B+this.butsY+109,i*B,s*B),addText(1,40,390,"center",canvas.width/2,.75*canvas.height-95+this.butsY,"youHaveBeen","#FFFFFF"),addText(0,25,390,"center",canvas.width/2,.75*canvas.height+95+this.butsY,"acceptChallenge","#FFFFFF")}break;case"credits":ctx.fillStyle="rgba(0, 0, 0, 0.5)",ctx.fillRect(0,0,canvas.width,canvas.height);o=assetLib.getData("info");if(ctx.drawImage(o.img,0,0,o.img.width,o.img.height,canvas.width/2-o.img.width/2,canvas.height/2-o.img.height/2+this.posY,o.img.width,o.img.height),addText(0,23,700,"center",canvas.width/2,canvas.height/2-170+this.posY,"producedFor","#FFFFFF"),addText(0,23,700,"center",canvas.width/2,canvas.height/2+83+this.posY,"createdBy","#FFFFFF"),addText(0,23,200,"right",canvas.width-95,canvas.height-36+this.butsY,"resetGame","#FFFFFF"),ctx.fillStyle="#FFFFFF",ctx.textAlign="center",ctx.font="italic 15px Helvetica",ctx.fillText("v1.1.9",canvas.width/2,canvas.height/2+200+this.posY),resetConfirmOn){t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.areYouSurePanel].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.areYouSurePanel].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.areYouSurePanel].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.areYouSurePanel].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width-i-10,canvas.height-s-90,i,s),addText(0,23,270,"center",canvas.width-i/2-10,canvas.height-220,"areYouSure","#FFFFFF")}break;case"charSelect":t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].height,h=.1*Math.sin(.5*this.incY)+.1+1;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,0-.5*(canvas.width*h-canvas.width),0-.5*(canvas.height*h-canvas.height),canvas.width*h,canvas.height*h);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.screenTitlePanel1].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.screenTitlePanel1].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.screenTitlePanel1].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.screenTitlePanel1].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,5,1-this.butsY,i,s),addText(2,40,360,"left",35,52-this.butsY,"selectCharacter","#FFFFFF");t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.uiCoin0].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.uiCoin0].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.uiCoin0].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.uiCoin0].height,h=.6;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,.72*canvas.width-i*h+this.cashInc,39-s/2*h-this.butsY,i*h,s*h);for(var d=saveDataHandler.getCash().toString();d.length<3;)d="0"+d;for(var g=0;g<d.length;g++){var m=(R=parseFloat(d.charAt(g)))*this.oNumbers0ImgData.oData.spriteWidth%this.oNumbers0ImgData.img.width,l=Math.floor(R/(this.oNumbers0ImgData.img.width/this.oNumbers0ImgData.oData.spriteWidth))*this.oNumbers0ImgData.oData.spriteHeight;h=Math.min((canvas.width-100-.72*canvas.width)/(this.numberSpace*d.length),.6),ctx.drawImage(this.oNumbers0ImgData.img,m,l,this.oNumbers0ImgData.oData.spriteWidth,this.oNumbers0ImgData.oData.spriteHeight,.72*canvas.width+g*this.numberSpace*h+this.cashInc,39-this.butsY-this.oNumbers0ImgData.oData.spriteHeight/2*h,this.oNumbers0ImgData.oData.spriteWidth*h,this.oNumbers0ImgData.oData.spriteHeight*h)}if(this.panelY<100){var c=.75*-Math.max(canvas.height-460-400,0);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.charPanel].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.charPanel].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.charPanel].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.charPanel].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width/2-i/2,canvas.height-s-35+this.panelY+c,i,s);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+curChar]].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+curChar]].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+curChar]].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+curChar]].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width/2-331,canvas.height-s-114+2*this.panelY+c,i,s);var I=curChar,u=saveDataHandler.getVehicleData(curChar);for(g=0;g<u.length;g++)if(2==u[g]){I=parseInt((14+g).toString()+aCharData[curChar].vehicleType);break}t=this.oUiElementsImgData.oData.oAtlasData[oImageIds["vehicle"+I]].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds["vehicle"+I]].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds["vehicle"+I]].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds["vehicle"+I]].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width/2-i/2+5*Math.sin(.5*this.incY)+20,canvas.height-s-6+2*this.panelY+c,i,s);var D=-1;for(g=0;g<3;g++)if(2==saveDataHandler.getUpgradeLockStatus(curChar,g+6)){D=g;break}if(D>-1){t=this.oUiElementsImgData.oData.oAtlasData[oImageIds["upgradePreview"+D]].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds["upgradePreview"+D]].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds["upgradePreview"+D]].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds["upgradePreview"+D]].height;0==aCharData[curChar].vehicleType?ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width/2-i/2-5*Math.sin(.5*this.incY)+60,canvas.height-s-90+2*this.panelY+c,i,s):ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width/2-i/2-5*Math.sin(.5*this.incY)-45,canvas.height-s-110+2*this.panelY+c,i,s)}t=this.oUiElementsImgData.oData.oAtlasData[oImageIds["logo"+aCharData[curChar].logo]].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds["logo"+aCharData[curChar].logo]].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds["logo"+aCharData[curChar].logo]].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds["logo"+aCharData[curChar].logo]].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width/2-220-i/2,canvas.height-60-s/2+2*this.panelY+c,i,s),ctx.fillStyle="#BF4407",ctx.fillRect(canvas.width/2+165,canvas.height-285+this.panelY+c,120,15),ctx.fillStyle="#FFFFFF",ctx.fillRect(canvas.width/2+165,canvas.height-285+this.panelY+c,120*aCharData[curChar].stats[0],15),ctx.fillStyle="#FFE230",ctx.fillRect(canvas.width/2+165+120*aCharData[curChar].stats[0],canvas.height-285+this.panelY+c,5*saveDataHandler.getStatBonus(0),15),addText(2,25,120,"left",canvas.width/2+165,canvas.height-248+this.panelY+c,"acceleration","#FFFFFF"),ctx.fillStyle="#BF4407",ctx.fillRect(canvas.width/2+165,canvas.height-238+this.panelY+c,120,15),ctx.fillStyle="#FFFFFF",ctx.fillRect(canvas.width/2+165,canvas.height-238+this.panelY+c,120*aCharData[curChar].stats[1],15),ctx.fillStyle="#FFE230",ctx.fillRect(canvas.width/2+165+120*aCharData[curChar].stats[1],canvas.height-238+this.panelY+c,5*saveDataHandler.getStatBonus(1),15),addText(2,25,120,"left",canvas.width/2+165,canvas.height-201+this.panelY+c,"steering","#FFFFFF"),ctx.fillStyle="#BF4407",ctx.fillRect(canvas.width/2+165,canvas.height-190+this.panelY+c,120,15),ctx.fillStyle="#FFFFFF",ctx.fillRect(canvas.width/2+165,canvas.height-190+this.panelY+c,120*aCharData[curChar].stats[2],15),ctx.fillStyle="#FFE230",ctx.fillRect(canvas.width/2+165+120*aCharData[curChar].stats[2],canvas.height-190+this.panelY+c,5*saveDataHandler.getStatBonus(2),15),addText(2,25,120,"left",canvas.width/2+165,canvas.height-153+this.panelY+c,"topSpeed","#FFFFFF"),addText(2,32,180,"center",canvas.width/2,canvas.height-274+this.panelY+c,"char"+curChar,"#FF5500")}break;case"upgrades":t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].height,h=.1*Math.sin(.5*this.incY)+.1+1;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,0-.5*(canvas.width*h-canvas.width),0-.5*(canvas.height*h-canvas.height),canvas.width*h,canvas.height*h);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.screenTitlePanel1].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.screenTitlePanel1].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.screenTitlePanel1].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.screenTitlePanel1].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,5,1-this.butsY,i,s),addText(2,40,360,"left",35,52-this.butsY,"upgrades","#FFFFFF");t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.uiCoin0].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.uiCoin0].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.uiCoin0].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.uiCoin0].height,h=.6;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,.72*canvas.width-i*h+this.cashInc,39-s/2*h-this.butsY,i*h,s*h);for(d=saveDataHandler.getCash().toString();d.length<3;)d="0"+d;for(g=0;g<d.length;g++){m=(R=parseFloat(d.charAt(g)))*this.oNumbers0ImgData.oData.spriteWidth%this.oNumbers0ImgData.img.width,l=Math.floor(R/(this.oNumbers0ImgData.img.width/this.oNumbers0ImgData.oData.spriteWidth))*this.oNumbers0ImgData.oData.spriteHeight;h=Math.min((canvas.width-100-.72*canvas.width)/(this.numberSpace*d.length),.6),ctx.drawImage(this.oNumbers0ImgData.img,m,l,this.oNumbers0ImgData.oData.spriteWidth,this.oNumbers0ImgData.oData.spriteHeight,.72*canvas.width+g*this.numberSpace*h+this.cashInc,39-this.butsY-this.oNumbers0ImgData.oData.spriteHeight/2*h,this.oNumbers0ImgData.oData.spriteWidth*h,this.oNumbers0ImgData.oData.spriteHeight*h)}c=.75*-Math.max(canvas.height-460-400,0),t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.charPanel].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.charPanel].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.charPanel].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.charPanel].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width/2-i/2,canvas.height-s-35+this.panelY+c,i,s);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+curChar]].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+curChar]].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+curChar]].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+curChar]].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width/2-331,canvas.height-s-114+2*this.panelY+c,i,s);for(I=curChar,u=saveDataHandler.getVehicleData(curChar),g=0;g<u.length;g++)if(2==u[g]){I=parseInt((14+g).toString()+aCharData[curChar].vehicleType);break}t=this.oUiElementsImgData.oData.oAtlasData[oImageIds["vehicle"+I]].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds["vehicle"+I]].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds["vehicle"+I]].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds["vehicle"+I]].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width/2-i/2+5*Math.sin(.5*this.incY)+20,canvas.height-s-6+2*this.panelY+c,i,s);for(D=-1,g=0;g<3;g++)if(2==saveDataHandler.getUpgradeLockStatus(curChar,g+6)){D=g;break}if(D>-1){t=this.oUiElementsImgData.oData.oAtlasData[oImageIds["upgradePreview"+D]].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds["upgradePreview"+D]].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds["upgradePreview"+D]].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds["upgradePreview"+D]].height;0==aCharData[curChar].vehicleType?ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width/2-i/2-5*Math.sin(.5*this.incY)+60,canvas.height-s-90+2*this.panelY+c,i,s):ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width/2-i/2-5*Math.sin(.5*this.incY)-45,canvas.height-s-110+2*this.panelY+c,i,s)}ctx.fillStyle="#BF4407",ctx.fillRect(canvas.width/2+165,canvas.height-285+this.panelY+c,120,15),ctx.fillStyle="#FFFFFF",ctx.fillRect(canvas.width/2+165,canvas.height-285+this.panelY+c,120*aCharData[curChar].stats[0],15),ctx.fillStyle="#FFE230",ctx.fillRect(canvas.width/2+165+120*aCharData[curChar].stats[0],canvas.height-285+this.panelY+c,5*saveDataHandler.getStatBonus(0),15),addText(2,25,120,"left",canvas.width/2+165,canvas.height-248+this.panelY+c,"acceleration","#FFFFFF"),ctx.fillStyle="#BF4407",ctx.fillRect(canvas.width/2+165,canvas.height-238+this.panelY+c,120,15),ctx.fillStyle="#FFFFFF",ctx.fillRect(canvas.width/2+165,canvas.height-238+this.panelY+c,120*aCharData[curChar].stats[1],15),ctx.fillStyle="#FFE230",ctx.fillRect(canvas.width/2+165+120*aCharData[curChar].stats[1],canvas.height-238+this.panelY+c,5*saveDataHandler.getStatBonus(1),15),addText(2,25,120,"left",canvas.width/2+165,canvas.height-201+this.panelY+c,"steering","#FFFFFF"),ctx.fillStyle="#BF4407",ctx.fillRect(canvas.width/2+165,canvas.height-190+this.panelY+c,120,15),ctx.fillStyle="#FFFFFF",ctx.fillRect(canvas.width/2+165,canvas.height-190+this.panelY+c,120*aCharData[curChar].stats[2],15),ctx.fillStyle="#FFE230",ctx.fillRect(canvas.width/2+165+120*aCharData[curChar].stats[2],canvas.height-190+this.panelY+c,5*saveDataHandler.getStatBonus(2),15),addText(2,25,120,"left",canvas.width/2+165,canvas.height-153+this.panelY+c,"topSpeed","#FFFFFF"),addText(2,32,180,"center",canvas.width/2,canvas.height-274+this.panelY+c,"char"+curChar,"#FF5500");break;case"game":t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].height;if(ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,0-.5*(canvas.width*this.jaggedFrameScale-canvas.width),0-.5*(canvas.height*this.jaggedFrameScale-canvas.height),canvas.width*this.jaggedFrameScale,canvas.height*this.jaggedFrameScale),this.lightningScale<1){t=this.oGameElementsImgData.oData.oAtlasData[oImageIds.lightning].x,e=this.oGameElementsImgData.oData.oAtlasData[oImageIds.lightning].y,i=this.oGameElementsImgData.oData.oAtlasData[oImageIds.lightning].width,s=this.oGameElementsImgData.oData.oAtlasData[oImageIds.lightning].height;var p=this.lightningY/s;ctx.drawImage(this.oGameElementsImgData.img,t,e,i,s,this.lightningX-i/2*p+10*Math.random()-5,-this.lightningScale*(s*p),i*p,s*p)}if(0==gameType){var v=0;if(ground.magnetCount>0)v=Math.floor(.5*this.incY)%2;t=this.oUiElementsImgData.oData.oAtlasData[oImageIds["uiCoin"+v]].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds["uiCoin"+v]].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds["uiCoin"+v]].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds["uiCoin"+v]].height,h=.6;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,.72*canvas.width-i*h,39-s/2*h-this.butsY+this.cashInc,i*h,s*h);for(var x,w=saveDataHandler.getCash().toString();w.length<3;)w="0"+w;for(g=0;g<w.length;g++){m=(R=parseFloat(w.charAt(g)))*this.oNumbers0ImgData.oData.spriteWidth%this.oNumbers0ImgData.img.width,l=Math.floor(R/(this.oNumbers0ImgData.img.width/this.oNumbers0ImgData.oData.spriteWidth))*this.oNumbers0ImgData.oData.spriteHeight;x=Math.min((canvas.width-100-.72*canvas.width)/(this.numberSpace*w.length),.6),ctx.drawImage(this.oNumbers0ImgData.img,m,l,this.oNumbers0ImgData.oData.spriteWidth,this.oNumbers0ImgData.oData.spriteHeight,.72*canvas.width+g*this.numberSpace*x,39-this.butsY-this.oNumbers0ImgData.oData.spriteHeight/2*x+this.cashInc,this.oNumbers0ImgData.oData.spriteWidth*x,this.oNumbers0ImgData.oData.spriteHeight*x)}}else{h=Math.min((canvas.width-100-.72*canvas.width)/200,.6);var f=Math.floor(raceTime/6e3).toString(),y=.72*canvas.width-120*h,E=39-this.butsY-this.oNumbers1ImgData.oData.spriteHeight/2*h,A=Math.floor((raceTime-6e3*Math.floor(raceTime/6e3))/100).toString();A.length<2&&(A="0"+A);var S=raceTime.toString().charAt(raceTime.toString().length-2)+raceTime.toString().charAt(raceTime.toString().length-1);S.length<2&&(S="0"+S);for(g=0;g<2;g++){if(R=parseFloat(f.charAt(g)),f.length<2){if(0==g)continue;R=parseFloat(f.charAt(0))}m=R*this.oNumbers0ImgData.oData.spriteWidth%this.oNumbers0ImgData.img.width,l=Math.floor(R/(this.oNumbers0ImgData.img.width/this.oNumbers0ImgData.oData.spriteWidth))*this.oNumbers0ImgData.oData.spriteHeight;ctx.drawImage(this.oNumbers0ImgData.img,m,l,this.oNumbers0ImgData.oData.spriteWidth,this.oNumbers0ImgData.oData.spriteHeight,y,E,this.oNumbers0ImgData.oData.spriteWidth*h,this.oNumbers0ImgData.oData.spriteHeight*h)}m=(R=10)*this.oNumbers0ImgData.oData.spriteWidth%this.oNumbers0ImgData.img.width,l=Math.floor(R/(this.oNumbers0ImgData.img.width/this.oNumbers0ImgData.oData.spriteWidth))*this.oNumbers0ImgData.oData.spriteHeight;ctx.drawImage(this.oNumbers0ImgData.img,m,l,this.oNumbers0ImgData.oData.spriteWidth,this.oNumbers0ImgData.oData.spriteHeight,y+50*h,E,this.oNumbers0ImgData.oData.spriteWidth*h,this.oNumbers0ImgData.oData.spriteHeight*h);for(g=0;g<2;g++){m=(R=parseFloat(A.charAt(g)))*this.oNumbers0ImgData.oData.spriteWidth%this.oNumbers0ImgData.img.width,l=Math.floor(R/(this.oNumbers0ImgData.img.width/this.oNumbers0ImgData.oData.spriteWidth))*this.oNumbers0ImgData.oData.spriteHeight;ctx.drawImage(this.oNumbers0ImgData.img,m,l,this.oNumbers0ImgData.oData.spriteWidth,this.oNumbers0ImgData.oData.spriteHeight,y+100*h+g*this.numberSpace*h,E,this.oNumbers0ImgData.oData.spriteWidth*h,this.oNumbers0ImgData.oData.spriteHeight*h)}for(g=0;g<2;g++){m=(R=parseFloat(S.charAt(g)))*this.oNumbers0ImgData.oData.spriteWidth%this.oNumbers0ImgData.img.width,l=Math.floor(R/(this.oNumbers0ImgData.img.width/this.oNumbers0ImgData.oData.spriteWidth))*this.oNumbers0ImgData.oData.spriteHeight;ctx.drawImage(this.oNumbers0ImgData.img,m,l,this.oNumbers0ImgData.oData.spriteWidth,this.oNumbers0ImgData.oData.spriteHeight,y+235*h+g*this.numberSpace*.6*h,E+4,.6*this.oNumbers0ImgData.oData.spriteWidth*h,.6*this.oNumbers0ImgData.oData.spriteHeight*h)}}for(h=.75,w=(userCharPos+1).toString();w.length<2;)w="0"+w;for(g=0;g<w.length;g++){m=(R=parseFloat(w.charAt(g)))*this.oNumbers1ImgData.oData.spriteWidth%this.oNumbers1ImgData.img.width,l=Math.floor(R/(this.oNumbers1ImgData.img.width/this.oNumbers1ImgData.oData.spriteWidth))*this.oNumbers1ImgData.oData.spriteHeight;ctx.drawImage(this.oNumbers1ImgData.img,m,l,this.oNumbers1ImgData.oData.spriteWidth,this.oNumbers1ImgData.oData.spriteHeight,.26*canvas.width+g*this.numberSpace*h-2*this.numberSpace*h,39-this.butsY-this.oNumbers1ImgData.oData.spriteHeight/2*h-this.posInc,this.oNumbers1ImgData.oData.spriteWidth*h,this.oNumbers1ImgData.oData.spriteHeight*h)}h=.5;m=(R=10)*this.oNumbers2ImgData.oData.spriteWidth%this.oNumbers2ImgData.img.width,l=Math.floor(R/(this.oNumbers2ImgData.img.width/this.oNumbers2ImgData.oData.spriteWidth))*this.oNumbers2ImgData.oData.spriteHeight;ctx.drawImage(this.oNumbers2ImgData.img,m,l,this.oNumbers2ImgData.oData.spriteWidth,this.oNumbers1ImgData.oData.spriteHeight,.26*canvas.width+2,39-this.butsY-this.oNumbers2ImgData.oData.spriteHeight/2*h+this.posInc,this.oNumbers2ImgData.oData.spriteWidth*h,this.oNumbers2ImgData.oData.spriteHeight*h),w=14..toString();for(g=0;g<w.length;g++){m=(R=parseFloat(w.charAt(g)))*this.oNumbers2ImgData.oData.spriteWidth%this.oNumbers2ImgData.img.width,l=Math.floor(R/(this.oNumbers2ImgData.img.width/this.oNumbers2ImgData.oData.spriteWidth))*this.oNumbers2ImgData.oData.spriteHeight;ctx.drawImage(this.oNumbers2ImgData.img,m,l,this.oNumbers2ImgData.oData.spriteWidth,this.oNumbers2ImgData.oData.spriteHeight,.26*canvas.width+(g+1)*this.numberSpace*h,39-this.butsY-this.oNumbers2ImgData.oData.spriteHeight/2*h+this.posInc,this.oNumbers2ImgData.oData.spriteWidth*h,this.oNumbers2ImgData.oData.spriteHeight*h)}ctx.fillStyle="#2877A6",ctx.fillRect(.42*canvas.width-2,20-this.butsY-2,.2*canvas.width+4,42);t=this.oGameElementsImgData.oData.oAtlasData[oImageIds.uiDistEnd].x,e=this.oGameElementsImgData.oData.oAtlasData[oImageIds.uiDistEnd].y,i=this.oGameElementsImgData.oData.oAtlasData[oImageIds.uiDistEnd].width,s=this.oGameElementsImgData.oData.oAtlasData[oImageIds.uiDistEnd].height;ctx.drawImage(this.oGameElementsImgData.img,t,e,i,s,.62*canvas.width-i-1,39-s/2-this.butsY,i,s),h=(.2*canvas.width-25)*Math.min(ground.aRoad[0].id/raceLength,1);t=this.oGameElementsImgData.oData.oAtlasData[oImageIds.uiDistBar].x,e=this.oGameElementsImgData.oData.oAtlasData[oImageIds.uiDistBar].y,i=this.oGameElementsImgData.oData.oAtlasData[oImageIds.uiDistBar].width,s=this.oGameElementsImgData.oData.oAtlasData[oImageIds.uiDistBar].height;ctx.drawImage(this.oGameElementsImgData.img,t,e,i,s,.42*canvas.width+2,39-s/2-this.butsY,h+1,s);t=this.oGameElementsImgData.oData.oAtlasData[oImageIds.uiDistCap].x,e=this.oGameElementsImgData.oData.oAtlasData[oImageIds.uiDistCap].y,i=this.oGameElementsImgData.oData.oAtlasData[oImageIds.uiDistCap].width,s=this.oGameElementsImgData.oData.oAtlasData[oImageIds.uiDistCap].height;if(ctx.drawImage(this.oGameElementsImgData.img,t,e,i,s,.42*canvas.width+h+1,39-s/2-this.butsY,i,s),this.startInc<50){var b=.25*canvas.height;canvas.width>canvas.height&&(b=100),ctx.fillStyle="#FFFFFF",ctx.beginPath(),ctx.arc(canvas.width/2,b+84-this.startInc,Math.max(100-5*this.startInc,0),0,2*Math.PI),ctx.fill(),ctx.fillStyle="#7C2E16",ctx.beginPath(),ctx.arc(canvas.width/2,b+84-this.startInc,Math.max(95-5*this.startInc,0),0,2*Math.PI),ctx.fill(),ctx.fillStyle="#FF6C00",ctx.beginPath(),ctx.arc(canvas.width/2,b+84-this.startInc,Math.max(90-5*this.startInc,0),0,2*Math.PI),ctx.fill();t=this.oGameElementsImgData.oData.oAtlasData[oImageIds.raceFlag0].x,e=this.oGameElementsImgData.oData.oAtlasData[oImageIds.raceFlag0].y,i=this.oGameElementsImgData.oData.oAtlasData[oImageIds.raceFlag0].width,s=this.oGameElementsImgData.oData.oAtlasData[oImageIds.raceFlag0].height;ctx.drawImage(this.oGameElementsImgData.img,t,e,i,s,canvas.width/2-50-i-this.startInc,b,i,s);t=this.oGameElementsImgData.oData.oAtlasData[oImageIds.raceFlag1].x,e=this.oGameElementsImgData.oData.oAtlasData[oImageIds.raceFlag1].y,i=this.oGameElementsImgData.oData.oAtlasData[oImageIds.raceFlag1].width,s=this.oGameElementsImgData.oData.oAtlasData[oImageIds.raceFlag1].height;ctx.drawImage(this.oGameElementsImgData.img,t,e,i,s,canvas.width/2+50+this.startInc,b,i,s);m=this.startNum*this.oNumbers1ImgData.oData.spriteWidth%this.oNumbers1ImgData.img.width,l=Math.floor(this.startNum/(this.oNumbers1ImgData.img.width/this.oNumbers1ImgData.oData.spriteWidth))*this.oNumbers1ImgData.oData.spriteHeight;h=1.3,ctx.drawImage(this.oNumbers1ImgData.img,m,l,this.oNumbers1ImgData.oData.spriteWidth,this.oNumbers1ImgData.oData.spriteHeight,canvas.width/2-this.oNumbers1ImgData.oData.spriteWidth/2*h,b+20-this.startInc,this.oNumbers1ImgData.oData.spriteWidth*h,this.oNumbers1ImgData.oData.spriteHeight*h)}if(this.tutInc<100){var C="B";isMobile&&(C="A");t=this.oUiElementsImgData.oData.oAtlasData[oImageIds["tut"+C+Math.floor(.1*this.incY)%2]].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds["tut"+C+Math.floor(.1*this.incY)%2]].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds["tut"+C+Math.floor(.1*this.incY)%2]].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds["tut"+C+Math.floor(.1*this.incY)%2]].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width-i+this.tutInc,canvas.height-s-100,i,s)}if(this.endInc<500){b=.25*canvas.height;canvas.width>canvas.height&&(b=100),ctx.fillStyle="#FFFFFF",ctx.beginPath(),ctx.arc(canvas.width/2,b+84-this.endInc,Math.max(100-5*this.endInc,0),0,2*Math.PI),ctx.fill(),ctx.fillStyle="#7C2E16",ctx.beginPath(),ctx.arc(canvas.width/2,b+84-this.endInc,Math.max(95-5*this.endInc,0),0,2*Math.PI),ctx.fill(),ctx.fillStyle="#FF6C00",ctx.beginPath(),ctx.arc(canvas.width/2,b+84-this.endInc,Math.max(90-5*this.endInc,0),0,2*Math.PI),ctx.fill();t=this.oGameElementsImgData.oData.oAtlasData[oImageIds.raceFlag0].x,e=this.oGameElementsImgData.oData.oAtlasData[oImageIds.raceFlag0].y,i=this.oGameElementsImgData.oData.oAtlasData[oImageIds.raceFlag0].width,s=this.oGameElementsImgData.oData.oAtlasData[oImageIds.raceFlag0].height;ctx.drawImage(this.oGameElementsImgData.img,t,e,i,s,canvas.width/2-15-i-this.endInc-20*Math.sin(.5*this.incY),b-10*Math.sin(this.incY),i,s);t=this.oGameElementsImgData.oData.oAtlasData[oImageIds.raceFlag1].x,e=this.oGameElementsImgData.oData.oAtlasData[oImageIds.raceFlag1].y,i=this.oGameElementsImgData.oData.oAtlasData[oImageIds.raceFlag1].width,s=this.oGameElementsImgData.oData.oAtlasData[oImageIds.raceFlag1].height;ctx.drawImage(this.oGameElementsImgData.img,t,e,i,s,canvas.width/2+15+this.endInc+20*Math.sin(.5*this.incY),b+10*Math.sin(this.incY),i,s)}break;case"pause":t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].height,h=.1*Math.sin(.5*this.incY)+.1+1;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,0-.5*(canvas.width*h-canvas.width),0-.5*(canvas.height*h-canvas.height),canvas.width*h,canvas.height*h),ctx.fillStyle="rgba(0, 0, 0, 0.5)",ctx.fillRect(0,0,canvas.width,canvas.height);n=.35*canvas.height,t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar0].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar0].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar0].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar0].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,-this.charY+Math.abs(20*Math.sin(.3*this.incY))-20,n-s/2-150,i,s);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar1].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar1].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar1].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar1].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,.5*-this.charY+Math.abs(20*Math.sin(.28*this.incY+1))-20,n-s/2,i,s);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar3].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar3].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar3].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar3].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,-this.charY+Math.abs(20*Math.sin(.26*this.incY+2))-20,n-s/2+100,i,s);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar2].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar2].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar2].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar2].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,2*-this.charY+Math.abs(20*Math.sin(.24*this.incY+3))-20,n-s/2-30,i,s),n=.75*canvas.height;t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar5].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar5].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar5].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar5].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width-i+.5*this.charY-Math.abs(20*Math.sin(.3*this.incY))+20,n-s/2,i,s);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar4].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar4].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar4].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar4].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width-i+this.charY-Math.abs(20*Math.sin(.28*this.incY+1))+20,n-s/2-135,i,s);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar6].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar6].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar6].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar6].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width-i+2*this.charY-Math.abs(20*Math.sin(.26*this.incY+2))+20,n-s/2-20,i,s);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar7].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar7].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar7].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.titleChar7].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width-i+this.charY-Math.abs(20*Math.sin(.24*this.incY+3))+20,n-s/2+90,i,s),this.addTextBar(canvas.width/2-100-75,.5*canvas.height+73+this.butsY,150,36,"#FF5500"),addText(0,23,160,"center",canvas.width/2-100,.5*canvas.height+97+this.butsY,"continue","#FFFFFF"),this.addTextBar(canvas.width/2+100-75,.5*canvas.height+73+this.butsY,150,36,"#4C6DFF"),addText(0,23,160,"center",canvas.width/2+100,.5*canvas.height+97+this.butsY,0==gameType?"quitTournament":"quitChallenge","#FFFFFF");break;case"gameIntro":t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].height,h=.1*Math.sin(.5*this.incY)+.1+1;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,0-.5*(canvas.width*h-canvas.width),0-.5*(canvas.height*h-canvas.height),canvas.width*h,canvas.height*h);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.screenTitlePanel1].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.screenTitlePanel1].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.screenTitlePanel1].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.screenTitlePanel1].height;if(ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,5,1-this.butsY,i,s),saveDataHandler.getCash()>=aUpgradeData[0].aCost[0]&&!saveDataHandler.anyUpgradeBought(curChar)){this.addTextBar(canvas.width-575-75,canvas.height-89+this.butsY,150,36,"#4F8CD0"),addText(0,23,160,"center",canvas.width-575,canvas.height-89+24+this.butsY,"upgrades","#FFFFFF");t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.soloPointer].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.soloPointer].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.soloPointer].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.soloPointer].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width-480+10*Math.sin(.7*this.incY),canvas.height-100+this.butsY,i,s)}addText(2,40,290,"left",35,52-this.butsY,"raceTitle"+raceNum,"#FFFFFF"),addDirectText(2,40,60,"right",400,52-this.butsY,raceNum+1+"/5","#FFFFFF");t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.uiCoin0].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.uiCoin0].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.uiCoin0].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.uiCoin0].height,h=.6;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,.72*canvas.width-i*h+this.cashInc,39-s/2*h-this.butsY,i*h,s*h);for(d=saveDataHandler.getCash().toString();d.length<3;)d="0"+d;for(g=0;g<d.length;g++){m=(R=parseFloat(d.charAt(g)))*this.oNumbers0ImgData.oData.spriteWidth%this.oNumbers0ImgData.img.width,l=Math.floor(R/(this.oNumbers0ImgData.img.width/this.oNumbers0ImgData.oData.spriteWidth))*this.oNumbers0ImgData.oData.spriteHeight;h=Math.min((canvas.width-100-.72*canvas.width)/(this.numberSpace*d.length),.6),ctx.drawImage(this.oNumbers0ImgData.img,m,l,this.oNumbers0ImgData.oData.spriteWidth,this.oNumbers0ImgData.oData.spriteHeight,.72*canvas.width+g*this.numberSpace*h+this.cashInc,39-this.butsY-this.oNumbers0ImgData.oData.spriteHeight/2*h,this.oNumbers0ImgData.oData.spriteWidth*h,this.oNumbers0ImgData.oData.spriteHeight*h)}t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.map].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.map].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.map].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.map].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,.5*canvas.width-i/2-this.posY,.45*canvas.height-s/2,i,s);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+curChar]].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+curChar]].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+curChar]].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+curChar]].height;h=.7,ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,.5*canvas.width-258-this.posY,.45*canvas.height+241-s*h,i*h,s*h);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.mapSpeech].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.mapSpeech].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.mapSpeech].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.mapSpeech].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,.5*canvas.width-120-this.posY,.45*canvas.height+179,i,s),addText(2,30,300,"left",.5*canvas.width-75-this.posY,.45*canvas.height+213,"raceIntro"+raceNum,"#FFFFFF");var F=Math.floor(.5*this.incY)%2;t=this.oUiElementsImgData.oData.oAtlasData[oImageIds["mapCross"+F]].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds["mapCross"+F]].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds["mapCross"+F]].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds["mapCross"+F]].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,.5*canvas.width-i/2+this.aMapPoints[raceNum][0]-this.posY,.45*canvas.height-s/2+ +this.aMapPoints[raceNum][1],i,s);for(g=0;g<raceNum;g++){t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.mapRaceCompletePanel].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.mapRaceCompletePanel].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.mapRaceCompletePanel].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.mapRaceCompletePanel].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,.5*canvas.width-i/2+this.aMapPoints[g][0]-this.posY,.45*canvas.height-s/2+ +this.aMapPoints[g][1],i,s),addText(1,30,45,"center",.5*canvas.width-i/2+this.aMapPoints[g][0]-this.posY+40,.45*canvas.height-s/2+ +this.aMapPoints[g][1]+34,"pos"+aUserRaceResults[g],"#FFFFFF")}break;case"raceSelect":t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].height,h=.1*Math.sin(.5*this.incY)+.1+1;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,0-.5*(canvas.width*h-canvas.width),0-.5*(canvas.height*h-canvas.height),canvas.width*h,canvas.height*h);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.screenTitlePanel1].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.screenTitlePanel1].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.screenTitlePanel1].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.screenTitlePanel1].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,5,1-this.butsY,i,s),addText(2,40,290,"left",35,52-this.butsY,"selectRace","#FFFFFF");t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.uiCoin0].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.uiCoin0].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.uiCoin0].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.uiCoin0].height,h=.6;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,.72*canvas.width-i*h+this.cashInc,39-s/2*h-this.butsY,i*h,s*h);for(d=saveDataHandler.getCash().toString();d.length<3;)d="0"+d;for(g=0;g<d.length;g++){m=(R=parseFloat(d.charAt(g)))*this.oNumbers0ImgData.oData.spriteWidth%this.oNumbers0ImgData.img.width,l=Math.floor(R/(this.oNumbers0ImgData.img.width/this.oNumbers0ImgData.oData.spriteWidth))*this.oNumbers0ImgData.oData.spriteHeight;h=Math.min((canvas.width-100-.72*canvas.width)/(this.numberSpace*d.length),.6),ctx.drawImage(this.oNumbers0ImgData.img,m,l,this.oNumbers0ImgData.oData.spriteWidth,this.oNumbers0ImgData.oData.spriteHeight,.72*canvas.width+g*this.numberSpace*h+this.cashInc,39-this.butsY-this.oNumbers0ImgData.oData.spriteHeight/2*h,this.oNumbers0ImgData.oData.spriteWidth*h,this.oNumbers0ImgData.oData.spriteHeight*h)}t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.map].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.map].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.map].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.map].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,.5*canvas.width-i/2-this.posY,.45*canvas.height-s/2,i,s);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+curChar]].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+curChar]].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+curChar]].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+curChar]].height;h=.7,ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,.5*canvas.width-258-this.posY,.45*canvas.height+241-s*h,i*h,s*h);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.mapSpeech].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.mapSpeech].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.mapSpeech].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.mapSpeech].height;if(ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,.5*canvas.width-120-this.posY,.45*canvas.height+179,i,s),-1!=raceSelected){F=Math.floor(.5*this.incY)%2,t=this.oUiElementsImgData.oData.oAtlasData[oImageIds["mapCross"+F]].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds["mapCross"+F]].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds["mapCross"+F]].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds["mapCross"+F]].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,.5*canvas.width-i/2+this.aMapPoints[raceSelected][0]-this.posY,.45*canvas.height-s/2+ +this.aMapPoints[raceSelected][1],i,s)}addText(2,30,300,"left",.5*canvas.width-75-this.posY,.45*canvas.height+213,-1==raceSelected?"chooseLocation":"raceTitle"+raceNum,"#FFFFFF");break;case"gameEnd0":t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].height,h=.1*Math.sin(.5*this.incY)+.1+1;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,0-.5*(canvas.width*h-canvas.width),0-.5*(canvas.height*h-canvas.height),canvas.width*h,canvas.height*h);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.screenTitlePanel0].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.screenTitlePanel0].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.screenTitlePanel0].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.screenTitlePanel0].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,5,1-this.butsY,i,s),addText(2,40,290,"left",35,52-this.butsY,"raceComplete","#FFFFFF"),addDirectText(2,40,60,"right",400,52-this.butsY,raceNum+1+"/5","#FFFFFF");t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.uiCoin0].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.uiCoin0].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.uiCoin0].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.uiCoin0].height,h=.6;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,.72*canvas.width-i*h+this.cashInc,39-s/2*h-this.butsY,i*h,s*h);for(d=saveDataHandler.getCash().toString();d.length<3;)d="0"+d;for(g=0;g<d.length;g++){m=(R=parseFloat(d.charAt(g)))*this.oNumbers0ImgData.oData.spriteWidth%this.oNumbers0ImgData.img.width,l=Math.floor(R/(this.oNumbers0ImgData.img.width/this.oNumbers0ImgData.oData.spriteWidth))*this.oNumbers0ImgData.oData.spriteHeight;h=Math.min((canvas.width-100-.72*canvas.width)/(this.numberSpace*d.length),.6),ctx.drawImage(this.oNumbers0ImgData.img,m,l,this.oNumbers0ImgData.oData.spriteWidth,this.oNumbers0ImgData.oData.spriteHeight,.72*canvas.width+g*this.numberSpace*h+this.cashInc,39-this.butsY-this.oNumbers0ImgData.oData.spriteHeight/2*h,this.oNumbers0ImgData.oData.spriteWidth*h,this.oNumbers0ImgData.oData.spriteHeight*h)}canvas.width<canvas.height?(P=Math.min((canvas.height-(.18*canvas.height+340))/this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel2].height,1),U=[{x:canvas.width/2+this.aScreenIncs[0],y:.18*canvas.height+100},{x:canvas.width/2-150-this.aScreenIncs[1],y:.18*canvas.height+230},{x:canvas.width/2+180+this.aScreenIncs[2],y:.18*canvas.height+220},{x:canvas.width/2-this.aScreenIncs[3],y:.18*canvas.height+330},{x:canvas.width/2+10*P,y:Math.max(.5*canvas.height,.18*canvas.height+335)+this.aScreenIncs[4]}]):(P=1,U=[{x:.3*canvas.width-this.aScreenIncs[0]-20,y:.2*canvas.height+100},{x:.3*canvas.width-this.aScreenIncs[1]+38-20,y:.2*canvas.height+227},{x:.3*canvas.width-this.aScreenIncs[2]+58-20,y:.2*canvas.height+339},{x:.3*canvas.width-this.aScreenIncs[3]+68-20,y:.2*canvas.height+430},{x:Math.max(.7*canvas.width+this.aScreenIncs[4],.3*canvas.width+370),y:.2*canvas.height}]);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel0A].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel0A].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel0A].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel0A].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,U[0].x-i/2,U[0].y-s,i,s);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+aRacePositions[0].charId]].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+aRacePositions[0].charId]].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+aRacePositions[0].charId]].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+aRacePositions[0].charId]].height;B=.61,ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,U[0].x-211,U[0].y-s*B-9,i*B,s*B);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endCup0].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endCup0].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endCup0].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endCup0].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,U[0].x-37+2*Math.sin(this.incY),U[0].y-142,i,s),addText(2,35,180,"center",U[0].x+50,U[0].y-33,"char"+aRacePositions[0].charId,"#4F8CD0"),addText(1,70,100,"left",U[0].x+45,U[0].y-85,"pos0","#FFFFFF"),h=.8;t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel0A].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel0A].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel0A].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel0A].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,U[1].x-i/2*h,U[1].y-s*h,i*h,s*h);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+aRacePositions[1].charId]].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+aRacePositions[1].charId]].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+aRacePositions[1].charId]].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+aRacePositions[1].charId]].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,U[1].x-211*h,U[1].y-s*B*h-9*h,i*B*h,s*B*h);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endCup1].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endCup1].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endCup1].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endCup1].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,U[1].x-37*h+2*Math.sin(this.incY+1),U[1].y-142*h,i*h,s*h),addText(2,35*h,180*h,"center",U[1].x+50*h,U[1].y-33*h,"char"+aRacePositions[1].charId,"#4F8CD0"),addText(1,70*h,100*h,"left",U[1].x+45*h,U[1].y-85*h,"pos1","#FFFFFF"),h=.7;t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel0A].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel0A].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel0A].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel0A].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,U[2].x-i/2*h,U[2].y-s*h,i*h,s*h);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+aRacePositions[2].charId]].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+aRacePositions[2].charId]].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+aRacePositions[2].charId]].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+aRacePositions[2].charId]].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,U[2].x-211*h,U[2].y-s*B*h-9*h,i*B*h,s*B*h);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endCup2].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endCup2].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endCup2].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endCup2].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,U[2].x-37*h+2*Math.sin(this.incY+2),U[2].y-142*h,i*h,s*h),addText(2,35*h,180*h,"center",U[2].x+50*h,U[2].y-33*h,"char"+aRacePositions[2].charId,"#4F8CD0"),addText(1,70*h,100*h,"left",U[2].x+45*h,U[2].y-85*h,"pos2","#FFFFFF");var T=0;if(userCharPos>2){h=.65;t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel1].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel1].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel1].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel1].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,U[3].x-i/2,U[3].y-s,i,s);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+aRacePositions[userCharPos].charId]].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+aRacePositions[userCharPos].charId]].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+aRacePositions[userCharPos].charId]].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+aRacePositions[userCharPos].charId]].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,U[3].x-200*h,U[3].y-s*B*h-0*h,i*B*h,s*B*h),addText(2,35*h,180*h,"center",U[3].x+50*h,U[3].y-25*h,"char"+aRacePositions[userCharPos].charId,"#FFFFFF"),addText(1,55*h,100*h,"center",U[3].x+45*h,U[3].y-70*h,"pos"+userCharPos,"#4F8CD0")}else canvas.height>canvas.width&&(T=-100);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel2].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel2].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel2].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel2].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,U[4].x-i/2*P,U[4].y+T,i*P,s*P),addText(1,42*P,230,"center",U[4].x-10*P,U[4].y+67*P+T,"leaderboard","#FFFFFF");var H=!1;for(g=0;g<6;g++){if(aLeaderboard[g].charId==curChar||5==g&&!H){M=null;for(var k=0;k<6;k++)if(aRacePositions[k].charId==curChar){M=k;break}for(k=0;k<aLeaderboard.length;k++)if(aLeaderboard[k].charId==curChar){L=k;break}ctx.fillStyle="#FFFFFF",ctx.fillRect(U[4].x-164*P,U[4].y+(107+38*g)*P+T,307*P,37*P),addDirectText(1,32*P,50,"center",U[4].x-135*P,U[4].y+(135+38*g)*P+T,(L+1).toString(),"#4484CB"),addText(0,24*P,150,"left",U[4].x-110*P,U[4].y+(135+38*g)*P-2*P+T,"char"+curChar,"#4484CB"),addDirectText(1,32*P,50,"center",U[4].x+60*P,U[4].y+(135+38*g)*P+T,aLeaderboard[L].score.toString(),"#4484CB"),null!=M&&addDirectText(1,25*P,50,"left",U[4].x+100*P,U[4].y+(135+38*g)*P-6*P+T,"+"+aPosPoints[M],"#FF5500"),H=!0}else if(aLeaderboard[g].charId!=curChar){M=null;for(k=0;k<6;k++)if(aRacePositions[k].charId==aLeaderboard[g].charId){M=k;break}addDirectText(1,32*P,50,"center",U[4].x-135*P,U[4].y+(135+38*g)*P+T,(g+1).toString(),"#FFFFFF"),addText(0,24*P,150,"left",U[4].x-110*P,U[4].y+(135+38*g)*P-2*P+T,"char"+aLeaderboard[g].charId,"#FFFFFF"),addDirectText(1,32*P,50,"center",U[4].x+60*P,U[4].y+(135+38*g)*P+T,aLeaderboard[g].score.toString(),"#FFFFFF"),null!=M&&addDirectText(1,25*P,50,"left",U[4].x+100*P,U[4].y+(135+38*g)*P-6*P+T,"+"+aPosPoints[M],"#FFE230")}}break;case"gameEnd1":t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].height,h=.1*Math.sin(.5*this.incY)+.1+1;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,0-.5*(canvas.width*h-canvas.width),0-.5*(canvas.height*h-canvas.height),canvas.width*h,canvas.height*h);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.screenTitlePanel0].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.screenTitlePanel0].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.screenTitlePanel0].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.screenTitlePanel0].height;if(ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,5,1-this.butsY,i,s),addText(2,40,290,"left",35,52-this.butsY,"raceComplete","#FFFFFF"),saveDataHandler.getCash()>=aUpgradeData[0].aCost[0]&&!saveDataHandler.anyUpgradeBought(curChar)){this.addTextBar(canvas.width-575-75,canvas.height-89-30+this.butsY,150,36,"#4F8CD0"),addText(0,23,160,"center",canvas.width-575,canvas.height-89+24-30+this.butsY,"upgrades","#FFFFFF");t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.soloPointer].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.soloPointer].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.soloPointer].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.soloPointer].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width-480+10*Math.sin(.7*this.incY),canvas.height-100-30+this.butsY,i,s)}t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.uiCoin0].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.uiCoin0].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.uiCoin0].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.uiCoin0].height,h=.6;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,.72*canvas.width-i*h+this.cashInc,39-s/2*h-this.butsY,i*h,s*h);for(d=saveDataHandler.getCash().toString();d.length<3;)d="0"+d;for(g=0;g<d.length;g++){m=(R=parseFloat(d.charAt(g)))*this.oNumbers0ImgData.oData.spriteWidth%this.oNumbers0ImgData.img.width,l=Math.floor(R/(this.oNumbers0ImgData.img.width/this.oNumbers0ImgData.oData.spriteWidth))*this.oNumbers0ImgData.oData.spriteHeight;h=Math.min((canvas.width-100-.72*canvas.width)/(this.numberSpace*d.length),.6),ctx.drawImage(this.oNumbers0ImgData.img,m,l,this.oNumbers0ImgData.oData.spriteWidth,this.oNumbers0ImgData.oData.spriteHeight,.72*canvas.width+g*this.numberSpace*h+this.cashInc,39-this.butsY-this.oNumbers0ImgData.oData.spriteHeight/2*h,this.oNumbers0ImgData.oData.spriteWidth*h,this.oNumbers0ImgData.oData.spriteHeight*h)}t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.makeChallengeBg].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.makeChallengeBg].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.makeChallengeBg].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.makeChallengeBg].height;if(ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width/2-i/2,.45*canvas.height-s/2+this.butsY,i,s),-1==challengeTime)this.addTimeNumbers(raceTime,.5*canvas.width-149,.45*canvas.height-95+this.butsY,.9),addText(1,40,390,"center",canvas.width/2,.45*canvas.height-155+this.butsY,"challengeFriend","#FFFFFF"),addText(0,25,390,"center",canvas.width/2,.45*canvas.height-110+this.butsY,"raceTime","#FFFFFF"),addText(0,25,390,"center",canvas.width/2,.45*canvas.height+20+this.butsY,"shareLink","#FFFFFF"),0==this.copySuccess?addText(0,25,390,"center",canvas.width/2,.45*canvas.height+174+this.butsY,"canBeat","#FFFFFF"):1==this.copySuccess?addText(0,25,390,"center",canvas.width/2,.45*canvas.height+174+this.butsY,"linkCopySuccess","#FFFFFF"):addText(0,25,390,"center",canvas.width/2,.45*canvas.height+174+this.butsY,"linkCopyFail","#FFFFFF");else if(raceTime>challengeTime){this.addTimeNumbers(challengeTime,.5*canvas.width-183,.45*canvas.height-102+this.butsY,.75),this.addTimeNumbers(raceTime,.5*canvas.width-54,.45*canvas.height+45+this.butsY,.6);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.orangeCharBg0].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.orangeCharBg0].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.orangeCharBg0].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.orangeCharBg0].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width/2-i/2+125,.45*canvas.height-s/2-70+this.butsY,i,s);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.orangeCharBg1].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.orangeCharBg1].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.orangeCharBg1].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.orangeCharBg1].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width/2-i/2-125,.45*canvas.height-s/2+65+this.butsY,i,s);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+challengeChar]].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+challengeChar]].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+challengeChar]].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+challengeChar]].height;ctx.save(),ctx.translate(canvas.width/2+183,.45*canvas.height-11+this.butsY),ctx.scale(-.5,.5),ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,0,-s,i,s),ctx.restore();t=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+curChar]].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+curChar]].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+curChar]].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+curChar]].height;B=.5,ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width/2-185,.45*canvas.height-s*B+this.butsY+125,i*B,s*B),addText(1,40,390,"center",canvas.width/2,.45*canvas.height-155+this.butsY,"youLost","#FFFFFF"),addText(0,20,250,"right",canvas.width/2+50,.45*canvas.height-110+this.butsY,"friendsRaceTime","#FFFFFF"),addText(0,20,250,"left",canvas.width/2-50,.45*canvas.height+38+this.butsY,"yourRaceTime","#FFFFFF"),addText(1,40,390,"center",canvas.width/2,.45*canvas.height+170+this.butsY,"tryAgain","#FFFFFF")}else{this.addTimeNumbers(raceTime,.5*canvas.width-55,.45*canvas.height-102+this.butsY,.75),this.addTimeNumbers(challengeTime,.5*canvas.width-135,.45*canvas.height+110+this.butsY,.6);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.orangeCharBg1].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.orangeCharBg1].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.orangeCharBg1].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.orangeCharBg1].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width/2-i/2-125,.45*canvas.height-s/2-70+this.butsY,i,s);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.orangeCharBg0].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.orangeCharBg0].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.orangeCharBg0].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.orangeCharBg0].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width/2-i/2+125,.45*canvas.height-s/2+125+this.butsY,i,s);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+curChar]].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+curChar]].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+curChar]].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+curChar]].height;B=.5,ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,canvas.width/2-185,.45*canvas.height-s*B+this.butsY-10,i*B,s*B);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+challengeChar]].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+challengeChar]].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+challengeChar]].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+challengeChar]].height;ctx.save(),ctx.translate(canvas.width/2+183,.45*canvas.height+184+this.butsY),ctx.scale(-.5,.5),ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,0,-s,i,s),ctx.restore(),addText(1,40,390,"center",canvas.width/2,.45*canvas.height-155+this.butsY,"youWon","#FFFFFF"),addText(0,20,250,"left",canvas.width/2-55,.45*canvas.height-110+this.butsY,"yourRaceTime","#FFFFFF"),addText(0,20,250,"right",canvas.width/2+55,.45*canvas.height+100+this.butsY,"friendsRaceTime","#FFFFFF"),addText(1,50,390,"center",canvas.width/2,.45*canvas.height+40+this.butsY,"congratulations","#FFFFFF")}break;case"tournamentEnd":t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.jaggedFrame].height,h=.1*Math.sin(.5*this.incY)+.1+1;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,0-.5*(canvas.width*h-canvas.width),0-.5*(canvas.height*h-canvas.height),canvas.width*h,canvas.height*h);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.screenTitlePanel1].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.screenTitlePanel1].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.screenTitlePanel1].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.screenTitlePanel1].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,5,1-this.butsY,i,s),addText(2,40,290,"left",35,52-this.butsY,"tournamentComplete","#FFFFFF");t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.uiCoin0].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.uiCoin0].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.uiCoin0].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.uiCoin0].height,h=.6;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,.72*canvas.width-i*h+this.cashInc,39-s/2*h-this.butsY,i*h,s*h);var P,U,B;for(d=saveDataHandler.getCash().toString();d.length<3;)d="0"+d;for(g=0;g<d.length;g++){var R;m=(R=parseFloat(d.charAt(g)))*this.oNumbers0ImgData.oData.spriteWidth%this.oNumbers0ImgData.img.width,l=Math.floor(R/(this.oNumbers0ImgData.img.width/this.oNumbers0ImgData.oData.spriteWidth))*this.oNumbers0ImgData.oData.spriteHeight;h=Math.min((canvas.width-100-.72*canvas.width)/(this.numberSpace*d.length),.6),ctx.drawImage(this.oNumbers0ImgData.img,m,l,this.oNumbers0ImgData.oData.spriteWidth,this.oNumbers0ImgData.oData.spriteHeight,.72*canvas.width+g*this.numberSpace*h+this.cashInc,39-this.butsY-this.oNumbers0ImgData.oData.spriteHeight/2*h,this.oNumbers0ImgData.oData.spriteWidth*h,this.oNumbers0ImgData.oData.spriteHeight*h)}canvas.width<canvas.height?(P=Math.min((canvas.height-(.18*canvas.height+340))/this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel2].height,1),U=[{x:canvas.width/2+this.aScreenIncs[0],y:.18*canvas.height+100},{x:canvas.width/2-150-this.aScreenIncs[1],y:.18*canvas.height+230},{x:canvas.width/2+180+this.aScreenIncs[2],y:.18*canvas.height+220},{x:canvas.width/2-this.aScreenIncs[3],y:.18*canvas.height+330},{x:canvas.width/2+10*P,y:Math.max(.5*canvas.height,.18*canvas.height+335)+this.aScreenIncs[4]}]):(P=1,U=[{x:.3*canvas.width-this.aScreenIncs[0]-20,y:.2*canvas.height+100},{x:.3*canvas.width-this.aScreenIncs[1]+38-20,y:.2*canvas.height+227},{x:.3*canvas.width-this.aScreenIncs[2]+58-20,y:.2*canvas.height+339},{x:.3*canvas.width-this.aScreenIncs[3]+68-20,y:.2*canvas.height+430},{x:Math.max(.7*canvas.width+this.aScreenIncs[4],.3*canvas.width+370),y:.2*canvas.height}]);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel0B].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel0B].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel0B].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel0B].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,U[0].x-i/2,U[0].y-s,i,s);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+aLeaderboard[0].charId]].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+aLeaderboard[0].charId]].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+aLeaderboard[0].charId]].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+aLeaderboard[0].charId]].height;B=.61,ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,U[0].x-211,U[0].y-s*B-9,i*B,s*B);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endCup0].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endCup0].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endCup0].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endCup0].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,U[0].x-37+2*Math.sin(this.incY),U[0].y-142,i,s),addText(2,35,180,"center",U[0].x+50,U[0].y-33,"char"+aLeaderboard[0].charId,"#FF6900"),addText(1,70,100,"left",U[0].x+45,U[0].y-85,"pos0","#FFFFFF"),h=.8;t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel0B].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel0B].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel0B].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel0B].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,U[1].x-i/2*h,U[1].y-s*h,i*h,s*h);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+aLeaderboard[1].charId]].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+aLeaderboard[1].charId]].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+aLeaderboard[1].charId]].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+aLeaderboard[1].charId]].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,U[1].x-211*h,U[1].y-s*B*h-9*h,i*B*h,s*B*h);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endCup1].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endCup1].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endCup1].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endCup1].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,U[1].x-37*h+2*Math.sin(this.incY+1),U[1].y-142*h,i*h,s*h),addText(2,35*h,180*h,"center",U[1].x+50*h,U[1].y-33*h,"char"+aLeaderboard[1].charId,"#FF6900"),addText(1,70*h,100*h,"left",U[1].x+45*h,U[1].y-85*h,"pos1","#FFFFFF"),h=.7;t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel0B].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel0B].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel0B].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel0B].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,U[2].x-i/2*h,U[2].y-s*h,i*h,s*h);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+aLeaderboard[2].charId]].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+aLeaderboard[2].charId]].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+aLeaderboard[2].charId]].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds["charZoom"+aLeaderboard[2].charId]].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,U[2].x-211*h,U[2].y-s*B*h-9*h,i*B*h,s*B*h);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endCup2].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endCup2].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endCup2].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endCup2].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,U[2].x-37*h+2*Math.sin(this.incY+2),U[2].y-142*h,i*h,s*h),addText(2,35*h,180*h,"center",U[2].x+50*h,U[2].y-33*h,"char"+aLeaderboard[2].charId,"#FF6900"),addText(1,70*h,100*h,"left",U[2].x+45*h,U[2].y-85*h,"pos2","#FFFFFF");T=0;canvas.height>canvas.width&&(T=-100);t=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel2].x,e=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel2].y,i=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel2].width,s=this.oUiElementsImgData.oData.oAtlasData[oImageIds.endPanel2].height;ctx.drawImage(this.oUiElementsImgData.img,t,e,i,s,U[4].x-i/2*P,U[4].y+T,i*P,s*P),addText(1,42*P,230,"center",U[4].x-10*P,U[4].y+67*P+T,"leaderboard","#FFFFFF");for(H=!1,g=0;g<6;g++){var M;if(aLeaderboard[g].charId==curChar||5==g&&!H){M=null;for(k=0;k<6;k++)if(aRacePositions[k].charId==curChar){M=k;break}var L;for(k=0;k<aLeaderboard.length;k++)if(aLeaderboard[k].charId==curChar){L=k;break}ctx.fillStyle="#FFFFFF",ctx.fillRect(U[4].x-164*P,U[4].y+(107+38*g)*P+T,307*P,37*P),addDirectText(1,32*P,50,"center",U[4].x-135*P,U[4].y+(135+38*g)*P+T,(L+1).toString(),"#4484CB"),addText(0,24*P,150,"left",U[4].x-110*P,U[4].y+(135+38*g)*P-2*P+T,"char"+curChar,"#4484CB"),addDirectText(1,32*P,50,"center",U[4].x+60*P,U[4].y+(135+38*g)*P+T,aLeaderboard[L].score.toString(),"#4484CB"),H=!0}else if(aLeaderboard[g].charId!=curChar){M=null;for(k=0;k<6;k++)if(aRacePositions[k].charId==aLeaderboard[g].charId){M=k;break}addDirectText(1,32*P,50,"center",U[4].x-135*P,U[4].y+(135+38*g)*P+T,(g+1).toString(),"#FFFFFF"),addText(0,24*P,150,"left",U[4].x-110*P,U[4].y+(135+38*g)*P-2*P+T,"char"+aLeaderboard[g].charId,"#FFFFFF"),addDirectText(1,32*P,50,"center",U[4].x+60*P,U[4].y+(135+38*g)*P+T,aLeaderboard[g].score.toString(),"#FFFFFF")}}}a&&this.addButs(ctx)},t.prototype.addTimeNumbers=function(a,t,e,i){var s=Math.floor((a-6e3*Math.floor(a/6e3))/100).toString();s.length<2&&(s="0"+s);var h,o=a.toString().charAt(a.toString().length-2)+a.toString().charAt(a.toString().length-1);o.length<2&&(o="0"+o);for(var r=Math.floor(a/6e3).toString(),n=0;n<2;n++){if(h=parseFloat(r.charAt(n)),r.length<2){if(0==n)continue;h=parseFloat(r.charAt(0))}var d=h*this.oNumbers0ImgData.oData.spriteWidth%this.oNumbers0ImgData.img.width,g=Math.floor(h/(this.oNumbers0ImgData.img.width/this.oNumbers0ImgData.oData.spriteWidth))*this.oNumbers0ImgData.oData.spriteHeight;ctx.drawImage(this.oNumbers0ImgData.img,d,g,this.oNumbers0ImgData.oData.spriteWidth,this.oNumbers0ImgData.oData.spriteHeight,t,e,this.oNumbers0ImgData.oData.spriteWidth*i,this.oNumbers0ImgData.oData.spriteHeight*i)}d=(h=10)*this.oNumbers0ImgData.oData.spriteWidth%this.oNumbers0ImgData.img.width,g=Math.floor(h/(this.oNumbers0ImgData.img.width/this.oNumbers0ImgData.oData.spriteWidth))*this.oNumbers0ImgData.oData.spriteHeight;ctx.drawImage(this.oNumbers0ImgData.img,d,g,this.oNumbers0ImgData.oData.spriteWidth,this.oNumbers0ImgData.oData.spriteHeight,t+50*i,e,this.oNumbers0ImgData.oData.spriteWidth*i,this.oNumbers0ImgData.oData.spriteHeight*i);for(n=0;n<2;n++){d=(h=parseFloat(s.charAt(n)))*this.oNumbers0ImgData.oData.spriteWidth%this.oNumbers0ImgData.img.width,g=Math.floor(h/(this.oNumbers0ImgData.img.width/this.oNumbers0ImgData.oData.spriteWidth))*this.oNumbers0ImgData.oData.spriteHeight;ctx.drawImage(this.oNumbers0ImgData.img,d,g,this.oNumbers0ImgData.oData.spriteWidth,this.oNumbers0ImgData.oData.spriteHeight,t+100*i+n*this.numberSpace*i,e,this.oNumbers0ImgData.oData.spriteWidth*i,this.oNumbers0ImgData.oData.spriteHeight*i)}for(n=0;n<2;n++){d=(h=parseFloat(o.charAt(n)))*this.oNumbers0ImgData.oData.spriteWidth%this.oNumbers0ImgData.img.width,g=Math.floor(h/(this.oNumbers0ImgData.img.width/this.oNumbers0ImgData.oData.spriteWidth))*this.oNumbers0ImgData.oData.spriteHeight;ctx.drawImage(this.oNumbers0ImgData.img,d,g,this.oNumbers0ImgData.oData.spriteWidth,this.oNumbers0ImgData.oData.spriteHeight,t+235*i+n*this.numberSpace*.6*i,e+4,.6*this.oNumbers0ImgData.oData.spriteWidth*i,.6*this.oNumbers0ImgData.oData.spriteHeight*i)}},t.prototype.addButs=function(a){for(var t=!1,e=0;e<this.aButs.length;e++)if(this.aButs[e].isOver){t=!0;break}for(e=0;e<this.aButs.length;e++){var i,s=0;0!=this.incY&&this.aButs[e].flash&&(s=this.aButs[e].isOver?3*Math.sin(2*(this.incY+2.5*e)):3*Math.sin(this.incY+2.5*e)),this.aButs[e].scale||(this.aButs[e].scale=1),l=this.aButs[e].oImgData.oData.oAtlasData[this.aButs[e].id].x,c=this.aButs[e].oImgData.oData.oAtlasData[this.aButs[e].id].y,I=this.aButs[e].oImgData.oData.oAtlasData[this.aButs[e].id].width,u=this.aButs[e].oImgData.oData.oAtlasData[this.aButs[e].id].height;var h=canvas.width*this.aButs[e].align[0],o=canvas.height*this.aButs[e].align[1];i=o+this.aButs[e].aPos[1]>canvas.height/2&&"charSelect"!=gameState?this.butsY:-this.butsY,this.aButs[e].aOverData=new Array(h+this.aButs[e].aPos[0]-I/2*this.aButs[e].scale-s/2,o+this.aButs[e].aPos[1]-u/2*this.aButs[e].scale+i+s/2,h+this.aButs[e].aPos[0]+I/2*this.aButs[e].scale-s/2,o+this.aButs[e].aPos[1]+u/2*this.aButs[e].scale+i+s/2),this.aButs[e].isOver&&this.aButs[e].flash&&(a.save(),a.translate(h+this.aButs[e].aPos[0],o+this.aButs[e].aPos[1]),a.scale(.7+s/50,.7+s/50),a.globalAlpha=1,a.rotate(this.incY/7),a.drawImage(this.oTopFlareImgData.img,-this.oTopFlareImgData.img.width/2,-this.oTopFlareImgData.img.height/2),a.restore()),a.drawImage(this.aButs[e].oImgData.img,l,c,I,u,this.aButs[e].aOverData[0],this.aButs[e].aOverData[1],I*this.aButs[e].scale+s,u*this.aButs[e].scale-s),(this.aButs[e].isOver||this.aButs[e].flash)&&(a.save(),this.aButs[e].isOver?a.globalAlpha=1:a.globalAlpha=t?Math.max(Math.sin(this.incY/2),0)/2:Math.max(Math.sin(this.incY/2+e),0),l=this.aButs[e].oImgData.oData.oAtlasData[this.aButs[e].idOver].x,c=this.aButs[e].oImgData.oData.oAtlasData[this.aButs[e].idOver].y,I=this.aButs[e].oImgData.oData.oAtlasData[this.aButs[e].idOver].width,u=this.aButs[e].oImgData.oData.oAtlasData[this.aButs[e].idOver].height,a.drawImage(this.aButs[e].oImgData.img,l,c,I,u,this.aButs[e].aOverData[0],this.aButs[e].aOverData[1],I*this.aButs[e].scale+s,u*this.aButs[e].scale-s),a.restore())}if("charSelect"==gameState){var r=1,n=saveDataHandler.getCash();if(canvas.height>canvas.width){for(var d=0;d<14;d++)if(r=Math.min((canvas.height-400)/460,1),!saveDataHandler.getCharLockStatus(d)){var g=oImageIds.costPanel0,m="#838383";if(n>=aCharData[d].cost){g=oImageIds.costPanel1;m="#FF5600"}var l=this.oUiElementsImgData.oData.oAtlasData[g].x,c=this.oUiElementsImgData.oData.oAtlasData[g].y,I=this.oUiElementsImgData.oData.oAtlasData[g].width,u=this.oUiElementsImgData.oData.oAtlasData[g].height;a.drawImage(this.oUiElementsImgData.img,l,c,I,u,canvas.width/2-I/2*r+d%5*(138*r)-276*r,148*Math.floor(d/5)*r+110*r+75+i,I*r,u*r),addDirectText(2,28*r,50,"left",canvas.width/2-I/2*r+d%5*(138*r)-230*r,148*Math.floor(d/5)*r+143*r+73+i,aCharData[d].cost.toString(),m)}}else for(d=0;d<14;d++)if(r=Math.min((canvas.width-20)/965,1),!saveDataHandler.getCharLockStatus(d)){g=oImageIds.costPanel0,m="#838383";if(n>=aCharData[d].cost){g=oImageIds.costPanel1;m="#FF5600"}l=this.oUiElementsImgData.oData.oAtlasData[g].x,c=this.oUiElementsImgData.oData.oAtlasData[g].y,I=this.oUiElementsImgData.oData.oAtlasData[g].width,u=this.oUiElementsImgData.oData.oAtlasData[g].height;a.drawImage(this.oUiElementsImgData.img,l,c,I,u,canvas.width/2-I/2*r+d%7*(138*r)-414*r,148*Math.floor(d/7)*r+110*r+75+i,I*r,u*r),addDirectText(2,28*r,50,"left",canvas.width/2-I/2*r+d%7*(138*r)-368*r,148*Math.floor(d/7)*r+143*r+73+i,aCharData[d].cost.toString(),m)}}else if("upgrades"==gameState)for(r=1,n=saveDataHandler.getCash(),d=0;d<9;d++)if(canvas.height>canvas.width){if(r=Math.min((canvas.height-400)/460,1),0==saveDataHandler.getUpgradeLockStatus(curChar,d)||d<=2&&saveDataHandler.getUpgradeLockStatus(curChar,d)<=4){g=oImageIds.costPanel0,m="#838383";var D=saveDataHandler.getStatBonus(d);if(n>=aUpgradeData[d].aCost[D]){g=oImageIds.costPanel1;m="#FF5600"}l=this.oUiElementsImgData.oData.oAtlasData[g].x,c=this.oUiElementsImgData.oData.oAtlasData[g].y,I=this.oUiElementsImgData.oData.oAtlasData[g].width,u=this.oUiElementsImgData.oData.oAtlasData[g].height;a.drawImage(this.oUiElementsImgData.img,l,c,I,u,canvas.width/2-I/2*r+d%3*(138*r)-138*r,148*Math.floor(d/3)*r+110*r+75+i,I*r,u*r),addDirectText(2,32*r,50,"left",canvas.width/2-I/2*r+d%3*(138*r)-92*r,148*Math.floor(d/3)*r+143*r+75+i,aUpgradeData[d].aCost[D].toString(),m)}d<=2&&addText(2,20*r,70,"center",canvas.width/2+d%3*(138*r)-138*r,148*Math.floor(d/3)*r+106*r+75+i,"upgradeBut"+d,"#FFFFFF")}else{if(r=Math.min((canvas.width-20)/965,1),0==saveDataHandler.getUpgradeLockStatus(curChar,d)||d<=2&&saveDataHandler.getUpgradeLockStatus(curChar,d)<=4){g=oImageIds.costPanel0,m="#838383",D=saveDataHandler.getStatBonus(d);if(n>=aUpgradeData[d].aCost[D]){g=oImageIds.costPanel1;m="#FF5600"}l=this.oUiElementsImgData.oData.oAtlasData[g].x,c=this.oUiElementsImgData.oData.oAtlasData[g].y,I=this.oUiElementsImgData.oData.oAtlasData[g].width,u=this.oUiElementsImgData.oData.oAtlasData[g].height;a.drawImage(this.oUiElementsImgData.img,l,c,I,u,canvas.width/2-I/2*r+d%5*(138*r)-276*r,148*Math.floor(d/5)*r+110*r+75+i,I*r,u*r),addDirectText(2,32*r,50,"left",canvas.width/2-I/2*r+d%5*(138*r)-230*r,148*Math.floor(d/5)*r+143*r+75+i,aUpgradeData[d].aCost[D].toString(),m)}d<=2&&addText(2,20*r,70,"center",canvas.width/2+d%5*(138*r)-276*r,148*Math.floor(d/5)*r+106*r+75+i,"upgradeBut"+d,"#FFFFFF")}else"gameEnd1"==gameState&&-1==challengeTime&&(addText(2,50,280,"center",canvas.width/2+20-1.5,.45*canvas.height+104+this.butsY-1.5,"copyLink","#A43500"),addText(2,50,280,"center",canvas.width/2+20+1.5,.45*canvas.height+104+this.butsY+1.5,"copyLink","#FFFFFF"),addText(2,50,280,"center",canvas.width/2+20,.45*canvas.height+104+this.butsY,"copyLink","#FF5500"))},t}();a.Panel=t}(Elements||(Elements={})),function(a){var t=function(){function a(){this.oTextData={},this.inc=0,this.createTextObjects()}return a.prototype.createTextObjects=function(){for(var a in assetLib.textData.langText.text[curLang])this.oTextData[a]={},this.oTextData[a].aLineData=this.getCharData(assetLib.textData.langText.text[curLang][a]["@text"],assetLib.textData.langText.text[curLang][a]["@fontId"]),this.oTextData[a].aLineWidths=this.getLineWidths(this.oTextData[a].aLineData),this.oTextData[a].blockWidth=this.getBlockWidth(this.oTextData[a].aLineData),this.oTextData[a].blockHeight=this.getBlockHeight(this.oTextData[a].aLineData,assetLib.textData.langText.text[curLang][a]["@fontId"]),this.oTextData[a].lineHeight=parseInt(assetLib.textData["fontData"+assetLib.textData.langText.text[curLang][a]["@fontId"]].text.common["@lineHeight"]),this.oTextData[a].oFontImgData=assetLib.getData("font"+assetLib.textData.langText.text[curLang][a]["@fontId"])},a.prototype.getLineWidths=function(a){for(var t,e=new Array,i=0;i<a.length;i++){t=0;for(var s=0;s<a[i].length;s++)t+=parseInt(a[i][s]["@xadvance"]),0==s?t-=parseInt(a[i][s]["@xoffset"]):s==a[i].length-1&&(t+=parseInt(a[i][s]["@xoffset"]));e.push(t)}return e},a.prototype.getBlockWidth=function(a){for(var t,e=0,i=0;i<a.length;i++){t=0;for(var s=0;s<a[i].length;s++)t+=parseInt(a[i][s]["@xadvance"]),0==s?t-=parseInt(a[i][s]["@xoffset"]):s==a[i].length-1&&(t+=parseInt(a[i][s]["@xoffset"]));t>e&&(e=t)}return e},a.prototype.getBlockHeight=function(a,t){return a.length*parseInt(assetLib.textData["fontData"+t].text.common["@lineHeight"])},a.prototype.getCharData=function(a,t){for(var e=new Array,i=0;i<a.length;i++){e[i]=new Array;for(var s=0;s<a[i].length;s++)for(var h=0;h<assetLib.textData["fontData"+t].text.chars.char.length;h++)a[i][s].charCodeAt(0)==assetLib.textData["fontData"+t].text.chars.char[h]["@id"]&&e[i].push(assetLib.textData["fontData"+t].text.chars.char[h])}return e},a.prototype.renderText=function(a){var t,e=this.oTextData[a.text].aLineData,i=this.oTextData[a.text].oFontImgData,s=0,h=0,o=0,r=1,n=0;a.lineOffsetY&&(o=a.lineOffsetY),a.scale&&(r=a.scale);var d=1*r;a.maxWidth&&this.oTextData[a.text].blockWidth*r>a.maxWidth&&(d=a.maxWidth/this.oTextData[a.text].blockWidth),a.anim&&(this.inc+=7*delta);for(var g=0;g<e.length;g++){t=0,"centre"==a.alignX&&(s=this.oTextData[a.text].aLineWidths[g]/2),"centre"==a.alignY&&(h=this.oTextData[a.text].blockHeight/2+o*(e.length-1)/2);for(var m=0;m<e[g].length;m++){var l=e[g][m]["@x"],c=e[g][m]["@y"],I=e[g][m]["@width"],u=e[g][m]["@height"];a.anim&&(n=Math.sin(this.inc+m/2)*(u/15*d)),ctx.drawImage(i.img,l,c,I,u,a.x+(t+parseInt(e[g][m]["@xoffset"])-s)*d,a.y+(parseInt(e[g][m]["@yoffset"])+g*this.oTextData[a.text].lineHeight+g*o-h)*d+n,I*d,u*d),t+=parseInt(e[g][m]["@xadvance"])}}},a}();a.TextDisplay=t}(Utils||(Utils={})),function(a){var t=function(){function a(){switch(this.inc=0,this.roadSegWidth=40,this.smootheScaleRate=.8,this.roadSegDepth=50,this.roadSteerAngle=0,this.horizon=300,this.steer=0,this.carPosTarg=.5,this.carPos=.5,this.nearWidthRate=5,this.heightRate=300,this.roadCurveEase=0,this.roadCurveEaseTarg=0,this.roadCurveEaseInc=0,this.roadCurveEaseDuration=0,this.roadHillEase=0,this.roadHillEaseTarg=0,this.roadHillEaseInc=0,this.roadHillEaseDuration=0,this.bgHillEase0=0,this.bgHillEaseTarg0=0,this.bgHillEaseInc0=0,this.bgHillEaseDuration0=0,this.bgHillEase1=0,this.bgHillEaseTarg1=0,this.bgHillEaseInc1=0,this.bgHillEaseDuration1=0,this.tiltEase=.1,this.tiltEaseTarg=0,this.tiltEaseInc=0,this.tiltEaseDuration=0,this.ditchEase0=.5,this.ditchEaseTarg0=0,this.ditchEaseInc0=0,this.ditchEaseDuration0=0,this.ditchEase1=.5,this.ditchEaseTarg1=0,this.ditchEaseInc1=0,this.ditchEaseDuration1=0,this.roadWidthEase=40,this.roadWidthEaseTarg=0,this.roadWidthEaseInc=0,this.roadWidthEaseDuration=0,this.curvePattern=0,this.horizonX0=0,this.horizonX1=-Math.max(1200,canvas.width),this.horizonY=0,this.distObjectNum=5,this.testing=!1,this.enemyReleaseTarg=25,this.enemyReleaseInc=20,this.sideBounceInc=0,this.segsSinceJump=0,this.segsSincePickUp=0,this.coinRow=-10,this.cointTot=5,this.coinPos=.5,this.roadWidthChange=!0,this.pickUpCount=-1,this.magnetCount=0,this.bannerInc=-1,"start"==gameState?raceNum=0:"charSelect"==gameState&&(raceNum=3),this.oHorizonImgData=assetLib.getData("horizon"+raceNum),this.oGameElementsImgData=assetLib.getData("gameElements"),raceNum){case 0:this.heightRate=200;break;case 1:this.heightRate=100;break;case 2:this.heightRate=200;break;case 3:this.heightRate=100;break;case 4:this.heightRate=300}this.aRoad=new Array,this.aRaceColours=new Array({sky:"#9ADFFF",ground:"#282828",verge0:"#ABA162",verge1:"#C2B46C",skidLines0:"#4F4F4F",skidLines1:"#2C2C2C",streetLines:"#BBBBBB",shards:"#AFAFAF",jump0:"#7A7A7A",jump1:"#A4A4A4",jump2:"#BFBFBF"},{sky:"#7BC1FF",ground:"#C47B4A",verge0:"#FCBE61",verge1:"#F2AE6A",skidLines0:"#F2AE6A",skidLines1:"#D9934D",streetLines:"#F0C786",shards:"#FFCC80",jump0:"#793C25",jump1:"#935D29",jump2:"#A16830"},{sky:"#A091FA",ground:"#7C3723",verge0:"#D99363",verge1:"#E1835C",skidLines0:"#622913",skidLines1:"#954F3B",streetLines:"#F7C8A4",shards:"#E9A373",jump0:"#E9A373",jump1:"#FFB0A1",jump2:"#FFD2B1"},{sky:"#34254E",ground:"#181F4D",verge0:"#80397E",verge1:"#AA3C76",skidLines0:"#1D4F5C",skidLines1:"#081F25",streetLines:"#F4C4B4",shards:"#FF74AB",jump0:"#80397E",jump1:"#C35A92",jump2:"#FF77AD"},{sky:"#87E1FF",ground:"#F1FCFC",verge0:"#AFD5FF",verge1:"#B2E9FC",skidLines0:"#D0F2FF",skidLines1:"#E5E5E5",streetLines:"#AFE9FF",shards:"#AFD5FF",jump0:"#AAB1FF",jump1:"#C4D7FF",jump2:"#DDE9FF"});var a=this.getRoadColours();this.aRoad.push({id:0,tilt:0,height:0,angle:0,hillHeight0:0,hillHeight1:0,ditch0:0,ditch1:0,centre:{x:0,y:0},leftSide:{x:-this.roadSegWidth,y:0},rightSide:{x:this.roadSegWidth,y:0},leftDistObject0:1*Math.random(),rightDistObject0:1*Math.random(),leftObjectType0:Math.floor(Math.random()*this.distObjectNum),rightObjectType0:Math.floor(Math.random()*this.distObjectNum),leftDistObject1:1*Math.random(),rightDistObject1:1*Math.random(),leftObjectType1:Math.floor(Math.random()*this.distObjectNum),rightObjectType1:Math.floor(Math.random()*this.distObjectNum),mergeInc:1,jump:0,pickUp:0,lines:[Math.random(),Math.random(),Math.random(),Math.random()],roadSegWidth:this.roadSegWidth,roadColours:a,leftCliff:0,rightCliff:0,bannerId:this.bannerInc}),this.newRoadEase(!0),this.newRoadCurveEase(!0),this.newTiltEase(!0),this.newBgHillEase0(),this.newBgHillEase1(),this.newDitchEase0(),this.newDitchEase1(),this.newRoadWidthEase();for(var t=0;t<30;t++)this.addRoadSeg(!1)}return a.prototype.newRoadEase=function(a){void 0===a&&(a=!1),a?(this.roadHillEaseTarg=1,this.roadHillEaseInc=0,this.roadHillEaseDuration=20):(this.roadHillEaseTarg=1*Math.random()-.3,this.roadHillEaseInc=0,this.roadHillEaseDuration=15*Math.random()+8)},a.prototype.newRoadCurveEase=function(a){if(void 0===a&&(a=!1),a)this.curvePattern=0,this.roadCurveEaseInc=0,this.roadCurveEaseDuration=20;else{if(1==this.curvePattern&&Math.random()>.5)return this.curvePattern=0,this.roadCurveEaseInc=0,void(this.roadCurveEaseDuration=15*Math.random()+5);this.curvePattern=1,Math.random()>.25?(this.roadCurveEaseTarg<0?this.roadCurveEaseTarg=6*Math.random()-1:this.roadCurveEaseTarg>0?this.roadCurveEaseTarg=6*Math.random()-5:this.roadCurveEaseTarg=10*Math.random()-5,this.roadCurveEaseInc=0,this.roadCurveEaseDuration=15*Math.random()+5):(this.roadCurveEaseTarg=0,this.roadCurveEaseInc=0,this.roadCurveEaseDuration=30*Math.random()+20)}},a.prototype.newRoadWidthEase=function(){this.roadWidthChange?(this.roadWidthEaseTarg=10*Math.ceil(4*Math.random()),this.roadWidthEaseInc=0,this.roadWidthEaseDuration=2*Math.random()+2,this.roadWidthChange=!1):(this.roadWidthEaseInc=0,this.roadWidthEaseDuration=20*Math.random()+20,this.roadWidthChange=!0)},a.prototype.newTiltEase=function(a){void 0===a&&(a=!1),a?(this.tiltEaseTarg=0,this.tiltEaseInc=0,this.tiltEaseDuration=20):(this.tiltEaseTarg=.2*Math.random()-.1,this.tiltEaseInc=0,this.tiltEaseDuration=20*Math.random()+10)},a.prototype.newBgHillEase0=function(){this.bgHillEaseTarg0=400*Math.random()-200,this.bgHillEaseInc0=0,this.bgHillEaseDuration0=20*Math.random()+10},a.prototype.newBgHillEase1=function(){this.bgHillEaseTarg1=400*Math.random()-200,this.bgHillEaseInc1=0,this.bgHillEaseDuration1=20*Math.random()+10},a.prototype.newDitchEase0=function(){this.ditchEaseTarg0=20*Math.random()+3,this.ditchEaseInc0=0,this.ditchEaseDuration0=5*Math.random()+5},a.prototype.newDitchEase1=function(){this.ditchEaseTarg1=20*Math.random()+3,this.ditchEaseInc1=0,this.ditchEaseDuration1=5*Math.random()+5},a.prototype.addRoadSeg=function(a){void 0===a&&(a=!0);var t=!1;if(this.aRoad[this.aRoad.length-1].id==raceLength&&"game"==gameState&&(t=!0),this.aRoad[0].id==raceLength&&"game"==gameState&&(panel.tweenFinish(),0==gameType)){for(var e=0;e<aLeaderboard.length;e++)for(var i=0;i<aRacePositions.length;i++)aLeaderboard[e].charId==aRacePositions[i].charId&&(aLeaderboard[e].score+=aPosPoints[i]);aUserRaceResults.push(userCharPos),aLeaderboard.sort(function(a,t){return t.score-a.score});for(e=aLeaderboard.length-1;e>0;e--)if(aLeaderboard[e].score==aLeaderboard[e-1].score&&aLeaderboard[e].charId==curChar){var s=aLeaderboard[e];aLeaderboard[e]=aLeaderboard[e-1],aLeaderboard[e-1]=s}}var h=1;if(a){this.aRoad.shift(),this.inc-=1;for(i=0;i<aEnemySkaters.length;i++)aEnemySkaters[i].segId-=1;userSkater.segId-=1,h=0}this.roadHillEaseInc++;var o=this.easeInOutQuad(this.roadHillEaseInc,this.roadHillEase,this.roadHillEaseTarg-this.roadHillEase,this.roadHillEaseDuration);this.roadHillEaseInc>=this.roadHillEaseDuration&&(this.roadHillEase=o,this.newRoadEase()),this.roadCurveEaseInc++;var r=this.easeInOutQuad(this.roadCurveEaseInc,this.roadCurveEase,this.roadCurveEaseTarg-this.roadCurveEase,this.roadCurveEaseDuration);this.roadCurveEaseInc>=this.roadCurveEaseDuration&&(this.roadCurveEase=r,this.newRoadCurveEase()),this.tiltEaseInc++;var n=this.easeInOutQuad(this.tiltEaseInc,this.tiltEase,this.tiltEaseTarg-this.tiltEase,this.tiltEaseDuration);this.tiltEaseInc>=this.tiltEaseDuration&&(this.tiltEase=n,this.newTiltEase()),this.bgHillEaseInc0++;var d=this.easeInOutQuad(this.bgHillEaseInc0,this.bgHillEase0,this.bgHillEaseTarg0-this.bgHillEase0,this.bgHillEaseDuration0);this.bgHillEaseInc0>=this.bgHillEaseDuration0&&(this.bgHillEase0=d,this.newBgHillEase0()),this.bgHillEaseInc1++;var g=this.easeInOutQuad(this.bgHillEaseInc1,this.bgHillEase1,this.bgHillEaseTarg1-this.bgHillEase1,this.bgHillEaseDuration1);this.bgHillEaseInc1>=this.bgHillEaseDuration1&&(this.bgHillEase1=g,this.newBgHillEase1()),this.ditchEaseInc0++;var m=this.easeInOutQuad(this.ditchEaseInc0,this.ditchEase0,this.ditchEaseTarg0-this.ditchEase0,this.ditchEaseDuration0);this.ditchEaseInc0>=this.ditchEaseDuration0&&(this.ditchEase0=m,this.newDitchEase0()),this.ditchEaseInc1++;var l=this.easeInOutQuad(this.ditchEaseInc1,this.ditchEase1,this.ditchEaseTarg1-this.ditchEase1,this.ditchEaseDuration1);this.ditchEaseInc1>=this.ditchEaseDuration1&&(this.ditchEase1=l,this.newDitchEase1()),a?(this.roadWidthEaseInc++,this.roadSegWidth=this.easeInOutQuad(this.roadWidthEaseInc,this.roadWidthEase,this.roadWidthEaseTarg-this.roadWidthEase,this.roadWidthEaseDuration),this.roadWidthEaseInc>=this.roadWidthEaseDuration&&(this.roadWidthEase=this.roadSegWidth,this.newRoadWidthEase())):this.roadSegWidth=40;var c=this.aRoad.length-1,I=this.aRoad[c].angle+r,u=this.aRoad[c].centre.x+this.roadSegDepth*Math.cos((I-90)*radian),D=this.aRoad[c].centre.y+this.roadSegDepth*Math.sin((I-90)*radian),p=u-this.roadSegWidth*Math.cos(I*radian),v=D-this.roadSegWidth*Math.sin(I*radian),x=u+this.roadSegWidth*Math.cos(I*radian),w=D+this.roadSegWidth*Math.sin(I*radian),f=0,y=-1;raceNum>0&&Math.random()<.05&&a&&this.segsSinceJump>20&&Math.abs(I-this.aRoad[c].angle)<1&&"game"==gameState?(f=Math.round(Math.random())+1,this.segsSinceJump=0):a&&(++this.coinRow>0||Math.random()<.1)&&"game"==gameState&&this.aRoad[c].id+1<=raceLength&&0==gameType&&(y=.6*Math.random()+.2,this.coinRow<=this.cointTot?addTrackObject("coin",this.aRoad[c].id+1):this.coinRow>this.cointTot&&(0!=userCharPos&&addTrackObject("pickUp",this.aRoad[c].id+1,++this.pickUpCount%3),this.cointTot=8*Math.random()+8,this.coinRow=-(10*Math.random()+70)));var E=20*Math.random()-10,A=this.getRoadColours(o,E,t),S=0,b=0;2==raceNum?(this.roadSegWidth>15?(S=200*Math.random()+25,b=200*Math.random()+25,m*=.1,l*=.1):(S=50*Math.random()+25,b=50*Math.random()+25),d=Math.abs(d),g=Math.abs(g)):1==raceNum?(S=50*Math.random()+50,b=50*Math.random()+50):4==raceNum&&(this.roadSegWidth>15?(S=50*Math.random()+25,b=50*Math.random()+25,m*=.2,l*=.2):(S=50*Math.random()+25,b=50*Math.random()+25),d=Math.abs(d),g=Math.abs(g)),this.segsSinceJump++,this.aRoad[c].id%15==0&&(this.bannerInc=(this.bannerInc+1)%15),this.aRoad.push({id:this.aRoad[c].id+1,tilt:n,height:o,hillHeight0:d,hillHeight1:g,ditch0:m,ditch1:l,angle:I,centre:{x:u,y:D},centreSide:{x:u,y:D},leftSide:{x:p,y:v},rightSide:{x:x,y:w},leftDistObject0:1*Math.random()+.1,rightDistObject0:1*Math.random()+.1,leftObjectType0:Math.floor(Math.random()*this.distObjectNum),rightObjectType0:Math.floor(Math.random()*this.distObjectNum),leftDistObject1:1*Math.random()+.1,rightDistObject1:1*Math.random()+.1,leftObjectType1:Math.floor(Math.random()*this.distObjectNum),rightObjectType1:Math.floor(Math.random()*this.distObjectNum),mergeInc:h,jump:f,pickUp:y,lines:[Math.random(),Math.random(),Math.random(),Math.random()],roadSegWidth:this.roadSegWidth,roadColours:A,leftCliff:S,rightCliff:b,bannerId:this.bannerInc})},a.prototype.getRoadColours=function(a,t,e){var i;if(void 0===a&&(a=0),void 0===t&&(t=0),void 0===e&&(e=!1),e)switch(raceNum){case 0:i={wide:"rgba(224,224,224,",thin:"rgba(224,224,224,",field0:"rgba("+(96+t)+", "+(160+t)+",  "+(59+t)+","};break;case 1:i={wide:"rgba(236,229,216,",thin:"rgba(236,229,216,",field0:"rgba("+(250+t)+", "+(210+t)+",  "+(127+t)+","};break;case 2:i={wide:"rgba(255,210,170,",thin:"rgba(255,210,170,",field0:"rgba("+(177+t)+", "+(84+t)+",  "+(39+t)+","};break;case 3:i={wide:"rgba(231,182,202,",thin:"rgba(231,182,202,",field0:"rgba("+(155+t)+", "+(62+t)+",  "+(128+t)+","};break;case 4:i={wide:"rgba(111,116,170,",thin:"rgba(111,116,170,",field0:"rgba("+(255+t)+", "+(255+t)+",  "+(255+t)+","}}else switch(raceNum){case 0:i={wide:"rgba("+(40+10*Math.random()-5+50*a)+", "+(40+10*Math.random()-5+50*a)+",  "+(40+10*Math.random()-5+50*a)+",",thin:"rgba("+(77+10*Math.random()-5+50*a)+", "+(59+10*Math.random()-5+50*a)+",  "+(24+10*Math.random()-5+50*a)+",",field0:"rgba("+(96+t)+", "+(160+t)+",  "+(59+t)+","};break;case 1:i={wide:"rgba("+(196+10*Math.random()-5+50*a)+", "+(123+10*Math.random()-5+50*a)+",  "+(74+10*Math.random()-5+50*a)+",",thin:"rgba("+(229+10*Math.random()-5+50*a)+", "+(160+10*Math.random()-5+50*a)+",  "+(86+10*Math.random()-5+50*a)+",",field0:"rgba("+(250+t)+", "+(210+t)+",  "+(127+t)+","};break;case 2:i={wide:"rgba("+(124+10*Math.random()-5+50*a)+", "+(55+10*Math.random()-5+50*a)+",  "+(35+10*Math.random()-5+50*a)+",",thin:"rgba("+(163+10*Math.random()-5+50*a)+", "+(101+10*Math.random()-5+50*a)+",  "+(53+10*Math.random()-5+50*a)+",",field0:"rgba("+(177+t)+", "+(84+t)+",  "+(39+t)+","};break;case 3:i={wide:"rgba("+(24+10*Math.random()-5+50*a)+", "+(31+10*Math.random()-5+50*a)+",  "+(77+10*Math.random()-5+50*a)+",",thin:"rgba("+(71+10*Math.random()-5+50*a)+", "+(44+10*Math.random()-5+50*a)+",  "+(87+10*Math.random()-5+50*a)+",",field0:"rgba("+(155+t)+", "+(62+t)+",  "+(128+t)+","};break;case 4:i={wide:"rgba("+(241+10*Math.random()-5+50*a)+", "+(252+10*Math.random()-5+50*a)+",  "+(252+10*Math.random()-5+50*a)+",",thin:"rgba("+(198+10*Math.random()-5+50*a)+", "+(253+10*Math.random()-5+50*a)+",  "+(255+10*Math.random()-5+50*a)+",",field0:"rgba("+(255+t)+", "+(255+t)+",  "+(255+t)+","}}return i},a.prototype.rotateAround=function(a,t){var e=Math.cos(this.roadSteerAngle),i=Math.sin(this.roadSteerAngle),s=e*(a-canvas.width/2)+(i*(t-700)+canvas.width/2),h=e*(t-700)-i*(a-canvas.width/2)+700;h=.5*h+350;var o=this.easeInCubic(h,0,700,700);return[s,(h=.8*this.easeInExpo(h,0,700,700))+140+(canvas.height-700),h*(this.nearWidthRate*this.carPos)*1.5,h*(this.nearWidthRate*(1-this.carPos))*1.5,h,o,h*(this.nearWidthRate*(.5-this.carPos))*1.5]},a.prototype.easeInExpo=function(a,t,e,i){return 0==a?t:e*Math.pow(10,10*(a/i-1))+t},a.prototype.easeInCubic=function(a,t,e,i){return e*(a/=i)*a*a+t},a.prototype.easeInOutQuad=function(a,t,e,i){return(a/=i/2)<1?e/2*a*a+t:-e/2*(--a*(a-2)-1)+t},a.prototype.easeInQuad=function(a,t,e,i){return e*(a/=i)*a+t},a.prototype.easeOutQuad=function(a,t,e,i){return-e*(a/=i)*(a-2)+t},a.prototype.easeOutSine=function(a,t,e,i){return e*Math.sin(a/i*(Math.PI/2))+t},a.prototype.easeInSine=function(a,t,e,i){return-e*Math.cos(a/i*(Math.PI/2))+e+t},a.prototype.update=function(){this.magnetCount>0?this.magnetCount-=delta:this.magnetCount=0,this.horizonStretchWidth=Math.max(canvas.width,this.oHorizonImgData.img.width),this.steer=1*(rightSteer+leftSteer),userSkater.jumpHeight<-50&&(this.steer=0),"game"==gameState&&(this.carPosTarg-=this.steer*(userSkater.steerPower/Math.max(userSkater.speed/userSkater.maxSpeed,.4))*userSkater.speed*delta,this.aRoad[0].id<raceLength?this.carPosTarg-=(this.aRoad[1].angle-this.aRoad[0].angle)*(userSkater.speed*userSkater.drag)*delta:rightSteer=leftSteer=0,this.carPos+=5*(this.carPosTarg-this.carPos)*delta,this.carPos<.05?(this.carPos=.05,this.carPosTarg=.05,playSound("hitWall"+Math.floor(3*Math.random())),this.sideBounceTween&&this.sideBounceTween.kill(),this.sideBounceInc=.05,this.sideBounceTween=TweenLite.to(this,.5,{sideBounceInc:0,ease:"Cubic.easeOut"}),userSkater.triggerCrash(),1==userSkater.speedControlState&&(userSkater.speed*=.2)):this.carPos>.95&&(this.carPos=.95,this.carPosTarg=.95,playSound("hitWall"+Math.floor(3*Math.random())),this.sideBounceTween&&this.sideBounceTween.kill(),this.sideBounceInc=-.05,this.sideBounceTween=TweenLite.to(this,.5,{sideBounceInc:0,ease:"Cubic.easeOut"}),userSkater.triggerCrash(),1==userSkater.speedControlState&&(userSkater.speed*=.2)),this.carPosTarg+=this.sideBounceInc),userSkater.segSeg+=userSkater.speed*delta,this.inc+=delta*userSkater.speed;var a,t=this.aRoad[Math.floor(this.inc)].centre.x+(this.aRoad[Math.floor(this.inc)+1].centre.x-this.aRoad[Math.floor(this.inc)].centre.x)*(this.inc%1),e=this.aRoad[Math.floor(this.inc)].centre.y+(this.aRoad[Math.floor(this.inc)+1].centre.y-this.aRoad[Math.floor(this.inc)].centre.y)*(this.inc%1),i=(this.aRoad[Math.floor(this.inc)].angle+(this.aRoad[Math.floor(this.inc)+1].angle-this.aRoad[Math.floor(this.inc)].angle)*(this.inc%1))*radian;this.x=t-canvas.width/2,this.y=e-700,this.roadSteerAngle=i;var s=(this.aRoad[1].angle-this.aRoad[0].angle)*this.aRoad[0].tilt;this.aRoad[0].angle-this.aRoad[1].angle<0&&this.aRoad[0].tilt>0||this.aRoad[0].angle-this.aRoad[1].angle>0&&this.aRoad[0].tilt<0?(a=this.rotateAround(this.aRoad[1].leftSide.x-this.x,this.aRoad[1].leftSide.y-this.y))[1]+this.aRoad[1].height*this.heightRate-a[4]*s>canvas.height&&this.inc>1&&this.addRoadSeg():(a=this.rotateAround(this.aRoad[1].rightSide.x-this.x,this.aRoad[1].rightSide.y-this.y))[1]+this.aRoad[1].height*this.heightRate+a[4]*s>canvas.height&&this.inc>1&&this.addRoadSeg();var h=(this.aRoad[1].angle-this.aRoad[0].angle)*delta*25*userSkater.speed;this.horizonX0-=h,this.horizonX1-=h,this.horizonX0>this.horizonStretchWidth?this.horizonX0-=2*this.horizonStretchWidth:this.horizonX0<-this.horizonStretchWidth&&(this.horizonX0+=2*this.horizonStretchWidth),this.horizonX1>this.horizonStretchWidth?this.horizonX1-=2*this.horizonStretchWidth:this.horizonX1<-this.horizonStretchWidth&&(this.horizonX1+=2*this.horizonStretchWidth),this.horizonY+=1*(-200*this.aRoad[1].height-this.horizonY)*delta*2*.1},a.prototype.render=function(){ctx.fillStyle=this.aRaceColours[raceNum].sky,ctx.fillRect(0,0,canvas.width,this.horizonY+(canvas.height-550)),ctx.fillStyle=this.aRaceColours[raceNum].ground,ctx.fillRect(0,this.horizonY+(canvas.height-550),canvas.width,canvas.height),this.testing||(ctx.drawImage(this.oHorizonImgData.img,0,0,this.oHorizonImgData.img.width,this.oHorizonImgData.img.height,this.horizonX0,this.horizonY-this.oHorizonImgData.img.height/2+(canvas.height-550),this.horizonStretchWidth+2,this.oHorizonImgData.img.height),ctx.drawImage(this.oHorizonImgData.img,0,0,this.oHorizonImgData.img.width,this.oHorizonImgData.img.height,this.horizonX1,this.horizonY-this.oHorizonImgData.img.height/2+(canvas.height-550),this.horizonStretchWidth+2,this.oHorizonImgData.img.height)),panel.lightningScale<1&&(ctx.fillStyle="rgba(0,0,0,"+(.5*Math.random()+.5)+")",ctx.fillRect(0,0,canvas.width,canvas.height));for(var a=this.aRoad.length-1;a>0;a--){var t=this.aRoad[a].tilt,e=t;if(a<this.aRoad.length-1)e=this.aRoad[a+1].tilt;var i=.6*Math.min((this.aRoad.length-(a-1-this.inc))/(this.aRoad.length*this.smootheScaleRate),1)+.4,s=.6*Math.min((this.aRoad.length-(a-this.inc))/(this.aRoad.length*this.smootheScaleRate),1)+.4,h=this.rotateAround(this.aRoad[a-1].leftSide.x-this.x,this.aRoad[a-1].leftSide.y-this.y),o=this.rotateAround(this.aRoad[a-1].rightSide.x-this.x,this.aRoad[a-1].rightSide.y-this.y),r=this.rotateAround(this.aRoad[a].rightSide.x-this.x,this.aRoad[a].rightSide.y-this.y),n=this.rotateAround(this.aRoad[a].leftSide.x-this.x,this.aRoad[a].leftSide.y-this.y),d=this.rotateAround(this.aRoad[a-1].centre.x-this.x,this.aRoad[a-1].centre.y-this.y),g=this.rotateAround(this.aRoad[a].centre.x-this.x,this.aRoad[a].centre.y-this.y),m=h[0]-h[2]+.2*h[4],l=h[1]+this.aRoad[a-1].height*this.heightRate-h[4]*t*.92,c=o[0]+o[3]-.2*o[4],I=o[1]+this.aRoad[a-1].height*this.heightRate+o[4]*t*.92,u=m+.5*(c-m)*(1-i),D=c+.5*(m-c)*(1-i),p=r[0]+r[3]-.2*r[4],v=r[1]+this.aRoad[a].height*this.heightRate+r[4]*e*.92,x=n[0]-n[2]+.2*n[4],w=n[1]+this.aRoad[a].height*this.heightRate-n[4]*e*.92,f=p+.5*(x-p)*(1-s),y=x+.5*(p-x)*(1-s);h[4],this.aRoad[a-1].mergeInc=Math.min(this.aRoad[a-1].mergeInc+1*delta,1);var E=4e-4*h[5]+(.02*h[4]+.06)*this.aRoad[a-1].mergeInc,A=4e-4*n[5]+(.02*n[4]+.06)*this.aRoad[a].mergeInc,S=h[0]-h[2]-h[4]*this.aRoad[a-1].ditch0,b=n[0]-n[2]-n[4]*this.aRoad[a].ditch0,C=o[0]+o[3]+o[4]*this.aRoad[a-1].ditch1,F=r[0]+r[3]+r[4]*this.aRoad[a].ditch1,T=S+.5*(C-S)*(1-i)*.8-this.aRoad[a-1].ditch0*i,H=b+.5*(F-b)*(1-s)*.8-this.aRoad[a].ditch0*s,k=C+.5*(S-C)*(1-i)*.8+this.aRoad[a-1].ditch0*i,P=F+.5*(b-F)*(1-s)*.8+this.aRoad[a].ditch0*s;ctx.fillStyle=this.aRoad[a-1].roadColours.field0+this.aRoad[a].mergeInc+")",ctx.beginPath();var U,B,R=(U=Math.min(h[0]-h[2]-canvas.width-100*h[4],0))+.75*(T-U),M=h[1]+this.aRoad[a-1].height*this.heightRate-this.aRoad[a-1].height*this.aRoad[a-1].hillHeight0*(1+.15*h[4])-this.aRoad[a-1].leftCliff*E*2,L=T,O=h[1]+this.aRoad[a-1].height*this.heightRate-h[4]*t-this.aRoad[a-1].leftCliff*E,Y=(B=Math.min(n[0]-n[2]-canvas.width-100*n[4],0))+.75*(H-B),N=n[1]+this.aRoad[a].height*this.heightRate-this.aRoad[a].height*this.aRoad[a].hillHeight0*(1+.15*n[4])-this.aRoad[a].leftCliff*A*2,j=B,G=(n[1],this.aRoad[a].height,this.heightRate,this.aRoad[a].height);if(ctx.moveTo(U,M),ctx.quadraticCurveTo(U+(R-U)/2,M-this.aRoad[a-1].hillHeight0*this.aRoad[a-1].height,R,M),ctx.lineTo(L,O),this.aRoad[a-1].leftHillTop={x:R,y:M},this.aRoad[a-1].leftVergeEdge={x:L,y:O},ctx.lineTo(H,n[1]+this.aRoad[a].height*this.heightRate-n[4]*e-this.aRoad[a].leftCliff*A),ctx.lineTo(Y,N),ctx.quadraticCurveTo(Y+(j-Y)/2,N-this.aRoad[a].hillHeight0*this.aRoad[a].height,j,N),ctx.fill(),ctx.beginPath(),ctx.moveTo(k,o[1]+this.aRoad[a-1].height*this.heightRate+o[4]*t-this.aRoad[a-1].rightCliff*E),R=(U=Math.max(o[0]+o[3]+canvas.width+100*o[4],canvas.width))+.75*(k-U),M=o[1]+this.aRoad[a-1].height*this.heightRate-this.aRoad[a-1].height*this.aRoad[a-1].hillHeight1*(1+.15*o[4])-this.aRoad[a-1].rightCliff*E*2,L=Math.max(o[0]+o[3]+canvas.width+100*o[4],canvas.width),O=o[1]+this.aRoad[a-1].height*this.heightRate-200*this.aRoad[a-1].height,Y=(B=Math.max(r[0]+r[3]+canvas.width+100*r[4],canvas.width))+.75*(P-B),N=r[1]+this.aRoad[a].height*this.heightRate-this.aRoad[a].height*this.aRoad[a].hillHeight1*(1+.15*r[4])-this.aRoad[a].rightCliff*A*2,j=P,G=r[1]+this.aRoad[a].height*this.heightRate+r[4]*e-this.aRoad[a].rightCliff*A,ctx.lineTo(R,M),ctx.quadraticCurveTo(R+(L-R)/2,M-this.aRoad[a-1].hillHeight1*this.aRoad[a-1].height,L,M),this.aRoad[a-1].rightHillTop={x:R,y:M},this.aRoad[a-1].rightVergeEdge={x:k,y:o[1]+this.aRoad[a-1].height*this.heightRate+o[4]*t-this.aRoad[a-1].rightCliff*E},ctx.lineTo(B,N),ctx.quadraticCurveTo(B+(Y-B)/2,N-this.aRoad[a].hillHeight1*this.aRoad[a].height,Y,N),ctx.lineTo(j,G),ctx.fill(),this.aRoad[a-1].id%2==0?ctx.fillStyle=this.aRaceColours[raceNum].verge0:ctx.fillStyle=this.aRaceColours[raceNum].verge1,ctx.beginPath(),ctx.moveTo(T,h[1]+this.aRoad[a-1].height*this.heightRate-h[4]*t-this.aRoad[a-1].leftCliff*E),ctx.lineTo(u,h[1]+this.aRoad[a-1].height*this.heightRate-h[4]*t*.92),ctx.lineTo(y,n[1]+this.aRoad[a].height*this.heightRate-n[4]*e*.92),ctx.lineTo(H,n[1]+this.aRoad[a].height*this.heightRate-n[4]*e-this.aRoad[a].leftCliff*A),ctx.fill(),ctx.beginPath(),ctx.moveTo(D,o[1]+this.aRoad[a-1].height*this.heightRate+o[4]*t*.92),ctx.lineTo(k,o[1]+this.aRoad[a-1].height*this.heightRate+o[4]*t-this.aRoad[a-1].rightCliff*E),ctx.lineTo(P,r[1]+this.aRoad[a].height*this.heightRate+r[4]*e-this.aRoad[a].rightCliff*A),ctx.lineTo(f,r[1]+this.aRoad[a].height*this.heightRate+r[4]*e*.92),ctx.fill(),this.aRoad[a-1].roadSegWidth>15?ctx.fillStyle=this.aRoad[a-1].roadColours.wide+this.aRoad[a].mergeInc+")":ctx.fillStyle=this.aRoad[a-1].roadColours.thin+this.aRoad[a].mergeInc+")",ctx.beginPath(),ctx.moveTo(u,l+1),ctx.lineTo(D,I+1),ctx.lineTo(f,v),ctx.lineTo(y,w),ctx.fill(),!this.testing){ctx.lineWidth=.03*h[4];for(var W=0;W<this.aRoad[a].lines.length;W++)ctx.strokeStyle=W<2?this.aRaceColours[raceNum].skidLines0:this.aRaceColours[raceNum].skidLines1,ctx.beginPath(),ctx.moveTo(u+(D-u)*this.aRoad[a].lines[W],l+(I-l)*this.aRoad[a].lines[W]),ctx.lineTo(y+(f-y)*this.aRoad[a].lines[W],w+(v-w)*this.aRoad[a].lines[W]),ctx.stroke();if(this.aRoad[a].id%2==0&&(ctx.strokeStyle=this.aRaceColours[raceNum].streetLines,this.aRoad[a].roadSegWidth>15&&this.aRoad[a].roadSegWidth<=25?(ctx.beginPath(),ctx.moveTo(u+.5*(D-u),l+.5*(I-l)),ctx.lineTo(y+.5*(f-y),w+.5*(v-w)),ctx.stroke()):this.aRoad[a].roadSegWidth>15&&this.aRoad[a].roadSegWidth<=32?(ctx.beginPath(),ctx.moveTo(u+.35*(D-u),l+.35*(I-l)),ctx.lineTo(y+.35*(f-y),w+.35*(v-w)),ctx.stroke(),ctx.beginPath(),ctx.moveTo(u+.65*(D-u),l+.65*(I-l)),ctx.lineTo(y+.65*(f-y),w+.65*(v-w)),ctx.stroke()):this.aRoad[a].roadSegWidth>15&&this.aRoad[a].roadSegWidth<=40&&(ctx.beginPath(),ctx.moveTo(u+.25*(D-u),l+.25*(I-l)),ctx.lineTo(y+.25*(f-y),w+.25*(v-w)),ctx.stroke(),ctx.beginPath(),ctx.moveTo(u+.5*(D-u),l+.5*(I-l)),ctx.lineTo(y+.5*(f-y),w+.5*(v-w)),ctx.stroke(),ctx.beginPath(),ctx.moveTo(u+.75*(D-u),l+.75*(I-l)),ctx.lineTo(y+.75*(f-y),w+.75*(v-w)),ctx.stroke())),this.aRoad[a].roadSegWidth>15){ctx.strokeStyle="rgba(30, 26, 22,"+this.aRoad[a].mergeInc+")";ctx.lineWidth=.04*h[4]+1,ctx.beginPath(),ctx.moveTo(u,l-20*E),ctx.lineTo(y,w-20*A),ctx.lineTo(y,w),ctx.stroke(),ctx.beginPath(),ctx.moveTo(D,I-20*E),ctx.lineTo(f,v-20*A),ctx.lineTo(f,v),ctx.stroke(),this.aRoad[a].id%10==0&&(ctx.strokeStyle="rgba(105, 68, 31,"+this.aRoad[a].mergeInc+")",ctx.lineWidth=.05*h[4]+1,ctx.beginPath(),ctx.moveTo(f,v-200*A),ctx.lineTo(f,v),ctx.stroke(),ctx.lineWidth=.03*h[4]+1,ctx.beginPath(),ctx.moveTo(f-30*A,v-190*A),ctx.lineTo(f+30*A,v-190*A),ctx.stroke())}else ctx.strokeStyle="rgba(255, 250, 231,"+this.aRoad[a].mergeInc+")",ctx.lineWidth=.05*h[4]+1,this.aRoad[a].id%2==0?(ctx.beginPath(),ctx.moveTo(y,w-10*A),ctx.lineTo(y,w),ctx.stroke(),ctx.beginPath(),ctx.moveTo(D,I-10*E),ctx.lineTo(f,v-10*A),ctx.lineTo(f,v),ctx.stroke()):(ctx.beginPath(),ctx.moveTo(u,l-10*E),ctx.lineTo(y,w-10*A),ctx.lineTo(y,w),ctx.stroke(),ctx.beginPath(),ctx.moveTo(f,v-10*A),ctx.lineTo(f,v),ctx.stroke());E=Math.min(1.2*(E+E*E*E),10);var X=this.oGameElementsImgData.oData.oAtlasData[oImageIds["roadSide"+raceNum+this.aRoad[a-1].leftObjectType0]].x,z=this.oGameElementsImgData.oData.oAtlasData[oImageIds["roadSide"+raceNum+this.aRoad[a-1].leftObjectType0]].y,Z=this.oGameElementsImgData.oData.oAtlasData[oImageIds["roadSide"+raceNum+this.aRoad[a-1].leftObjectType0]].width,V=this.oGameElementsImgData.oData.oAtlasData[oImageIds["roadSide"+raceNum+this.aRoad[a-1].leftObjectType0]].height,K=0;(this.aRoad[a].roadSegWidth<15||this.aRoad[a].id>=raceLength||this.aRoad[a].id<10||this.aRoad[a].id%10==0||this.aRoad[a].angle-this.aRoad[a-1].angle>1.5||this.aRoad[a].angle-this.aRoad[a-1].angle<-1.5)&&(this.aRoad[a-1].leftDistObject0=.1,this.aRoad[a-1].rightDistObject0=.1,this.aRoad[a].id>=raceLength&&"game"==gameState?(X=this.oGameElementsImgData.oData.oAtlasData[oImageIds.endBanner].x,z=this.oGameElementsImgData.oData.oAtlasData[oImageIds.endBanner].y,Z=this.oGameElementsImgData.oData.oAtlasData[oImageIds.endBanner].width,V=this.oGameElementsImgData.oData.oAtlasData[oImageIds.endBanner].height):"game"==gameState&&this.aRoad[a].id<10||this.aRoad[a].id%15==0?(X=this.oGameElementsImgData.oData.oAtlasData[oImageIds["raceBanner"+this.aRoad[a].bannerId]].x,z=this.oGameElementsImgData.oData.oAtlasData[oImageIds["raceBanner"+this.aRoad[a].bannerId]].y,Z=this.oGameElementsImgData.oData.oAtlasData[oImageIds["raceBanner"+this.aRoad[a].bannerId]].width,V=this.oGameElementsImgData.oData.oAtlasData[oImageIds["raceBanner"+this.aRoad[a].bannerId]].height):this.aRoad[a].angle-this.aRoad[a-1].angle>1.5?(X=this.oGameElementsImgData.oData.oAtlasData[oImageIds.rightSign].x,z=this.oGameElementsImgData.oData.oAtlasData[oImageIds.rightSign].y,Z=this.oGameElementsImgData.oData.oAtlasData[oImageIds.rightSign].width,V=this.oGameElementsImgData.oData.oAtlasData[oImageIds.rightSign].height,K=1):this.aRoad[a].angle-this.aRoad[a-1].angle<-1.5&&(K=2)),ctx.drawImage(this.oGameElementsImgData.img,X,z,Z,V,this.aRoad[a-1].leftVergeEdge.x-(this.aRoad[a-1].leftVergeEdge.x-this.aRoad[a-1].leftHillTop.x)*this.aRoad[a-1].leftDistObject0*i-Z*E,this.aRoad[a-1].leftVergeEdge.y-(this.aRoad[a-1].leftVergeEdge.y-this.aRoad[a-1].leftHillTop.y)*this.aRoad[a-1].leftDistObject0*i-V*E,Z*E,V*E),1==K?(X=this.oGameElementsImgData.oData.oAtlasData[oImageIds["roadSide"+raceNum+this.aRoad[a-1].leftObjectType0]].x,z=this.oGameElementsImgData.oData.oAtlasData[oImageIds["roadSide"+raceNum+this.aRoad[a-1].leftObjectType0]].y,Z=this.oGameElementsImgData.oData.oAtlasData[oImageIds["roadSide"+raceNum+this.aRoad[a-1].leftObjectType0]].width,V=this.oGameElementsImgData.oData.oAtlasData[oImageIds["roadSide"+raceNum+this.aRoad[a-1].leftObjectType0]].height):2==K&&(X=this.oGameElementsImgData.oData.oAtlasData[oImageIds.leftSign].x,z=this.oGameElementsImgData.oData.oAtlasData[oImageIds.leftSign].y,Z=this.oGameElementsImgData.oData.oAtlasData[oImageIds.leftSign].width,V=this.oGameElementsImgData.oData.oAtlasData[oImageIds.leftSign].height),ctx.drawImage(this.oGameElementsImgData.img,X,z,Z,V,this.aRoad[a-1].rightVergeEdge.x-(this.aRoad[a-1].rightVergeEdge.x-this.aRoad[a-1].rightHillTop.x)*this.aRoad[a-1].rightDistObject0*i,this.aRoad[a-1].rightVergeEdge.y-(this.aRoad[a-1].rightVergeEdge.y-this.aRoad[a-1].rightHillTop.y)*this.aRoad[a-1].rightDistObject0*i-V*E,Z*E,V*E);X=this.oGameElementsImgData.oData.oAtlasData[oImageIds["roadSide"+raceNum+this.aRoad[a-1].leftObjectType1]].x,z=this.oGameElementsImgData.oData.oAtlasData[oImageIds["roadSide"+raceNum+this.aRoad[a-1].leftObjectType1]].y,Z=this.oGameElementsImgData.oData.oAtlasData[oImageIds["roadSide"+raceNum+this.aRoad[a-1].leftObjectType1]].width,V=this.oGameElementsImgData.oData.oAtlasData[oImageIds["roadSide"+raceNum+this.aRoad[a-1].leftObjectType1]].height;ctx.drawImage(this.oGameElementsImgData.img,X,z,Z,V,this.aRoad[a-1].leftVergeEdge.x-(this.aRoad[a-1].leftVergeEdge.x-this.aRoad[a-1].leftHillTop.x)*this.aRoad[a-1].leftDistObject1*i-Z*E,this.aRoad[a-1].leftVergeEdge.y-(this.aRoad[a-1].leftVergeEdge.y-this.aRoad[a-1].leftHillTop.y)*this.aRoad[a-1].leftDistObject1*i-V*E,Z*E,V*E),ctx.drawImage(this.oGameElementsImgData.img,X,z,Z,V,this.aRoad[a-1].rightVergeEdge.x-(this.aRoad[a-1].rightVergeEdge.x-this.aRoad[a-1].rightHillTop.x)*this.aRoad[a-1].rightDistObject*i,this.aRoad[a-1].rightVergeEdge.y-(this.aRoad[a-1].rightVergeEdge.y-this.aRoad[a-1].rightHillTop.y)*this.aRoad[a-1].rightDistObject*i-V*E,Z*E,V*E)}if(1==this.aRoad[a].jump?(ctx.fillStyle=this.aRaceColours[raceNum].jump0,ctx.beginPath(),ctx.moveTo(d[0]+d[6],d[1]+this.aRoad[a-1].height*this.heightRate),ctx.lineTo(g[0]+g[6],g[1]+this.aRoad[a].height*this.heightRate-8-.8*g[4]),ctx.lineTo(g[0]+g[6],g[1]+this.aRoad[a].height*this.heightRate),ctx.fill(),ctx.fillStyle=this.aRaceColours[raceNum].jump1,ctx.beginPath(),ctx.moveTo(u,l),ctx.lineTo(d[0]+d[6],d[1]+this.aRoad[a-1].height*this.heightRate),ctx.lineTo(g[0]+g[6],g[1]+this.aRoad[a].height*this.heightRate-8-.8*g[4]),ctx.lineTo(y,w-8-.8*n[4]),ctx.fill(),ctx.fillStyle=this.aRaceColours[raceNum].jump2,ctx.beginPath(),ctx.moveTo(u,l),ctx.lineTo(d[0]+d[6],d[1]+this.aRoad[a-1].height*this.heightRate),ctx.lineTo(y+(g[0]+g[6]-y)/2,w-8-.8*n[4]),ctx.fill()):2==this.aRoad[a].jump&&(ctx.fillStyle=this.aRaceColours[raceNum].jump0,ctx.beginPath(),ctx.moveTo(d[0]+d[6],d[1]+this.aRoad[a-1].height*this.heightRate),ctx.lineTo(g[0]+g[6],g[1]+this.aRoad[a].height*this.heightRate-8-.8*g[4]),ctx.lineTo(g[0]+g[6],g[1]+this.aRoad[a].height*this.heightRate),ctx.fill(),ctx.fillStyle=this.aRaceColours[raceNum].jump1,ctx.beginPath(),ctx.moveTo(D,I),ctx.lineTo(d[0]+d[6],d[1]+this.aRoad[a-1].height*this.heightRate),ctx.lineTo(g[0]+g[6],g[1]+this.aRoad[a].height*this.heightRate-8-.8*g[4]),ctx.lineTo(f,v-8-.8*r[4]),ctx.fill(),ctx.fillStyle=this.aRaceColours[raceNum].jump2,ctx.beginPath(),ctx.moveTo(D,I),ctx.lineTo(d[0]+d[6],d[1]+this.aRoad[a-1].height*this.heightRate),ctx.lineTo(f+(g[0]+g[6]-f)/2,v-8-.8*r[4]),ctx.fill()),this.aRoad[a].pickUp>0)for(W=0;W<aTrackObjects.length;W++)this.aRoad[a].id==aTrackObjects[W].id&&(aTrackObjects[W].hasHit||(aTrackObjects[W].x=u+(D-u)*this.aRoad[a].pickUp,aTrackObjects[W].y=d[1]+this.aRoad[a-1].height*this.heightRate,aTrackObjects[W].scaleX=aTrackObjects[W].scaleY=2*(.09*(.001*r[5]+(.02*r[4]+.06))+.09*(.001*n[5]+(.02*n[4]+.06))),aTrackObjects[W].x>userSkater.x-200&&aTrackObjects[W].x<userSkater.x+200&&aTrackObjects[W].y>userSkater.y+200-100&&aTrackObjects[W].y<userSkater.y+200+100?aTrackObjects[W].hit():this.magnetCount>0&&aTrackObjects[W].y>userSkater.y-100&&aTrackObjects[W].hit(!0),aTrackObjects[W].update(),aTrackObjects[W].render()));a==Math.floor(userSkater.segId)&&(userSkater.roadY0=l,userSkater.roadY1=I,userSkater.roadY2=v,userSkater.roadY3=w);for(W=0;W<aEnemySkaters.length;W++)a==Math.floor(aEnemySkaters[W].segId)&&0==aEnemySkaters[W].offscreenState?(aEnemySkaters[W].roadX0=u,aEnemySkaters[W].roadY0=l,aEnemySkaters[W].roadX1=D,aEnemySkaters[W].roadY1=I,aEnemySkaters[W].roadX2=f,aEnemySkaters[W].roadY2=v,aEnemySkaters[W].roadX3=y,aEnemySkaters[W].roadY3=w,aEnemySkaters[W].roadPrevScale=(.09*(.001*h[5]+(.02*h[4]+.06))+.09*(.001*o[5]+(.02*o[4]+.06)))/2,aEnemySkaters[W].roadScale=(.09*(.001*r[5]+(.02*r[4]+.06))+.09*(.001*n[5]+(.02*n[4]+.06)))/2,aEnemySkaters[W].update(),aEnemySkaters[W].render()):aEnemySkaters[W].segId<0&&0==aEnemySkaters[W].offscreenState&&aEnemySkaters[W].offScreenEnd();ghostSkater&&this.aRoad[a].id==ghostSkater.segId&&(ghostSkater.roadX0=u,ghostSkater.roadY0=l,ghostSkater.roadX1=D,ghostSkater.roadY1=I,ghostSkater.roadX2=f,ghostSkater.roadY2=v,ghostSkater.roadX3=y,ghostSkater.roadY3=w,ghostSkater.roadPrevScale=(.09*(.001*h[5]+(.02*h[4]+.06))+.09*(.001*o[5]+(.02*o[4]+.06)))/2,ghostSkater.roadScale=(.09*(.001*r[5]+(.02*r[4]+.06))+.09*(.001*n[5]+(.02*n[4]+.06)))/2,ghostSkater.update(),ghostSkater.render())}},a}();a.Ground=t}(Elements||(Elements={})),function(a){var t=function(){function t(){if(this.y=0,this.roadTilt=0,this.steerLean=0,this.speed=0,this.maxSpeed=6.5,this.roadY0=0,this.roadY1=0,this.roadY2=0,this.roadY3=0,this.segSeg=0,this.segId=0,this.speedControlState=0,this.jumpHeight=0,this.jumpSpeed=0,this.isEnemy=!1,this.boostSpeed=0,this.shakeInc=0,this.bonusId=-1,this.drag=.03,this.steerPower=.09,this.accPower=3,this.raceStarted=!1,this.dustSoundDelay=0,this.charId=curChar,this.oGameElementsImgData=assetLib.getData("gameElements"),this.oVehiclesImgData=assetLib.getData("vehicles"),this.segId=2,"game"==gameState){this.charRider=new a.CharRider(curChar),this.vehicleId=curChar,this.drag=.03,this.steerPower=.085+(aCharData[curChar].stats[1]+.042*saveDataHandler.getStatBonus(1))/17,this.accPower=1.6+5*(aCharData[curChar].stats[0]+.042*saveDataHandler.getStatBonus(0)),this.maxSpeed+=3*(aCharData[curChar].stats[2]+.042*saveDataHandler.getStatBonus(2));for(var t=saveDataHandler.getVehicleData(curChar),e=0;e<t.length;e++)if(2==t[e]){this.vehicleId=14+e+3*aCharData[curChar].vehicleType;break}for(t=saveDataHandler.getBonusData(curChar),e=0;e<t.length;e++)if(2==t[e]){this.bonusId=e;break}}"game"!=gameState?this.speed=5:this.startRace()}return t.prototype.startRace=function(){var a=this;this.speedTween&&this.speedTween.kill(),this.speedTween=TweenLite.to(this,2.9,{speed:this.maxSpeed,delay:1.3+1.1,ease:"Quad.easeInOut",onComplete:function(){a.speedControlState=1},onStart:function(){a.charRider.setAnimType("once","startGo"),a.raceStarted=!0}})},t.prototype.triggerJump=function(){var a=this;this.jumpSpeedTween&&this.jumpSpeedTween.kill(),playSound("jump"),this.charRider.setAnimType("once","jump"),this.jumpSpeed=0,this.jumpSpeedTween=TweenLite.to(this,1+.1*(aCharData[curChar].stats[2]+.042*saveDataHandler.getStatBonus(2)),{jumpSpeed:2,ease:"Quad.easeIn",onComplete:function(){a.jumpSpeedTween=TweenLite.to(a,1,{jumpSpeed:0,ease:"Quad.easeOut",onComplete:function(){}})}}),this.jumpTween&&this.jumpTween.kill(),this.jumpTween=TweenLite.to(this,.4,{jumpHeight:-300,ease:"Quad.easeOut",onComplete:function(){a.jumpTween=TweenLite.to(a,1,{jumpHeight:0,ease:"Bounce.easeOut",onComplete:function(){}})}})},t.prototype.triggerCrash=function(){var a=this;this.jumpSpeedTween&&this.jumpSpeedTween.kill(),this.jumpSpeed=0,this.boostTween&&this.boostTween.kill(),this.boostSpeed=0,this.jumpTween&&this.jumpTween.kill(),this.jumpTween=TweenLite.to(this,.2,{jumpHeight:-200,ease:"Quad.easeOut",onComplete:function(){a.jumpTween=TweenLite.to(a,.8,{jumpHeight:0,ease:"Bounce.easeOut",onComplete:function(){}})}})},t.prototype.hitBoost=function(){var a=this;this.boostTween&&this.boostTween.kill(),this.boostTween=TweenLite.to(this,.3+.1*(aCharData[curChar].stats[2]+.042*saveDataHandler.getStatBonus(2)),{boostSpeed:3,ease:"Quad.easeIn",onComplete:function(){a.boostTween=TweenLite.to(a,1,{boostSpeed:0,delay:.5,ease:"Quad.easeOut",onComplete:function(){}})}})},t.prototype.update=function(){if(this.x=canvas.width/2,"game"==gameState){1==this.speedControlState&&(this.speed=Math.min(this.speed+delta*this.accPower,this.maxSpeed)+this.jumpSpeed+this.boostSpeed),panel.jaggedFrameScale=Math.max(1.5-.2*(this.jumpSpeed+this.boostSpeed)+.05*Math.sin(panel.incY)+(1-this.speed/this.maxSpeed),1),this.steerLean+=(ground.steer-this.steerLean)*(.005*this.speed),this.rotation=.3*-this.steerLean,0==this.jumpHeight&&(this.rotation>.1?Math.random()<2*this.rotation&&(this.dustSoundDelay>.1&&(playSound("dust"),this.dustSoundDelay=0),Math.random()<.5?addParticle(this.x,this.y+80*Math.random()+170,-(60*Math.random()+45)):addParticle(this.x,this.y+80*Math.random()+170,60*Math.random()+45)):this.rotation<-.1&&Math.random()<2*-this.rotation&&(this.dustSoundDelay>.1&&(playSound("dust"),this.dustSoundDelay=0),Math.random()<.5?addParticle(this.x,this.y+80*Math.random()+170,-(60*Math.random()+45)):addParticle(this.x,this.y+80*Math.random()+170,60*Math.random()+45))),this.dustSoundDelay+=delta,this.charRider.setFrame(Math.max(Math.min(Math.round(34*this.rotation)+9,18),0)+aCharData[this.charId].tiltFrameStart),this.shakeInc=Math.sin(1.1*panel.incY)*(this.speed*Math.abs(ground.aRoad[1].angle-ground.aRoad[0].angle))*.4;var a=.31*ground.easeOutSine(this.segSeg,0,1,1)+.69*this.segSeg,t=(this.roadY0+this.roadY1)/2,e=(this.roadY3+this.roadY2)/2;this.y+=.2*(t+(e-t)*a-this.y),this.segSeg>=1?(this.segId+=1,this.segSeg-=1):this.segSeg<=0&&(this.segId-=1,this.segSeg+=1),0==this.jumpHeight&&(1==ground.aRoad[Math.max(this.segId-1,0)].jump&&ground.carPos<.5||2==ground.aRoad[Math.max(this.segId-1,0)].jump&&ground.carPos>.5)&&this.triggerJump()}},t.prototype.render=function(){if("game"==gameState){var a=this.oGameElementsImgData.oData.oAtlasData[oImageIds.testShadow].x,t=this.oGameElementsImgData.oData.oAtlasData[oImageIds.testShadow].y,e=this.oGameElementsImgData.oData.oAtlasData[oImageIds.testShadow].width,i=this.oGameElementsImgData.oData.oAtlasData[oImageIds.testShadow].height;if(ctx.drawImage(this.oGameElementsImgData.img,a,t,e,i,this.x-e/2,this.y+260-i,e,i),0==aCharData[curChar].vehicleType){a=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart0"+this.vehicleId]].x,t=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart0"+this.vehicleId]].y,e=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart0"+this.vehicleId]].width,i=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart0"+this.vehicleId]].height;ctx.drawImage(this.oVehiclesImgData.img,a,t,e,i,this.x-e/2+this.shakeInc,this.y+250+this.jumpHeight-260,e,i),ctx.fillStyle=aCharData[this.vehicleId].boardCol;var s=this.y+250+this.jumpHeight-125;ctx.beginPath(),ctx.moveTo(this.x-20+this.shakeInc,s),ctx.lineTo(this.x+20+this.shakeInc,s),ctx.lineTo(this.x+35-100*this.rotation+1.5*this.shakeInc,s+70+.2*this.jumpHeight+25*ground.aRoad[this.segId].height),ctx.lineTo(this.x-35-100*this.rotation+1.5*this.shakeInc,s+70+.2*this.jumpHeight+25*ground.aRoad[this.segId].height),ctx.fill(),ctx.lineWidth=2,ctx.strokeStyle="#000000",ctx.beginPath(),ctx.moveTo(this.x-20+this.shakeInc,s),ctx.lineTo(this.x-35-100*this.rotation+1.5*this.shakeInc,s+70+.2*this.jumpHeight+25*ground.aRoad[this.segId].height),ctx.stroke(),ctx.beginPath(),ctx.moveTo(this.x+20+this.shakeInc,s),ctx.lineTo(this.x+35-100*this.rotation+1.5*this.shakeInc,s+70+.2*this.jumpHeight+25*ground.aRoad[this.segId].height),ctx.stroke(),this.charRider.x=this.x-50*this.rotation+1.2*this.shakeInc,this.charRider.y=this.y+this.jumpHeight+10*ground.aRoad[this.segId].height,this.charRider.update(),this.charRider.render();a=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart1"+this.vehicleId]].x,t=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart1"+this.vehicleId]].y,e=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart1"+this.vehicleId]].width,i=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart1"+this.vehicleId]].height;if(ctx.drawImage(this.oVehiclesImgData.img,a,t,e,i,this.x-e/2-100*this.rotation+1.5*this.shakeInc,this.y-.4*i+250+this.jumpHeight-55+.2*this.jumpHeight+25*ground.aRoad[this.segId].height,e,i),-1!=this.bonusId){a=this.oGameElementsImgData.oData.oAtlasData[oImageIds["bonus"+this.bonusId+0]].x,t=this.oGameElementsImgData.oData.oAtlasData[oImageIds["bonus"+this.bonusId+0]].y,e=this.oGameElementsImgData.oData.oAtlasData[oImageIds["bonus"+this.bonusId+0]].width,i=this.oGameElementsImgData.oData.oAtlasData[oImageIds["bonus"+this.bonusId+0]].height;ctx.drawImage(this.oGameElementsImgData.img,a,t,e,i,this.x-100*this.rotation+1.5*this.shakeInc-e/2,this.y+250+this.jumpHeight-55+.2*this.jumpHeight+25*ground.aRoad[this.segId].height-i,e,i)}}else{a=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart0"+this.vehicleId]].x,t=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart0"+this.vehicleId]].y,e=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart0"+this.vehicleId]].width,i=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart0"+this.vehicleId]].height;ctx.drawImage(this.oVehiclesImgData.img,a,t,e,i,this.x-e/2+50*this.rotation+this.shakeInc,this.y+250+this.jumpHeight-142,e,i);a=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart1"+this.vehicleId]].x,t=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart1"+this.vehicleId]].y,e=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart1"+this.vehicleId]].width,i=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart1"+this.vehicleId]].height;ctx.drawImage(this.oVehiclesImgData.img,a,t,e,i,this.x-e/2-100*this.rotation+1.5*this.shakeInc,this.y+250+this.jumpHeight-61+.2*this.jumpHeight+25*ground.aRoad[this.segId].height,e,i),ctx.fillStyle=aCharData[this.vehicleId].boardCol;s=this.y+250+this.jumpHeight-131;if(ctx.beginPath(),ctx.moveTo(this.x-26+50*this.rotation+this.shakeInc,s),ctx.lineTo(this.x+26+50*this.rotation+this.shakeInc,s),ctx.lineTo(this.x+46-100*this.rotation+1.5*this.shakeInc,s+72+.2*this.jumpHeight+25*ground.aRoad[this.segId].height),ctx.lineTo(this.x-46-100*this.rotation+1.5*this.shakeInc,s+72+.2*this.jumpHeight+25*ground.aRoad[this.segId].height),ctx.fill(),ctx.lineWidth=2,ctx.strokeStyle="#000000",ctx.beginPath(),ctx.moveTo(this.x-26+50*this.rotation+this.shakeInc,s),ctx.lineTo(this.x-46-100*this.rotation+1.5*this.shakeInc,s+72+.2*this.jumpHeight+25*ground.aRoad[this.segId].height),ctx.stroke(),ctx.beginPath(),ctx.moveTo(this.x+26+50*this.rotation+this.shakeInc,s),ctx.lineTo(this.x+46-100*this.rotation+1.5*this.shakeInc,s+72+.2*this.jumpHeight+25*ground.aRoad[this.segId].height),ctx.stroke(),this.charRider.x=this.x-50*this.rotation+1.2*this.shakeInc,this.charRider.y=this.y+this.jumpHeight+10*ground.aRoad[this.segId].height,this.charRider.update(),this.charRider.render(),-1!=this.bonusId){a=this.oGameElementsImgData.oData.oAtlasData[oImageIds["bonus"+this.bonusId+1]].x,t=this.oGameElementsImgData.oData.oAtlasData[oImageIds["bonus"+this.bonusId+1]].y,e=this.oGameElementsImgData.oData.oAtlasData[oImageIds["bonus"+this.bonusId+1]].width,i=this.oGameElementsImgData.oData.oAtlasData[oImageIds["bonus"+this.bonusId+1]].height;ctx.drawImage(this.oGameElementsImgData.img,a,t,e,i,this.x-100*this.rotation+1.5*this.shakeInc-e/2,this.y+250+this.jumpHeight-55+.2*this.jumpHeight+25*ground.aRoad[this.segId].height-i,e,i)}}}},t}();a.UserSkater=t}(Elements||(Elements={})),function(a){var t=function(){function a(a,t){this.roadTilt=0,this.steerLean=0,this.x=0,this.y=0,this.scale=0,this.targX=0,this.targY=0,this.targScale=0,this.speed=0,this.segSeg=0,this.roadScale=0,this.roadPrevScale=0,this.easedSegSeg=0,this.roadXPerc=0,this.removeMe=!1,this.nearOff=!1,this.offscreenState=0,this.offscreenEndInc=0,this.speedControlState=0,this.newRoadPosComplete=!1,this.jumpHeight=0,this.jumpSpeed=0,this.controlledSpeed=0,this.isEnemy=!0,this.slowSpeed=1,this.charGroundOffsetY=20,this.testChar=Math.floor(14*Math.random()),this.startPosId=a,this.charId=t,this.oGameElementsImgData=assetLib.getData("gameElements"),this.oVehiclesImgData=assetLib.getData("vehicles"),this.oEnemyCharsImgData=assetLib.getData("enemyChars"),this.segId=1*this.startPosId+3,this.roadXPerc=this.startPosId%2*.4+.3,this.prevRoadXPerc=this.roadXPerc,this.startRace()}return a.prototype.makeSlow=function(){var a=this;this.slowTween&&this.slowTween.kill(),this.slowTween=TweenLite.to(this,.3,{slowSpeed:0,ease:"Quad.easeIn",onComplete:function(){a.slowTween=TweenLite.to(a,1,{slowSpeed:1,delay:1,ease:"Quad.easeOut",onComplete:function(){}})}})},a.prototype.triggerJump=function(){var a=this;this.jumpSpeedTween&&this.jumpSpeedTween.kill(),this.jumpSpeed=0,this.jumpSpeedTween=TweenLite.to(this,1,{jumpSpeed:2,ease:"Quad.easeIn",onComplete:function(){a.jumpSpeedTween=TweenLite.to(a,1,{jumpSpeed:0,ease:"Quad.easeOut",onComplete:function(){}})}}),this.jumpTween&&this.jumpTween.kill(),this.jumpTween=TweenLite.to(this,.4,{jumpHeight:-300,ease:"Quad.easeOut",onComplete:function(){a.jumpTween=TweenLite.to(a,1,{jumpHeight:0,ease:"Bounce.easeOut",onComplete:function(){}})}})},a.prototype.startRace=function(){var a=this;this.speedTween&&this.speedTween.kill(),this.speedTween=TweenLite.to(this,.5+.2*(11-this.startPosId),{controlledSpeed:userSkater.maxSpeed,ease:"Quad.easeInOut",delay:1+.1*(11-this.startPosId),onComplete:function(){a.setNewSpeed(),a.setNewRoadXPos(),a.speedControlState=1},onStart:function(){}})},a.prototype.getSpeed=function(){return Math.random()*(.25*userSkater.maxSpeed-.01*raceNum)+userSkater.maxSpeed*(.75+.004*this.startPosId+.01*raceNum)},a.prototype.setNewRoadXPos=function(a){var t=this;void 0===a&&(a=null),this.roadXTween&&this.roadXTween.kill();var e=.5;null==a?(a=.8*Math.random()+.1,e=2*Math.random()+2):this.newRoadPosComplete=!1,this.roadXTween=TweenLite.to(this,e,{roadXPerc:a,ease:"Quad.easeInOut",onComplete:function(){t.setNewRoadXPos(),t.newRoadPosComplete=!0}})},a.prototype.setNewSpeed=function(a){var t=this;void 0===a&&(a=null),this.speedTween&&this.speedTween.kill(),null==a&&(a=this.getSpeed()),this.speedTween=TweenLite.to(this,2*Math.random()+2,{controlledSpeed:a,ease:"Quad.easeInOut",onComplete:function(){t.setNewSpeed()}})},a.prototype.setOffSpeed=function(){var a=this;this.speedTween&&this.speedTween.kill(),this.speedTween=TweenLite.to(this,1,{controlledSpeed:Math.min(this.speed,userSkater.speed-2),ease:"Quad.easeIn",onComplete:function(){a.segId<=3?a.setOffSpeed():a.setNewSpeed()}})},a.prototype.offScreenEnd=function(){this.speedTween&&this.speedTween.kill(),this.roadXTween&&this.roadXTween.kill(),this.charId!=challengeChar&&playSound("overtake"),this.offscreenState=1,this.offscreenEndInc=1},a.prototype.backOnFromEnd=function(){this.offscreenState=0,this.segId=1,this.charId!=challengeChar&&playSound("enemyOvertake"),ground.carPosTarg<.5?this.prevRoadXPerc=this.roadXPerc=.35*Math.random()+.55:this.prevRoadXPerc=this.roadXPerc=.35*Math.random()+.1,this.controlledSpeed=userSkater.maxSpeed,this.setNewSpeed(),this.setNewRoadXPos(),this.nearOff=!1},a.prototype.update=function(){if(1==this.offscreenState)return this.offscreenEndInc+=(userSkater.speed-(userSkater.maxSpeed-1))*delta,void(this.offscreenEndInc<0&&this.backOnFromEnd());this.speed=(this.controlledSpeed+this.jumpSpeed)*this.slowSpeed,this.segId<=3&&this.speed<userSkater.speed&&!this.nearOff&&(this.nearOff=!0,this.setOffSpeed()),this.roadTilt+=.2*(ground.aRoad[this.segId].angle-ground.aRoad[Math.max(this.segId-1,0)].angle-300*(this.prevRoadXPerc-this.roadXPerc)-this.roadTilt),this.prevRoadXPerc=this.roadXPerc,this.segSeg+=(userSkater.speed+(this.speed-userSkater.speed))*delta;var a=.31*ground.easeOutSine(this.segSeg,0,1,1)+.69*this.segSeg,t=this.roadX0+(this.roadX1-this.roadX0)*this.roadXPerc,e=this.roadX3+(this.roadX2-this.roadX3)*this.roadXPerc,i=this.roadY0+(this.roadY1-this.roadY0)*this.roadXPerc,s=this.roadY3+(this.roadY2-this.roadY3)*this.roadXPerc;if(this.x+=.7*(t+(e-t)*a-this.x),this.y+=.3*(i+(s-i)*a-this.y),this.scale+=.3*(1.2*this.roadPrevScale+(1.2*this.roadScale-1.2*this.roadPrevScale)*a-this.scale),this.rotation=.08*this.roadTilt,this.segSeg>=1?(this.segId+=1,this.segSeg-=1):this.segSeg<=0&&(this.segId-=1,this.segSeg+=1),this.x>userSkater.x-120&&this.x<userSkater.x+120&&this.y>userSkater.y&&this.y<userSkater.y+30&&1==userSkater.speedControlState&&userSkater.segId>=this.segId-1&&userSkater.segId<=this.segId+1&&this.charId!=challengeChar&&(this.speedTween&&this.speedTween.kill(),playSound("hitEnemy"),this.speed=userSkater.maxSpeed,this.setNewSpeed(),this.setNewRoadXPos(),userSkater.triggerCrash(),userSkater.speed*=.3),this.charId!=challengeChar)for(var h=0;h<aEnemySkaters.length;h++)if(aEnemySkaters[h].charId!=this.charId&&aEnemySkaters[h].charId!=challengeChar&&this.x>aEnemySkaters[h].x-300*this.scale&&this.x<aEnemySkaters[h].x+300*this.scale&&this.y>aEnemySkaters[h].y-100*this.scale&&this.y<aEnemySkaters[h].y+100*this.scale&&1==this.speedControlState&&this.newRoadPosComplete&&aEnemySkaters[h].newRoadPosComplete&&this.segId<=aEnemySkaters[h].segId+6&&this.segId>=aEnemySkaters[h].segId-6)if(this.newRoadPosComplete=!1,aEnemySkaters[h].newRoadPosComplete=!1,this.x>aEnemySkaters[h].x){var o=this.roadXPerc;this.setNewRoadXPos(Math.min(aEnemySkaters[h].roadXPerc+.2,.8)),aEnemySkaters[h].setNewRoadXPos(Math.max(o-.2,.2))}else{o=this.roadXPerc;this.setNewRoadXPos(Math.max(aEnemySkaters[h].roadXPerc-.2,.2)),aEnemySkaters[h].setNewRoadXPos(Math.min(o+.2,.8))}(this.y+Math.min(canvas.height-(userSkater.y+200),0)>canvas.height||this.segId<0)&&this.offScreenEnd(),this.segId>=0&&this.segId<ground.aRoad.length&&0==this.jumpHeight&&(1==ground.aRoad[this.segId].jump&&this.roadXPerc<.5||2==ground.aRoad[this.segId].jump&&this.roadXPerc>.5)&&this.triggerJump()},a.prototype.renderPointer=function(){if(-1==challengeTime){var a=this.oGameElementsImgData.oData.oAtlasData[oImageIds["charPointer"+this.charId]].x,t=this.oGameElementsImgData.oData.oAtlasData[oImageIds["charPointer"+this.charId]].y,e=this.oGameElementsImgData.oData.oAtlasData[oImageIds["charPointer"+this.charId]].width,i=this.oGameElementsImgData.oData.oAtlasData[oImageIds["charPointer"+this.charId]].height,s=Math.max(2*this.scale,.3);ctx.drawImage(this.oGameElementsImgData.img,a,t,e,i,this.x-e/2*s,this.y+(this.jumpHeight-400)*this.scale-50*s-i*s,e*s,i*s)}},a.prototype.render=function(){if(this.charId!=challengeChar){var a=this.oGameElementsImgData.oData.oAtlasData[oImageIds.testShadow].x,t=this.oGameElementsImgData.oData.oAtlasData[oImageIds.testShadow].y,e=this.oGameElementsImgData.oData.oAtlasData[oImageIds.testShadow].width,i=this.oGameElementsImgData.oData.oAtlasData[oImageIds.testShadow].height;if(ctx.drawImage(this.oGameElementsImgData.img,a,t,e,i,this.x-e/2*this.scale,this.y-i*this.scale,e*this.scale,i*this.scale),0==aCharData[this.charId].vehicleType){a=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart0"+this.charId]].x,t=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart0"+this.charId]].y,e=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart0"+this.charId]].width,i=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart0"+this.charId]].height;ctx.drawImage(this.oVehiclesImgData.img,a,t,e,i,this.x-e/2*this.scale,this.y+(this.charGroundOffsetY+this.jumpHeight-260)*this.scale,e*this.scale,i*this.scale),ctx.fillStyle=aCharData[this.charId].boardCol;var s=this.y+(this.charGroundOffsetY+this.jumpHeight-125)*this.scale;ctx.beginPath(),ctx.moveTo(this.x-20*this.scale,s),ctx.lineTo(this.x+20*this.scale,s),ctx.lineTo(this.x+35*this.scale+200*(this.roadXPerc-ground.carPos)*this.scale,s+(30+.2*this.jumpHeight)*this.scale),ctx.lineTo(this.x-35*this.scale+200*(this.roadXPerc-ground.carPos)*this.scale,s+(30+.2*this.jumpHeight)*this.scale),ctx.fill(),ctx.lineWidth=2*this.scale,ctx.strokeStyle="#000000",ctx.beginPath(),ctx.moveTo(this.x-20*this.scale,s),ctx.lineTo(this.x-35*this.scale+200*(this.roadXPerc-ground.carPos)*this.scale,s+(30+.2*this.jumpHeight)*this.scale),ctx.stroke(),ctx.beginPath(),ctx.moveTo(this.x+20*this.scale,s),ctx.lineTo(this.x+35*this.scale+200*(this.roadXPerc-ground.carPos)*this.scale,s+(30+.2*this.jumpHeight)*this.scale),ctx.stroke();var h="stillChar"+this.charId;panel.lightningZapId==this.charId&&panel.incY<panel.lightningZapInc+30&&Math.floor(panel.incY)%2&&(h="zapChar"+this.charId);a=this.oEnemyCharsImgData.oData.oAtlasData[oImageIds[h]].x,t=this.oEnemyCharsImgData.oData.oAtlasData[oImageIds[h]].y,e=this.oEnemyCharsImgData.oData.oAtlasData[oImageIds[h]].width,i=this.oEnemyCharsImgData.oData.oAtlasData[oImageIds[h]].height;ctx.drawImage(this.oEnemyCharsImgData.img,a,t,e,i,this.x-50*this.rotation*1.2*this.scale-e/2*this.scale+aCharData[this.charId].oStillCharOffset.x*this.scale,this.y+(this.jumpHeight-250)*this.scale-i/2*this.scale+aCharData[this.charId].oStillCharOffset.y*this.scale,e*this.scale,i*this.scale);a=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart1"+this.charId]].x,t=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart1"+this.charId]].y,e=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart1"+this.charId]].width,i=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart1"+this.charId]].height;ctx.drawImage(this.oVehiclesImgData.img,a,t,e,i,this.x-e/2*this.scale+200*(this.roadXPerc-ground.carPos)*this.scale,s-.4*i*this.scale+(30+.2*this.jumpHeight)*this.scale,e*this.scale,i*this.scale)}else{s=this.y+(this.charGroundOffsetY+this.jumpHeight-130)*this.scale,a=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart0"+this.charId]].x,t=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart0"+this.charId]].y,e=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart0"+this.charId]].width,i=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart0"+this.charId]].height;ctx.drawImage(this.oVehiclesImgData.img,a,t,e,i,this.x-e/2*this.scale-200*Math.max(Math.min(this.roadXPerc-ground.carPos,.2),-.2)*this.scale,this.y+.2*i*this.scale+(this.charGroundOffsetY+this.jumpHeight-147)*this.scale,e*this.scale,i*this.scale);a=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart1"+this.charId]].x,t=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart1"+this.charId]].y,e=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart1"+this.charId]].width,i=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart1"+this.charId]].height;ctx.drawImage(this.oVehiclesImgData.img,a,t,e,i,this.x-e/2*this.scale-100*this.rotation*.5*this.scale+200*Math.max(Math.min(this.roadXPerc-ground.carPos,.2),-.2)*this.scale,s+(35+.2*this.jumpHeight)*this.scale,e*this.scale,i*this.scale),ctx.fillStyle=aCharData[this.charId].boardCol,ctx.beginPath(),ctx.moveTo(this.x-26*this.scale-200*Math.max(Math.min(this.roadXPerc-ground.carPos,.2),-.2)*this.scale,s),ctx.lineTo(this.x+26*this.scale-200*Math.max(Math.min(this.roadXPerc-ground.carPos,.2),-.2)*this.scale,s),ctx.lineTo(this.x+46*this.scale-100*this.rotation*.5*this.scale+200*Math.max(Math.min(this.roadXPerc-ground.carPos,.2),-.2)*this.scale,s+(37+.2*this.jumpHeight)*this.scale),ctx.lineTo(this.x-46*this.scale-100*this.rotation*.5*this.scale+200*Math.max(Math.min(this.roadXPerc-ground.carPos,.2),-.2)*this.scale,s+(37+.2*this.jumpHeight)*this.scale),ctx.fill(),ctx.lineWidth=2*this.scale,ctx.strokeStyle="#000000",ctx.beginPath(),ctx.moveTo(this.x-26*this.scale-200*Math.max(Math.min(this.roadXPerc-ground.carPos,.2),-.2)*this.scale,s),ctx.lineTo(this.x-46*this.scale-100*this.rotation*.5*this.scale+200*Math.max(Math.min(this.roadXPerc-ground.carPos,.2),-.2)*this.scale,s+(37+.2*this.jumpHeight)*this.scale),ctx.stroke(),ctx.beginPath(),ctx.moveTo(this.x+26*this.scale-200*Math.max(Math.min(this.roadXPerc-ground.carPos,.2),-.2)*this.scale,s),ctx.lineTo(this.x+46*this.scale-100*this.rotation*.5*this.scale+200*Math.max(Math.min(this.roadXPerc-ground.carPos,.2),-.2)*this.scale,s+(37+.2*this.jumpHeight)*this.scale),ctx.stroke();h="stillChar"+this.charId;panel.lightningZapId==this.charId&&panel.incY<panel.lightningZapInc+30&&Math.floor(panel.incY)%2&&(h="zapChar"+this.charId);a=this.oEnemyCharsImgData.oData.oAtlasData[oImageIds[h]].x,t=this.oEnemyCharsImgData.oData.oAtlasData[oImageIds[h]].y,e=this.oEnemyCharsImgData.oData.oAtlasData[oImageIds[h]].width,i=this.oEnemyCharsImgData.oData.oAtlasData[oImageIds[h]].height;ctx.drawImage(this.oEnemyCharsImgData.img,a,t,e,i,this.x-100*this.rotation*.2*this.scale-e/2*this.scale+aCharData[this.charId].oStillCharOffset.x*this.scale,this.y+(this.jumpHeight-250)*this.scale-i/2*this.scale+aCharData[this.charId].oStillCharOffset.y*this.scale,e*this.scale,i*this.scale)}}},a}();a.EnemySkater=t}(Elements||(Elements={})),function(a){var t=function(a){function t(t){var e=a.call(this,assetLib.getData("coin"),20,60,"spin"+Math.floor(10*Math.random()))||this;return e.removeMe=!1,e.hasHit=!1,e.id=t,e.offsetY=-100,e}return __extends(t,a),t.prototype.hit=function(a){var t=this;void 0===a&&(a=!1),this.hasHit=!0,playSound("coin"+Math.floor(3*Math.random())),a?TweenLite.to(this,.3,{x:userSkater.x,y:userSkater.y,scaleX:.5,scaleY:.5,ease:"Quad.easeOut",onComplete:function(){TweenLite.to(t,.3,{x:.73*canvas.width,y:0,scaleX:.5,scaleY:.5,ease:"Quad.easeInOut",onComplete:function(){panel.jiggleCash(),saveDataHandler.updateCash(5),t.removeMe=!0}})}}):TweenLite.to(this,.3,{x:.73*canvas.width,y:0,scaleX:.5,scaleY:.5,ease:"Quad.easeOut",onComplete:function(){panel.jiggleCash(),saveDataHandler.updateCash(5),t.removeMe=!0}})},t.prototype.update=function(t,e){a.prototype.updateAnimation.call(this,delta),!this.hasHit&&this.y>canvas.height&&(this.removeMe=!0)},t.prototype.render=function(){a.prototype.renderSimple.call(this,ctx)},t}(Utils.AnimSprite);a.Coin=t}(Elements||(Elements={})),function(a){var t=function(){function a(a,t,e){var i=this;this.removeMe=!1,this.offsetX=0,this.startX=a,this.startY=t,this.scale=15*Math.random()+15,this.angle=e,this.col=ground.aRaceColours[raceNum].shards,this.inc=50*Math.random()+50;var s=.4*Math.random()+.4;this.angle>0?TweenLite.to(this,s,{startX:this.startX+(300*Math.random()+300),angle:100,scale:0,ease:"Quad.easeOut",onComplete:function(){i.removeMe=!0}}):TweenLite.to(this,s,{startX:this.startX-(300*Math.random()+300),angle:-100,scale:0,ease:"Quad.easeOut",onComplete:function(){i.removeMe=!0}}),TweenLite.to(this,.25*s,{startY:this.startY-100*Math.random(),ease:"Cubic.easeOut",onComplete:function(){TweenLite.to(i,.75*s,{startY:i.startY+(300*Math.random()+300),ease:"Cubic.easeIn",onComplete:function(){}})}})}return a.prototype.update=function(){this.offsetX-=1e4*(ground.carPosTarg-ground.carPos)*delta,this.endX=this.scale*Math.cos((this.angle+90)*radian),this.endY=this.scale*Math.sin((this.angle+90)*radian)},a.prototype.render=function(){ctx.strokeStyle=this.col,ctx.lineWidth=1*this.scale,ctx.beginPath(),ctx.moveTo(this.startX+this.offsetX,this.startY),ctx.lineTo(this.startX-this.endX+this.offsetX,this.startY-this.endY),ctx.stroke()},a}();a.Shard=t}(Elements||(Elements={})),function(a){var t=function(){function a(){this.removeMe=!1,this.reset(!0)}return a.prototype.reset=function(a){void 0===a&&(a=!1),this.x=Math.random()*canvas.width,this.y=a?Math.random()*canvas.height:-20,this.scale=15*Math.random()+15,this.angle=360*Math.random(),this.col="rgb("+Math.floor(156*Math.random()+100)+", "+Math.floor(156*Math.random()+100)+",  "+Math.floor(156*Math.random()+100)+")",this.inc=150*Math.random()+150,this.drift=.3*Math.random()+.3},a.prototype.update=function(){this.y+=this.inc*delta,this.x+=Math.sin(.01*this.y)*this.drift,this.angle+=this.inc*delta,this.endX=this.scale*Math.cos(this.angle*radian),this.endY=this.scale*Math.sin(this.angle*radian),this.y>canvas.height+20&&this.reset()},a.prototype.render=function(){ctx.strokeStyle=this.col,ctx.lineWidth=.5*this.scale,ctx.beginPath(),ctx.moveTo(this.x,this.y),ctx.lineTo(this.x-this.endX,this.y-this.endY),ctx.stroke()},a}();a.Confetti=t}(Elements||(Elements={})),function(a){var t=function(a){function t(t,e,i){var s=a.call(this,t,20,45,"spin"+Math.floor(10*Math.random()))||this;s.incX=800*Math.random()-400,s.incY=-600*Math.random(),s.x=e,s.y=i,s.scaleX=s.scaleY=0;var h=.3*Math.random()+.5;return TweenLite.to(s,.5,{scaleX:h,scaleY:h,ease:"Back.easeOut"}),s}return __extends(t,a),t.prototype.update=function(){a.prototype.updateAnimation.call(this,delta),this.incX*=.99,this.incY+=800*delta,this.x+=this.incX*delta,this.y+=this.incY*delta,this.y>canvas.height+100&&(this.removeMe=!0)},t.prototype.render=function(){a.prototype.renderSimple.call(this,ctx)},t}(Utils.AnimSprite);a.CoinShower=t}(Elements||(Elements={})),function(a){var t=function(){function a(a,t){this.hasHit=!1,this.removeMe=!1,this.scaleX=1,this.scaleY=1,this.oGameElementsImgData=assetLib.getData("gameElements"),this.id=a,this.flavour=t}return a.prototype.hit=function(){var a=this;if(this.hasHit=!0,0==this.flavour)userSkater.hitBoost(),playSound("boost");else if(1==this.flavour){if(userCharPos>0){var t=aRacePositions[Math.max(userCharPos-2,0)];panel.lightningZapId=t.charId,t.makeSlow(),panel.lightningHit(t.x,t.y+(t.jumpHeight-400)*t.scale),playSound("lightning")}}else 2==this.flavour&&(ground.magnetCount=20,playSound("powerUp"));TweenLite.to(this,.3,{x:.5*canvas.width,y:.35*canvas.height,scaleX:1,scaleY:1,ease:"Quad.easeOut",onComplete:function(){TweenLite.to(a,.3,{x:0,ease:"Quad.easeIn",onComplete:function(){a.removeMe=!0}})}})},a.prototype.update=function(a,t){!this.hasHit&&this.y>canvas.height&&(this.removeMe=!0)},a.prototype.render=function(){var a=this.oGameElementsImgData.oData.oAtlasData[oImageIds["pickUp"+this.flavour]].x,t=this.oGameElementsImgData.oData.oAtlasData[oImageIds["pickUp"+this.flavour]].y,e=this.oGameElementsImgData.oData.oAtlasData[oImageIds["pickUp"+this.flavour]].width,i=this.oGameElementsImgData.oData.oAtlasData[oImageIds["pickUp"+this.flavour]].height;ctx.drawImage(this.oGameElementsImgData.img,a,t,e,i,this.x-e/2*this.scaleY,this.y-150*this.scaleY-i/2*this.scaleY,e*this.scaleX,i*this.scaleY)},a}();a.PickUp=t}(Elements||(Elements={})),function(a){var t=function(a){function t(t){var e=a.call(this,assetLib.getData("charRider"+t),24,60,"startPause")||this;return e.offsetX=aCharData[t].oCharOffset.x*e.scaleX,e.offsetY=aCharData[t].oCharOffset.y*e.scaleY,e}return __extends(t,a),t.prototype.hit=function(){},t.prototype.update=function(){a.prototype.updateAnimation.call(this,delta)},t.prototype.render=function(){a.prototype.renderSimple.call(this,ctx)},t}(Utils.AnimSprite);a.CharRider=t}(Elements||(Elements={})),function(a){var t=function(){function a(a){this.roadTilt=0,this.steerLean=0,this.x=0,this.y=0,this.scale=0,this.targX=0,this.targY=0,this.targScale=0,this.speed=0,this.segSeg=0,this.roadScale=0,this.roadPrevScale=0,this.easedSegSeg=0,this.roadXPerc=0,this.removeMe=!1,this.nearOff=!1,this.offscreenState=0,this.offscreenEndInc=0,this.speedControlState=0,this.newRoadPosComplete=!1,this.jumpHeight=0,this.jumpSpeed=0,this.controlledSpeed=0,this.isEnemy=!0,this.slowSpeed=1,this.charGroundOffsetY=20,this.testChar=Math.floor(14*Math.random()),this.segPerc=0,this.charId=a,this.oGameElementsImgData=assetLib.getData("gameElements"),this.oVehiclesImgData=assetLib.getData("vehicles"),this.oEnemyCharsImgData=assetLib.getData("enemyChars"),this.segId=30,this.roadXPerc=.5,this.prevRoadXPerc=this.roadXPerc,this.setNewRoadXPos()}return a.prototype.setNewRoadXPos=function(a){var t=this;void 0===a&&(a=null),this.roadXTween&&this.roadXTween.kill();var e=.5;null==a?(a=.8*Math.random()+.1,e=2*Math.random()+2):this.newRoadPosComplete=!1,this.roadXTween=TweenLite.to(this,e,{roadXPerc:a,ease:"Quad.easeInOut",onComplete:function(){t.setNewRoadXPos(),t.newRoadPosComplete=!0}})},a.prototype.update=function(){this.prevRoadXPerc=this.roadXPerc,this.segSeg=this.segPerc;var a=.31*ground.easeOutSine(this.segSeg,0,1,1)+.69*this.segSeg,t=this.roadX0+(this.roadX1-this.roadX0)*this.roadXPerc,e=this.roadX3+(this.roadX2-this.roadX3)*this.roadXPerc,i=this.roadY0+(this.roadY1-this.roadY0)*this.roadXPerc,s=this.roadY3+(this.roadY2-this.roadY3)*this.roadXPerc;this.x+=.7*(t+(e-t)*a-this.x),this.y+=.3*(i+(s-i)*a-this.y),this.scale+=.3*(1.2*this.roadPrevScale+(1.2*this.roadScale-1.2*this.roadPrevScale)*a-this.scale),this.rotation=.08*this.roadTilt},a.prototype.renderPointer=function(){var a=this.oGameElementsImgData.oData.oAtlasData[oImageIds["charPointer"+this.charId]].x,t=this.oGameElementsImgData.oData.oAtlasData[oImageIds["charPointer"+this.charId]].y,e=this.oGameElementsImgData.oData.oAtlasData[oImageIds["charPointer"+this.charId]].width,i=this.oGameElementsImgData.oData.oAtlasData[oImageIds["charPointer"+this.charId]].height,s=Math.max(2*this.scale,.3);ctx.drawImage(this.oGameElementsImgData.img,a,t,e,i,this.x-e/2*s,this.y+(this.jumpHeight-400)*this.scale-50*s-i*s,e*s,i*s)},a.prototype.render=function(){var a=this.oGameElementsImgData.oData.oAtlasData[oImageIds.testShadow].x,t=this.oGameElementsImgData.oData.oAtlasData[oImageIds.testShadow].y,e=this.oGameElementsImgData.oData.oAtlasData[oImageIds.testShadow].width,i=this.oGameElementsImgData.oData.oAtlasData[oImageIds.testShadow].height;if(ctx.drawImage(this.oGameElementsImgData.img,a,t,e,i,this.x-e/2*this.scale,this.y-i*this.scale,e*this.scale,i*this.scale),0==aCharData[this.charId].vehicleType){a=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart0"+this.charId]].x,t=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart0"+this.charId]].y,e=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart0"+this.charId]].width,i=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart0"+this.charId]].height;ctx.drawImage(this.oVehiclesImgData.img,a,t,e,i,this.x-e/2*this.scale,this.y+(this.charGroundOffsetY+this.jumpHeight-260)*this.scale,e*this.scale,i*this.scale),ctx.fillStyle=aCharData[this.charId].boardCol;var s=this.y+(this.charGroundOffsetY+this.jumpHeight-125)*this.scale;ctx.beginPath(),ctx.moveTo(this.x-20*this.scale,s),ctx.lineTo(this.x+20*this.scale,s),ctx.lineTo(this.x+35*this.scale+200*(this.roadXPerc-ground.carPos)*this.scale,s+(30+.2*this.jumpHeight)*this.scale),ctx.lineTo(this.x-35*this.scale+200*(this.roadXPerc-ground.carPos)*this.scale,s+(30+.2*this.jumpHeight)*this.scale),ctx.fill(),ctx.lineWidth=2*this.scale,ctx.strokeStyle="#000000",ctx.beginPath(),ctx.moveTo(this.x-20*this.scale,s),ctx.lineTo(this.x-35*this.scale+200*(this.roadXPerc-ground.carPos)*this.scale,s+(30+.2*this.jumpHeight)*this.scale),ctx.stroke(),ctx.beginPath(),ctx.moveTo(this.x+20*this.scale,s),ctx.lineTo(this.x+35*this.scale+200*(this.roadXPerc-ground.carPos)*this.scale,s+(30+.2*this.jumpHeight)*this.scale),ctx.stroke();var h="stillChar"+this.charId;panel.lightningZapId==this.charId&&panel.incY<panel.lightningZapInc+30&&Math.floor(panel.incY)%2&&(h="zapChar"+this.charId);a=this.oEnemyCharsImgData.oData.oAtlasData[oImageIds[h]].x,t=this.oEnemyCharsImgData.oData.oAtlasData[oImageIds[h]].y,e=this.oEnemyCharsImgData.oData.oAtlasData[oImageIds[h]].width,i=this.oEnemyCharsImgData.oData.oAtlasData[oImageIds[h]].height;ctx.drawImage(this.oEnemyCharsImgData.img,a,t,e,i,this.x-50*this.rotation*1.2*this.scale-e/2*this.scale+aCharData[this.charId].oStillCharOffset.x*this.scale,this.y+(this.jumpHeight-250)*this.scale-i/2*this.scale+aCharData[this.charId].oStillCharOffset.y*this.scale,e*this.scale,i*this.scale);a=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart1"+this.charId]].x,t=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart1"+this.charId]].y,e=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart1"+this.charId]].width,i=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart1"+this.charId]].height;ctx.drawImage(this.oVehiclesImgData.img,a,t,e,i,this.x-e/2*this.scale+200*(this.roadXPerc-ground.carPos)*this.scale,s-.4*i*this.scale+(30+.2*this.jumpHeight)*this.scale,e*this.scale,i*this.scale)}else{s=this.y+(this.charGroundOffsetY+this.jumpHeight-130)*this.scale,a=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart0"+this.charId]].x,t=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart0"+this.charId]].y,e=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart0"+this.charId]].width,i=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart0"+this.charId]].height;ctx.drawImage(this.oVehiclesImgData.img,a,t,e,i,this.x-e/2*this.scale-200*Math.max(Math.min(this.roadXPerc-ground.carPos,.2),-.2)*this.scale,this.y+.2*i*this.scale+(this.charGroundOffsetY+this.jumpHeight-147)*this.scale,e*this.scale,i*this.scale);a=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart1"+this.charId]].x,t=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart1"+this.charId]].y,e=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart1"+this.charId]].width,i=this.oVehiclesImgData.oData.oAtlasData[oImageIds["vehiclePart1"+this.charId]].height;ctx.drawImage(this.oVehiclesImgData.img,a,t,e,i,this.x-e/2*this.scale-100*this.rotation*.5*this.scale+200*Math.max(Math.min(this.roadXPerc-ground.carPos,.2),-.2)*this.scale,s+(35+.2*this.jumpHeight)*this.scale,e*this.scale,i*this.scale),ctx.fillStyle=aCharData[this.charId].boardCol,ctx.beginPath(),ctx.moveTo(this.x-26*this.scale-200*Math.max(Math.min(this.roadXPerc-ground.carPos,.2),-.2)*this.scale,s),ctx.lineTo(this.x+26*this.scale-200*Math.max(Math.min(this.roadXPerc-ground.carPos,.2),-.2)*this.scale,s),ctx.lineTo(this.x+46*this.scale-100*this.rotation*.5*this.scale+200*Math.max(Math.min(this.roadXPerc-ground.carPos,.2),-.2)*this.scale,s+(37+.2*this.jumpHeight)*this.scale),ctx.lineTo(this.x-46*this.scale-100*this.rotation*.5*this.scale+200*Math.max(Math.min(this.roadXPerc-ground.carPos,.2),-.2)*this.scale,s+(37+.2*this.jumpHeight)*this.scale),ctx.fill(),ctx.lineWidth=2*this.scale,ctx.strokeStyle="#000000",ctx.beginPath(),ctx.moveTo(this.x-26*this.scale-200*Math.max(Math.min(this.roadXPerc-ground.carPos,.2),-.2)*this.scale,s),ctx.lineTo(this.x-46*this.scale-100*this.rotation*.5*this.scale+200*Math.max(Math.min(this.roadXPerc-ground.carPos,.2),-.2)*this.scale,s+(37+.2*this.jumpHeight)*this.scale),ctx.stroke(),ctx.beginPath(),ctx.moveTo(this.x+26*this.scale-200*Math.max(Math.min(this.roadXPerc-ground.carPos,.2),-.2)*this.scale,s),ctx.lineTo(this.x+46*this.scale-100*this.rotation*.5*this.scale+200*Math.max(Math.min(this.roadXPerc-ground.carPos,.2),-.2)*this.scale,s+(37+.2*this.jumpHeight)*this.scale),ctx.stroke();h="stillChar"+this.charId;panel.lightningZapId==this.charId&&panel.incY<panel.lightningZapInc+30&&Math.floor(panel.incY)%2&&(h="zapChar"+this.charId);a=this.oEnemyCharsImgData.oData.oAtlasData[oImageIds[h]].x,t=this.oEnemyCharsImgData.oData.oAtlasData[oImageIds[h]].y,e=this.oEnemyCharsImgData.oData.oAtlasData[oImageIds[h]].width,i=this.oEnemyCharsImgData.oData.oAtlasData[oImageIds[h]].height;ctx.drawImage(this.oEnemyCharsImgData.img,a,t,e,i,this.x-100*this.rotation*.2*this.scale-e/2*this.scale+aCharData[this.charId].oStillCharOffset.x*this.scale,this.y+(this.jumpHeight-250)*this.scale-i/2*this.scale+aCharData[this.charId].oStillCharOffset.y*this.scale,e*this.scale,i*this.scale)}this.renderPointer()},a}();a.GhostSkater=t}(Elements||(Elements={})),function(a){var t=function(){function a(a){this.dataGroupNum=2,this.saveDataId=a;var t,e=!1;try{t=window.localStorage,e=!0}catch(a){console.log("local storage denied"),e=!1,this.canStore=!1}if(e)try{t.setItem("test","1"),t.removeItem("test"),this.canStore=!0}catch(a){this.canStore=!1}this.clearData(),this.setInitialData()}return a.prototype.clearData=function(){this.aLevelStore=new Array;for(var a=0;a<14;a++)a<7?this.aLevelStore.push(1):this.aLevelStore.push(0),this.aLevelStore.push(0),this.aLevelStore.push(0),this.aLevelStore.push(0),this.aLevelStore.push(0),this.aLevelStore.push(0),this.aLevelStore.push(0),this.aLevelStore.push(0),this.aLevelStore.push(0),this.aLevelStore.push(0);this.aLevelStore.push(0)},a.prototype.resetData=function(){this.clearData(),this.saveData()},a.prototype.setInitialData=function(){if(this.canStore&&"undefined"!=typeof Storage)if(null!=localStorage.getItem(this.saveDataId)&&""!=localStorage.getItem(this.saveDataId))for(var a in this.aLevelStore=localStorage.getItem(this.saveDataId).split(","),this.aLevelStore)this.aLevelStore[a]=parseInt(this.aLevelStore[a]);else this.saveData()},a.prototype.setData=function(a,t){for(var e=0;e<t.length;e++)if(0==this.aLevelStore.length||this.aLevelStore.length<=a*this.dataGroupNum+e){for(var i=0;i<a*this.dataGroupNum+e-this.aLevelStore.length-1;i++)this.aLevelStore.push(0);this.aLevelStore.push(t[e])}else this.aLevelStore[a*this.dataGroupNum+e]=t[e]},a.prototype.getCharLockStatus=function(a){return this.aLevelStore[10*a]},a.prototype.getUpgradeLockStatus=function(a,t){return this.aLevelStore[10*a+t+1]},a.prototype.getStatBonus=function(a){return a>2?0:this.aLevelStore[10*curChar+a+1]},a.prototype.unlockChar=function(a){this.aLevelStore[10*a]=1},a.prototype.unlockUpgrade=function(a,t){if(t<=2)this.aLevelStore[10*a+t+1]++;else{for(var e=3*Math.floor(t/3),i=0;i<3;i++)2==this.aLevelStore[10*a+e+i+1]&&(this.aLevelStore[10*a+e+i+1]=1);this.aLevelStore[10*a+t+1]=2}},a.prototype.turnOffUnlockedkUpgrade=function(a,t){for(var e=3*Math.floor(t/3),i=0;i<3;i++)2==this.aLevelStore[10*a+e+i+1]&&(this.aLevelStore[10*a+e+i+1]=1)},a.prototype.getVehicleData=function(a){return[this.aLevelStore[10*a+4],this.aLevelStore[10*a+5],this.aLevelStore[10*a+6]]},a.prototype.getBonusData=function(a){return[this.aLevelStore[10*a+7],this.aLevelStore[10*a+8],this.aLevelStore[10*a+9]]},a.prototype.getCash=function(){return this.aLevelStore[140]},a.prototype.updateCash=function(a){this.aLevelStore[140]+=a},a.prototype.anyUpgradeBought=function(a){for(var t=!1,e=0;e<9;e++)if(this.getUpgradeLockStatus(a,e)>0){t=!0;break}return t},a.prototype.saveData=function(){if(this.canStore&&"undefined"!=typeof Storage){for(var a="",t=0;t<this.aLevelStore.length;t++)a+=this.aLevelStore[t],t<this.aLevelStore.length-1&&(a+=",");localStorage.setItem(this.saveDataId,a)}},a}();a.SaveDataHandler=t}(Utils||(Utils={}));var previousTime,canvasX,canvasY,canvasScale,sound,music,assetLib,preAssetLib,delta,requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.requestAnimationFrame||function(a){window.setTimeout(a,1e3/60,(new Date).getTime())},canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),maxWidth=700,minWidth=700,maxHeight=700,minHeight=700,isRotated=!1,div=document.getElementById("canvas-wrapper"),audioType=0,muted=!1,splashTimer=0,isMobile=!1,gameState="loading",aLangs=new Array("EN"),curLang="",isBugBrowser=!1,isIE10=!1,radian=Math.PI/180,ios9FirstTouch=!1,hasFocus=!0,saveDataHandler=new Utils.SaveDataHandler("skaterushv4");navigator.userAgent.match(/MSIE\s([\d]+)/)&&(isIE10=!0);var deviceAgent=navigator.userAgent.toLowerCase();(deviceAgent.match(/(iphone|ipod|ipad)/)||deviceAgent.match(/(android)/)||deviceAgent.match(/(iemobile)/)||deviceAgent.match(/iphone/i)||deviceAgent.match(/ipad/i)||deviceAgent.match(/ipod/i)||deviceAgent.match(/blackberry/i)||deviceAgent.match(/bada/i))&&(isMobile=!0,deviceAgent.match(/(android)/)&&!/Chrome/.test(navigator.userAgent)&&(isBugBrowser=!0));var userInput=new Utils.UserInput(canvas,isBugBrowser);function visibleResume(){hasFocus||(userInput&&userInput.checkKeyFocus(),muted||"pause"==gameState||"splash"==gameState||"loading"==gameState||(Howler.mute(!1),playMusic())),hasFocus=!0}function visiblePause(){hasFocus=!1,Howler.mute(!0),music.pause()}function playMusic(){music.playing()||music.play()}function isStock(){var a=window.navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);return a&&parseFloat(a[1])<537}resizeCanvas(),window.onresize=function(){setTimeout(function(){resizeCanvas()},1)},window.onpageshow=function(){hasFocus||(userInput&&userInput.checkKeyFocus(),muted||"pause"==gameState||"splash"==gameState||"loading"==gameState||(Howler.mute(!1),playMusic())),hasFocus=!0},window.onpagehide=function(){hasFocus=!1,Howler.mute(!0),music.pause()},window.addEventListener("load",function(){setTimeout(function(){resizeCanvas()},0),window.addEventListener("orientationchange",function(){setTimeout(function(){resizeCanvas()},500),setTimeout(function(){resizeCanvas()},2e3)},!1)});var panel,background,ua=navigator.userAgent,isSharpStock=/SHL24|SH-01F/i.test(ua)&&isStock(),isXperiaAStock=/SO-04E/i.test(ua)&&isStock(),isFujitsuStock=/F-01F/i.test(ua)&&isStock();isIE10||isSharpStock||isXperiaAStock||isFujitsuStock||void 0===window.AudioContext&&void 0===window.webkitAudioContext&&-1!=navigator.userAgent.indexOf("Android")?audioType=0:(audioType=1,sound=new Howl({src:["audio/sound.mp3"],sprite:{backScreen:[0,280.1587301587302],boost:[1500,703.8548752834469],buyChar:[3e3,519.7959183673469],buyItem:[4500,461.08843537414936],buyUpgrade:[6e3,244.4897959183674],click:[7500,242.15419501133795],coin0:[9e3,461.08843537414936],coin1:[10500,208.97959183673544],coin2:[12e3,349.9773242630386],countDown:[13500,170.88435374149748],dust:[15e3,244.4897959183674],earnCoins0:[16500,349.97732426303685],earnCoins1:[18e3,692.5170068027206],earnCoins2:[19500,741.8820861678022],earnCoins3:[21e3,928.2993197278913],endGame0:[22500,1076.3718820861677],endGame1:[25e3,516.0090702947855],endGame2:[26500,915.9183673469399],endTourn:[28e3,835.8956916099771],enemyOvertake:[29500,361.97278911564723],hitEnemy:[31e3,295.17006802721113],hitWall0:[32500,92.85714285714164],hitWall1:[34e3,93.01587301587233],hitWall2:[35500,93.10657596371641],itemLocked:[37e3,283.46938775510466],jump:[38500,550.5442176870758],lightning:[4e4,1639.637188208617],mapScreen:[42500,475.01133786848015],overtake:[44e3,738.3219954648509],powerUp:[45500,743.015873015871],raceEnd:[47e3,743.015873015871],raceStart:[48500,1404.807256235827],selectChar:[51e3,529.8412698412704],silence:[52500,502.8798185941028],upgradeScreen:[54e3,285.7142857142847]}}),music=new Howl({src:["audio/music.mp3"],volume:.5,loop:!0}));var panelFrame,oLogoBut,musicTween,ground,userSkater,aEnemySkaters,aTrackObjects,aRacePositions,aEffects,aLeaderboard,aUserRaceResults,gameType,prevGameState,raceTime,aGhostData,ghostSkater,totalScore=0,levelScore=0,aTutorials=new Array,oLogoData={},oImageIds={},rightSteer=0,leftSteer=0,testVar="---",firstRun=!0,curChar=null,aCharData=new Array({stats:[.6,.6,.4],cost:0,vehicleType:0,boardCol:"#FFFFFF",oCharOffset:{x:5,y:-10},oStillCharOffset:{x:0,y:5},tiltFrameStart:7,logo:4},{stats:[.5,.5,.6],cost:0,vehicleType:0,boardCol:"#448E57",oCharOffset:{x:-3,y:0},oStillCharOffset:{x:0,y:10},tiltFrameStart:7,logo:5},{stats:[.7,.4,.5],cost:0,vehicleType:0,boardCol:"#E93E17",oCharOffset:{x:5,y:5},oStillCharOffset:{x:0,y:27},tiltFrameStart:7,logo:3},{stats:[.7,.3,.6],cost:0,vehicleType:0,boardCol:"#BBBBBB",oCharOffset:{x:0,y:20},oStillCharOffset:{x:0,y:25},tiltFrameStart:7,logo:1},{stats:[.4,.7,.5],cost:0,vehicleType:1,boardCol:"#FD66CB",oCharOffset:{x:50,y:-5},oStillCharOffset:{x:50,y:10},tiltFrameStart:12,logo:4},{stats:[.3,.5,.6],cost:0,vehicleType:1,boardCol:"#B88462",oCharOffset:{x:25,y:0},oStillCharOffset:{x:0,y:0},tiltFrameStart:7,logo:0},{stats:[.4,.6,.5],cost:0,vehicleType:1,boardCol:"#4BD97E",oCharOffset:{x:0,y:50},oStillCharOffset:{x:0,y:50},tiltFrameStart:7,logo:2},{stats:[.7,.5,.6],cost:700,vehicleType:0,boardCol:"#6C3E8D",oCharOffset:{x:0,y:20},oStillCharOffset:{x:0,y:35},tiltFrameStart:7,logo:1},{stats:[.5,.7,.4],cost:700,vehicleType:1,boardCol:"#FCBB7D",oCharOffset:{x:0,y:30},oStillCharOffset:{x:0,y:50},tiltFrameStart:7,logo:4},{stats:[.6,.6,.7],cost:1e3,vehicleType:1,boardCol:"#394596",oCharOffset:{x:5,y:15},oStillCharOffset:{x:0,y:30},tiltFrameStart:7,logo:1},{stats:[.4,.4,.6],cost:1e3,vehicleType:1,boardCol:"#A6D5FF",oCharOffset:{x:30,y:0},oStillCharOffset:{x:0,y:0},tiltFrameStart:7,logo:0},{stats:[.3,.7,.4],cost:1250,vehicleType:0,boardCol:"#48BA63",oCharOffset:{x:5,y:-5},oStillCharOffset:{x:0,y:8},tiltFrameStart:7,logo:2},{stats:[.6,.7,.5],cost:1500,vehicleType:0,boardCol:"#FFDF22",oCharOffset:{x:-5,y:10},oStillCharOffset:{x:0,y:22},tiltFrameStart:7,logo:1},{stats:[.7,.6,.6],cost:2e3,vehicleType:1,boardCol:"#9ACB49",oCharOffset:{x:0,y:10},oStillCharOffset:{x:0,y:15},tiltFrameStart:7,logo:3},{boardCol:"#FFB600"},{boardCol:"#696969"},{boardCol:"#DE0000"},{boardCol:"#80D6EB"},{boardCol:"#FFDE00"},{boardCol:"#FFFFFF"}),aUpgradeData=new Array({aCost:[100,150,200,250,300]},{aCost:[100,150,200,250,300]},{aCost:[100,150,200,250,300]},{aCost:[300]},{aCost:[400]},{aCost:[500]},{aCost:[200]},{aCost:[250]},{aCost:[300]}),oUpgrades={aUpgrades:[0,0,0],aVehicles:[0,0,0],aBonus:[0,0,0]},userCharPos=0,raceLength=400,raceNum=0,aPosPoints=new Array(10,8,6,4,2,1,0,0,0,0,0,0,0,0),raceSelected=-1,challengeTime=-1,challengeChar=-1,charLookup="sWPeIzrvTBRaySuEbdmUcfQMinxYXqVljhLDOwHZFpJNGtKCAkgo",resetConfirmOn=!1;function loadLang(a){void 0===a&&(a="en"),curLang=a,loadPreAssets()}function initSplash(){gameState="splash","ar"==curLang&&(document.body.style.direction="rtl"),resizeCanvas(),1!=audioType||muted||(playMusic(),hasFocus||music.pause()),challengeTime=-1,initStartScreen()}function initStartScreen(){gameState="start",userInput.removeHitArea("moreGames"),1==audioType&&music.fade(music.volume(),.5,500),curChar=null,levelScore=0,totalScore=0,resetLeaderboard();var a={oImgData:assetLib.getData("uiButs"),aPos:[43,43],align:[0,0],id:oImageIds.infoBut,idOver:oImageIds.infoButOver};if(userInput.addHitArea("credits",butEventHandler,null,"image",a),-1==challengeTime){var t={oImgData:assetLib.getData("uiButs"),aPos:[0,0],align:[.5,.8],id:oImageIds.playBut,idOver:oImageIds.playButOver,flash:!0};userInput.addHitArea("tournamentFromStart",butEventHandler,null,"image",t);var e=new Array(t,a)}else{var i={oImgData:assetLib.getData("uiButs"),aPos:[0,0],align:[.5,.75],id:oImageIds.playBut,idOver:oImageIds.playButOver,flash:!0};userInput.addHitArea("challengeFromStart",butEventHandler,null,"image",i);var s={oImgData:assetLib.getData("uiButs"),aPos:[55,-43],align:[0,1],id:oImageIds.backBut,idOver:oImageIds.backButOver};userInput.addHitArea("backFromStart",butEventHandler,null,"image",s);e=new Array(i,s,a)}aEnemySkaters=new Array,aTrackObjects=new Array,ground=new Elements.Ground,userSkater=new Elements.UserSkater,aUserRaceResults=new Array,addMuteBut(e),(panel=new Elements.Panel(gameState,e)).startTween1(),previousTime=(new Date).getTime(),updateStartScreenEvent()}function resetLeaderboard(){aLeaderboard=new Array;for(var a=0;a<14;a++)aLeaderboard.push({charId:a,score:0})}function initCharSelect(){gameState="charSelect",raceNum=0,curChar=null;var a=new Array;aEnemySkaters=new Array,aTrackObjects=new Array,ground=new Elements.Ground,userSkater=new Elements.UserSkater,addMuteBut(a),panel=new Elements.Panel(gameState,a),setCharSelectButs(),aEffects=new Array,panel.startTween1(),previousTime=(new Date).getTime(),updateCharSelectEvent()}function setCharSelectButs(){userInput.removeHitArea("charSelect");var a=1;if(canvas.height>canvas.width)for(var t=0;t<14;t++){if(a=Math.min((canvas.height-400)/460,1),saveDataHandler.getCharLockStatus(t)&&challengeChar!=t){panel.removeBut(oImageIds["char"+t+"But"]);var e={oImgData:assetLib.getData("uiButs"),aPos:[t%5*(138*a)-276*a,148*Math.floor(t/5)*a+75*a+75],align:[.5,0],scale:a,id:oImageIds["char"+t+"But"],idOver:oImageIds["char"+t+"ButOver"],flash:!0};userInput.addHitArea("charSelect",butEventHandler,{id:t,locked:!1},"image",e)}else{if(panel.removeBut(oImageIds["char"+t+"ButGrey"]),saveDataHandler.getCash()>=aCharData[t].cost&&challengeChar!=t)e={oImgData:assetLib.getData("uiButs"),aPos:[t%5*(138*a)-276*a,148*Math.floor(t/5)*a+75*a+75],align:[.5,0],scale:a,id:oImageIds["char"+t+"ButGrey"],idOver:oImageIds["char"+t+"But"],flash:!0};else e={oImgData:assetLib.getData("uiButs"),aPos:[t%5*(138*a)-276*a,148*Math.floor(t/5)*a+75*a+75],align:[.5,0],scale:a,id:oImageIds["char"+t+"ButGrey"],idOver:oImageIds["char"+t+"ButGrey"]};userInput.addHitArea("charSelect",butEventHandler,{id:t,locked:!0},"image",e)}panel.aButs.push(e)}else for(t=0;t<14;t++){if(a=Math.min((canvas.width-20)/965,1),saveDataHandler.getCharLockStatus(t)&&challengeChar!=t){panel.removeBut(oImageIds["char"+t+"But"]);e={oImgData:assetLib.getData("uiButs"),aPos:[t%7*(138*a)-414*a,148*Math.floor(t/7)*a+75*a+75],align:[.5,0],scale:a,id:oImageIds["char"+t+"But"],idOver:oImageIds["char"+t+"ButOver"],flash:!0};userInput.addHitArea("charSelect",butEventHandler,{id:t,locked:!1},"image",e)}else{if(panel.removeBut(oImageIds["char"+t+"ButGrey"]),saveDataHandler.getCash()>=aCharData[t].cost&&challengeChar!=t)e={oImgData:assetLib.getData("uiButs"),aPos:[t%7*(138*a)-414*a,148*Math.floor(t/7)*a+75*a+75],align:[.5,0],scale:a,id:oImageIds["char"+t+"ButGrey"],idOver:oImageIds["char"+t+"But"],flash:!0};else e={oImgData:assetLib.getData("uiButs"),aPos:[t%7*(138*a)-414*a,148*Math.floor(t/7)*a+75*a+75],align:[.5,0],scale:a,id:oImageIds["char"+t+"ButGrey"],idOver:oImageIds["char"+t+"ButGrey"]};userInput.addHitArea("charSelect",butEventHandler,{id:t,locked:!0},"image",e)}panel.aButs.push(e)}}function initUpgrades(){gameState="upgrades",playSound("upgradeScreen");var a={oImgData:assetLib.getData("uiButs"),aPos:[55,-43],align:[0,1],id:oImageIds.backBut,idOver:oImageIds.backButOver};userInput.addHitArea("backFromUpgrades",butEventHandler,null,"image",a);var t=new Array(a);if("gameEnd1"!=prevGameState){var e={oImgData:assetLib.getData("uiButs"),aPos:[-100,-76],align:[1,1],id:oImageIds.playBut,idOver:oImageIds.playButOver,flash:!0};userInput.addHitArea("nextFromUpgrades",butEventHandler,null,"image",e),t.push(e)}aEnemySkaters=new Array,aTrackObjects=new Array,ground=new Elements.Ground,userSkater=new Elements.UserSkater,addMuteBut(t),panel=new Elements.Panel(gameState,t),setUpgradeButs(),aEffects=new Array,panel.startTween1(),panel.tweenCharInfo(),previousTime=(new Date).getTime(),updateUpgradesEvent()}function setUpgradeButs(){userInput.removeHitArea("upgradeSelect");for(var a=1,t=0;t<9;t++){var e,i,s,h=t.toString(),o=!1;t<3||t>5?(panel.removeBut(oImageIds["upgrade"+t+"But"]),panel.removeBut(oImageIds["upgrade"+t+"ButGrey"])):(h+=aCharData[curChar].vehicleType,panel.removeBut(oImageIds["upgrade"+h+"But"]),panel.removeBut(oImageIds["upgrade"+h+"ButGrey"]));var r=saveDataHandler.getStatBonus(t);if((t>=3&&saveDataHandler.getUpgradeLockStatus(curChar,t)>0||saveDataHandler.getCash()>=aUpgradeData[t].aCost[r])&&saveDataHandler.getUpgradeLockStatus(curChar,t)<=4?(e="upgrade"+h+"But",i="upgrade"+h+"ButOver",o=!0,s=!1):(e="upgrade"+h+"ButGrey",i="upgrade"+h+"ButGrey",s=!0),canvas.height>canvas.width){a=Math.min((canvas.height-400)/460,1);var n={oImgData:assetLib.getData("uiButs"),aPos:[t%3*(138*a)-138*a,148*Math.floor(t/3)*a+75*a+75],align:[.5,0],scale:a,id:oImageIds[e],idOver:oImageIds[i],flash:o};userInput.addHitArea("upgradeSelect",butEventHandler,{id:t,locked:s},"image",n),panel.aButs.push(n)}else{a=Math.min((canvas.width-20)/965,1);n={oImgData:assetLib.getData("uiButs"),aPos:[t%5*(138*a)-276*a,148*Math.floor(t/5)*a+75*a+75],align:[.5,0],scale:a,id:oImageIds[e],idOver:oImageIds[i],flash:o};userInput.addHitArea("upgradeSelect",butEventHandler,{id:t,locked:s},"image",n),panel.aButs.push(n)}}}function addMuteBut(a){if(1==audioType){var t=oImageIds.muteBut0,e=oImageIds.muteBut0Over;muted&&(t=oImageIds.muteBut1,e=oImageIds.muteBut1Over);var i={oImgData:assetLib.getData("uiButs"),aPos:[-43,43],align:[1,0],id:t,idOver:e};userInput.addHitArea("mute",butEventHandler,null,"image",i);for(var s=0;s<a.length;s++)if(a[s].id==oImageIds.muteBut0||a[s].id==oImageIds.muteBut1)return;a.push(i)}}function initCreditsScreen(){gameState="credits";var a={oImgData:assetLib.getData("uiButs"),aPos:[55,-43],align:[0,1],id:oImageIds.backBut,idOver:oImageIds.backButOver},t={oImgData:assetLib.getData("uiButs"),aPos:[-43,-43],align:[1,1],id:oImageIds.resetBut,idOver:oImageIds.resetButOver};userInput.addHitArea("backFromCharSelect",butEventHandler,null,"image",a),userInput.addHitArea("resetData",butEventHandler,null,"image",t);var e=new Array(a,t);addMuteBut(e),(panel=new Elements.Panel(gameState,e)).startTween1(),previousTime=(new Date).getTime(),updateCreditsScreenEvent()}function initResetConfirm(){var a={oImgData:assetLib.getData("uiButs"),aPos:[-225,-155],align:[1,1],id:oImageIds.yesBut,idOver:oImageIds.yesButOver},t={oImgData:assetLib.getData("uiButs"),aPos:[-125,-155],align:[1,1],id:oImageIds.noBut,idOver:oImageIds.noButOver};userInput.addHitArea("resetYes",butEventHandler,null,"image",a),userInput.addHitArea("resetNo",butEventHandler,null,"image",t),panel.aButs.push(a,t)}function initGameIntro(){gameState="gameIntro",playSound("mapScreen");var a={oImgData:assetLib.getData("uiButs"),aPos:[-100,-76],align:[1,1],id:oImageIds.playBut,idOver:oImageIds.playButOver,flash:!0},t={oImgData:assetLib.getData("uiButs"),aPos:[-290,-76],align:[1,1],id:oImageIds.upgradeBut,idOver:oImageIds.upgradeButOver,flash:!0};userInput.addHitArea("nextFromGameIntro",butEventHandler,null,"image",a),userInput.addHitArea("upgradeFromGameIntro",butEventHandler,null,"image",t);var e=new Array(a,t);aEnemySkaters=new Array,aTrackObjects=new Array,ground=new Elements.Ground,userSkater=new Elements.UserSkater,addMuteBut(e),(panel=new Elements.Panel(gameState,e)).startTween1(),previousTime=(new Date).getTime(),updateGameIntro()}function initRaceSelect(){gameState="raceSelect",playSound("mapScreen"),raceSelected=-1;var a={oImgData:assetLib.getData("uiButs"),aPos:[55,-43],align:[0,1],id:oImageIds.backBut,idOver:oImageIds.backButOver};userInput.addHitArea("backFromRaceSelect",butEventHandler,null,"image",a);var t=new Array(a);aEnemySkaters=new Array,aTrackObjects=new Array,ground=new Elements.Ground,userSkater=new Elements.UserSkater,addMuteBut(t),panel=new Elements.Panel(gameState,t),updateRaceSelectbuts(),panel.startTween1(),previousTime=(new Date).getTime(),updateRaceSelect()}function updateRaceSelectbuts(){userInput.removeHitArea("nextFromRaceSelect"),panel.removeBut(oImageIds.playBut),userInput.removeHitArea("raceFromRaceSelect"),panel.removeBut(oImageIds.mapRaceBut);for(var a=0;a<panel.aMapPoints.length;a++)if(a!=raceSelected){var t={oImgData:assetLib.getData("uiButs"),aPos:[panel.aMapPoints[a][0],panel.aMapPoints[a][1]],align:[.5,.45],id:oImageIds.mapRaceBut,idOver:oImageIds.mapRaceButOver,flash:!0};userInput.addHitArea("raceFromRaceSelect",butEventHandler,{id:a},"image",t),panel.aButs.push(t)}if(-1!=raceSelected){var e={oImgData:assetLib.getData("uiButs"),aPos:[-100,-76],align:[1,1],id:oImageIds.playBut,idOver:oImageIds.playButOver,flash:!0};userInput.addHitArea("nextFromRaceSelect",butEventHandler,null,"image",e),panel.aButs.push(e)}}function initGame(){gameState="game",1==audioType&&music.fade(music.volume(),1,1e3),raceTime=0;var a={oImgData:assetLib.getData("uiButs"),aPos:[43,43],align:[0,0],id:oImageIds.pauseBut,idOver:oImageIds.pauseButOver};userInput.addHitArea("pause",butEventHandler,null,"image",a);var t=new Array(a);isMobile&&(userInput.addHitArea("steerLeft",butEventHandler,{multiTouch:!0},"rect",{aRect:[0,60,canvas.width/2,canvas.height]},!0),userInput.addHitArea("steerRight",butEventHandler,{multiTouch:!0},"rect",{aRect:[canvas.width/2,60,canvas.width,canvas.height]},!0)),userInput.addKey("steerRight",butEventHandler,null,39),userInput.addKey("steerLeft",butEventHandler,null,37),userInput.addKey("upKey",butEventHandler,null,38),userInput.addKey("downKey",butEventHandler,null,40),addMuteBut(t),aEnemySkaters=new Array,aTrackObjects=new Array,aEffects=new Array,rightSteer=leftSteer=0,ground=new Elements.Ground,userSkater=new Elements.UserSkater,(aRacePositions=new Array).push(userSkater);for(var e=setStartRacePositions(),i=0;i<13;i++){var s=e[i],h=new Elements.EnemySkater(i,s);aEnemySkaters.push(h),aRacePositions.push(h)}-1!=challengeTime&&(ghostSkater=new Elements.GhostSkater(challengeChar)),(panel=new Elements.Panel(gameState,t)).startSequence(),panel.startTween1(),previousTime=(new Date).getTime(),updateGameEvent()}function setStartRacePositions(){for(var a=new Array,t=new Array,e=0;e<14;e++)e!=curChar&&t.push(e);var i=new Array;for(e=0;e<4;e++)i.push(e);for(e=0;e<4;e++){var s=Math.floor(Math.random()*i.length);a.push(t[i[s]]),i.splice(s,1)}i=new Array;for(e=4;e<7;e++)i.push(e);for(e=0;e<3;e++){s=Math.floor(Math.random()*i.length);a.push(t[i[s]]),i.splice(s,1)}i=new Array;for(e=7;e<10;e++)i.push(e);for(e=0;e<3;e++){s=Math.floor(Math.random()*i.length);a.push(t[i[s]]),i.splice(s,1)}i=new Array;for(e=10;e<13;e++)i.push(e);for(e=0;e<3;e++){s=Math.floor(Math.random()*i.length);a.push(t[i[s]]),i.splice(s,1)}return a}function initPause(){gameState="pause";var a={oImgData:assetLib.getData("uiButs"),aPos:[-100,0],align:[.5,.5],id:oImageIds.playBut,idOver:oImageIds.playButOver},t={oImgData:assetLib.getData("uiButs"),aPos:[100,0],align:[.5,.5],id:oImageIds.quitBut,idOver:oImageIds.quitButOver};userInput.addHitArea("playFromPause",butEventHandler,null,"image",a),userInput.addHitArea("quitFromPause",butEventHandler,null,"image",t);var e=new Array(a,t);(panel=new Elements.Panel(gameState,e)).startTween1(),previousTime=(new Date).getTime(),background=new Elements.Background,updatePauseEvent()}function resumeGame(){gameState="game",background=new Elements.Background,isMobile&&(userInput.addHitArea("steerLeft",butEventHandler,{multiTouch:!0},"rect",{aRect:[0,60,canvas.width/2,canvas.height]},!0),userInput.addHitArea("steerRight",butEventHandler,{multiTouch:!0},"rect",{aRect:[canvas.width/2,60,canvas.width,canvas.height]},!0)),userInput.addKey("steerRight",butEventHandler,null,39),userInput.addKey("steerLeft",butEventHandler,null,37),userInput.addKey("upKey",butEventHandler,null,38),userInput.addKey("downKey",butEventHandler,null,40);var a={oImgData:assetLib.getData("uiButs"),aPos:[43,43],align:[0,0],id:oImageIds.pauseBut,idOver:oImageIds.pauseButOver};userInput.addHitArea("pause",butEventHandler,null,"image",a);var t=new Array(a);addMuteBut(t),(panel=new Elements.Panel(gameState,t)).startTween1(),previousTime=(new Date).getTime(),updateGameEvent()}function butEventHandler(a,t){switch(a){case"langSelect":curLang=t.lang,ctx.clearRect(0,0,canvas.width,canvas.height),userInput.removeHitArea("langSelect"),(preAssetLib=new Utils.AssetLoader(curLang,[{id:"preloadImage",file:"images/preloadImage.jpg"}],ctx,canvas.width,canvas.height,!1)).onReady(initLoadAssets);break;case"credits":playSound("click"),userInput.removeHitArea("tournamentFromStart"),userInput.removeHitArea("challengeFromStart"),userInput.removeHitArea("backFromStart"),userInput.removeHitArea("upgradeFromStart"),userInput.removeHitArea("credits"),userInput.removeHitArea("mute"),initCreditsScreen();break;case"backFromCredits":playSound("backScreen"),userInput.removeHitArea("backFromCredits"),userInput.removeHitArea("resetData"),userInput.removeHitArea("resetYes"),userInput.removeHitArea("resetNo"),userInput.removeHitArea("mute"),initStartScreen();break;case"moreGames":case"moreGamesPause":break;case"resetData":playSound("click"),resetConfirmOn||(initResetConfirm(),resetConfirmOn=!0);break;case"resetYes":playSound("endGame3"),userInput.removeHitArea("backFromCredits"),userInput.removeHitArea("resetData"),userInput.removeHitArea("resetYes"),userInput.removeHitArea("resetNo"),userInput.removeHitArea("mute"),resetConfirmOn=!1,saveDataHandler.resetData(),resetChallengeData(),initStartScreen();break;case"resetNo":playSound("endGame3"),resetConfirmOn=!1,userInput.removeHitArea("resetYes"),panel.removeBut(oImageIds.yesBut),userInput.removeHitArea("resetNo"),panel.removeBut(oImageIds.noBut);break;case"tournamentFromStart":playSound("click"),userInput.removeHitArea("tournamentFromStart"),userInput.removeHitArea("challengeFromStart"),userInput.removeHitArea("backFromStart"),userInput.removeHitArea("upgradeFromStart"),userInput.removeHitArea("credits"),userInput.removeHitArea("mute"),gameType=0,initCharSelect();break;case"challengeFromStart":playSound("click"),userInput.removeHitArea("tournamentFromStart"),userInput.removeHitArea("challengeFromStart"),userInput.removeHitArea("backFromStart"),userInput.removeHitArea("upgradeFromStart"),userInput.removeHitArea("credits"),userInput.removeHitArea("mute"),gameType=1,initCharSelect();break;case"backFromStart":playSound("backScreen"),userInput.removeHitArea("tournamentFromStart"),userInput.removeHitArea("challengeFromStart"),userInput.removeHitArea("backFromStart"),userInput.removeHitArea("upgradeFromStart"),userInput.removeHitArea("credits"),userInput.removeHitArea("mute"),challengeTime=-1,initStartScreen();break;case"raceFromRaceSelect":playSound("click"),raceSelected=raceNum=t.id,ground=new Elements.Ground,updateRaceSelectbuts();break;case"backFromRaceSelect":playSound("backScreen"),userInput.removeHitArea("backFromRaceSelect"),userInput.removeHitArea("raceFromRaceSelect"),userInput.removeHitArea("nextFromRaceSelect"),initCharSelect();break;case"nextFromRaceSelect":playSound("click"),userInput.removeHitArea("backFromRaceSelect"),userInput.removeHitArea("raceFromRaceSelect"),userInput.removeHitArea("nextFromRaceSelect"),initGame();break;case"charSelect":if(t.id==challengeChar);else if(t.locked||curChar==t.id)if(t.locked&&saveDataHandler.getCash()>=aCharData[t.id].cost){playSound("buyChar"),curChar=t.id,panel.tweenCharInfo(),userInput.removeHitArea("nextFromCharSelect"),panel.removeBut(oImageIds.playBut);s={oImgData:assetLib.getData("uiButs"),aPos:[-100,-76],align:[1,1],id:oImageIds.playBut,idOver:oImageIds.playButOver,flash:!0};userInput.addHitArea("nextFromCharSelect",butEventHandler,null,"image",s),panel.aButs.push(s),saveDataHandler.unlockChar(t.id),saveDataHandler.updateCash(-aCharData[t.id].cost),saveDataHandler.saveData(),setCharSelectButs();for(var e=0;e<10;e++){var i=new Elements.CoinShower(assetLib.getData("coin"),t.x,t.y);aEffects.push(i)}}else t.locked&&saveDataHandler.getCash()<aCharData[t.id].cost&&(playSound("itemLocked"),panel.jiggleCash());else{playSound("selectChar"),curChar=t.id,panel.tweenCharInfo(),userInput.removeHitArea("nextFromCharSelect"),panel.removeBut(oImageIds.playBut);var s={oImgData:assetLib.getData("uiButs"),aPos:[-100,-76],align:[1,1],id:oImageIds.playBut,idOver:oImageIds.playButOver,flash:!0};userInput.addHitArea("nextFromCharSelect",butEventHandler,null,"image",s),panel.aButs.push(s)}break;case"backFromCharSelect":playSound("backScreen"),userInput.removeHitArea("backFromCharSelect"),userInput.removeHitArea("nextFromCharSelect"),userInput.removeHitArea("charSelect"),userInput.removeHitArea("mute"),initStartScreen();break;case"nextFromCharSelect":playSound("click"),userInput.removeHitArea("backFromCharSelect"),userInput.removeHitArea("nextFromCharSelect"),userInput.removeHitArea("charSelect"),userInput.removeHitArea("mute"),raceNum=0,0==gameType?initGameIntro():-1==challengeTime?initRaceSelect():(raceNum=raceSelected,initGame());break;case"nextFromGameIntro":playSound("click"),userInput.removeHitArea("mute"),userInput.removeHitArea("nextFromGameIntro"),userInput.removeHitArea("upgradeFromGameIntro"),initGame();break;case"upgradeFromGameIntro":playSound("click"),prevGameState=gameState,userInput.removeHitArea("mute"),userInput.removeHitArea("nextFromGameIntro"),userInput.removeHitArea("upgradeFromGameIntro"),initUpgrades();break;case"upgradeSelect":if(t.locked)t.locked&&saveDataHandler.getCash()<aUpgradeData[t.id].aCost[h]&&saveDataHandler.getUpgradeLockStatus(curChar,t.id)<=4&&(panel.jiggleCash(),playSound("itemLocked"));else{var h=saveDataHandler.getStatBonus(t.id);if(t.id<=2||0==saveDataHandler.getUpgradeLockStatus(curChar,t.id)){saveDataHandler.updateCash(-aUpgradeData[t.id].aCost[h]);for(e=0;e<10;e++){i=new Elements.CoinShower(assetLib.getData("coin"),t.x,t.y);aEffects.push(i)}t.id<=2?playSound("buyUpgrade"):playSound("buyItem")}2==saveDataHandler.getUpgradeLockStatus(curChar,t.id)?saveDataHandler.turnOffUnlockedkUpgrade(curChar,t.id):saveDataHandler.unlockUpgrade(curChar,t.id),saveDataHandler.saveData(),setUpgradeButs()}break;case"backFromUpgrades":playSound("backScreen"),userInput.removeHitArea("backFromUpgrades"),userInput.removeHitArea("nextFromUpgrades"),userInput.removeHitArea("upgradeSelect"),userInput.removeHitArea("mute"),"gameIntro"==prevGameState?initGameIntro():"gameEnd0"==prevGameState?(prevGameState="upgrades",initGameEnd0(!1)):"gameEnd1"==prevGameState&&(prevGameState="upgrades",initGameEnd1(!1));break;case"nextFromUpgrades":playSound("click"),userInput.removeHitArea("backFromUpgrades"),userInput.removeHitArea("nextFromUpgrades"),userInput.removeHitArea("upgradeSelect"),userInput.removeHitArea("mute"),"gameIntro"==prevGameState?initGame():"gameEnd0"==prevGameState&&(4==raceNum?initTournamentEnd():(raceNum++,initGameIntro()));break;case"steerLeft":t.isDown?(leftSteer=1,rightSteer=0):leftSteer=0;break;case"steerRight":t.isDown?(rightSteer=-1,leftSteer=0):rightSteer=0;break;case"mute":playSound("click"),toggleMute(),muted?panel.switchBut(oImageIds.muteBut0,oImageIds.muteBut1,oImageIds.muteBut1Over):panel.switchBut(oImageIds.muteBut1,oImageIds.muteBut0,oImageIds.muteBut0Over);break;case"pause":playSound("click"),1==audioType?(Howler.mute(!0),music.pause()):2==audioType&&music.pause(),userInput.removeHitArea("pause"),userInput.removeHitArea("steerLeft"),userInput.removeHitArea("steerRight"),userInput.removeKey("steerRight"),userInput.removeKey("steerLeft"),userInput.removeHitArea("mute"),initPause();break;case"nextFromGameEnd0":playSound("click"),userInput.removeHitArea("mute"),userInput.removeHitArea("nextFromGameEnd0"),userInput.removeHitArea("upgradeFromGameEnd0"),4==raceNum?initTournamentEnd():(raceNum++,initGameIntro());break;case"retryFromGameEnd1":playSound("click"),userInput.removeHitArea("mute"),userInput.removeHitArea("retryFromGameEnd1"),userInput.removeHitArea("upgradeFromGameEnd1"),userInput.removeHitArea("backFromGameEnd1"),userInput.removeHitArea("copyLinkFromGameEnd1"),-1==challengeTime?initGame():raceTime>challengeTime?initGame():(resetChallengeData(),initStartScreen());break;case"upgradeFromGameEnd1":playSound("click"),userInput.removeHitArea("mute"),userInput.removeHitArea("retryFromGameEnd1"),userInput.removeHitArea("upgradeFromGameEnd1"),userInput.removeHitArea("backFromGameEnd1"),userInput.removeHitArea("copyLinkFromGameEnd1"),prevGameState=gameState,initUpgrades();break;case"backFromGameEnd1":playSound("backScreen"),userInput.removeHitArea("mute"),userInput.removeHitArea("retryFromGameEnd1"),userInput.removeHitArea("upgradeFromGameEnd1"),userInput.removeHitArea("copyLinkFromGameEnd1"),userInput.removeHitArea("backFromGameEnd1"),resetChallengeData(),initStartScreen();break;case"copyLinkFromGameEnd1":playSound("click");var o=assetLib.textData.langText.challengeLink[curLang]+getChallengeCode(),r=!1;if(null!=navigator.clipboard&&navigator.clipboard.writeText(o).then(function(){r=!0},function(a){console.error("Clipboard copy error: ",a),r=!1}),!r){r=!0;var n=document.createElement("textArea");n.readOnly=!1,n.contenteditable=!0,n.value=o,document.body.appendChild(n),n.select(),n.setSelectionRange(0,99999);try{document.execCommand("copy")}catch(a){r=!1,console.warn("Clipboard copy error: "+a)}document.body.removeChild(n)}panel.copySuccess=r?1:-1;break;case"nextFromTournamentEnd":playSound("click"),userInput.removeHitArea("mute"),userInput.removeHitArea("nextFromTournamentEnd"),initStartScreen();break;case"playFromPause":playSound("click"),1==audioType?muted||(Howler.mute(!1),playMusic()):2==audioType&&(muted||playMusic()),userInput.removeHitArea("playFromPause"),userInput.removeHitArea("quitFromPause"),userInput.removeHitArea("mute"),resumeGame();break;case"quitFromPause":playSound("click"),1==audioType?muted||(Howler.mute(!1),playMusic()):2==audioType&&(muted||playMusic()),userInput.removeHitArea("playFromPause"),userInput.removeHitArea("quitFromPause"),userInput.removeHitArea("mute"),levelScore=0,totalScore=0,resetChallengeData(),initStartScreen()}}function resetChallengeData(){raceSelected=-1,challengeChar=-1,challengeTime=-1}function getChallengeCode(){for(var a=raceTime.toString(),t="?skcid="+charLookup.charAt(raceSelected)+charLookup.charAt(curChar),e=0;e<a.length;)t+=charLookup.charAt(parseInt(a.charAt(e))),e++;return t}function getRaceTimeFromCode(a){for(var t="",e=0;e<a.length;)0==e?raceSelected=charLookup.indexOf(a.charAt(e)):1==e?challengeChar=charLookup.indexOf(a.charAt(e)):t+=charLookup.indexOf(a.charAt(e)),e++;challengeTime=parseInt(t)}function addTrackObject(a,t,e){if(void 0===e&&(e=0),"coin"==a){var i=new Elements.Coin(t);aTrackObjects.push(i)}else if("pickUp"==a){var s=new Elements.PickUp(t,e);aTrackObjects.push(s)}}function addParticle(a,t,e){var i=new Elements.Shard(a,t,e);aEffects.push(i)}function updateScore(a){levelScore+=a}function initGameEnd0(a){void 0===a&&(a=!0),gameState="gameEnd0",playSound(userCharPos<4?"endGame0":userCharPos<=10?"endGame1":"endGame2"),1==audioType&&music.fade(music.volume(),.5,500),userInput.removeHitArea("pause"),userInput.removeHitArea("steerLeft"),userInput.removeHitArea("steerRight"),userInput.removeKey("steerRight"),userInput.removeKey("steerLeft");var t={oImgData:assetLib.getData("uiButs"),aPos:[-100,-76],align:[1,1],id:oImageIds.playBut,idOver:oImageIds.playButOver,flash:!0};userInput.addHitArea("nextFromGameEnd0",butEventHandler,null,"image",t);var e=new Array(t);addMuteBut(e),panel=new Elements.Panel(gameState,e),aEffects=new Array,aEnemySkaters=new Array,aTrackObjects=new Array,ground=new Elements.Ground,userSkater=new Elements.UserSkater,panel.startTween1(),a&&panel.endScreenTween0(),previousTime=(new Date).getTime(),updateGameEnd0()}function initGameEnd1(a){void 0===a&&(a=!0),gameState="gameEnd1",1==audioType&&music.fade(music.volume(),.5,500),playSound(-1==challengeTime||raceTime<challengeTime?"endGame0":"endGame2"),userInput.removeHitArea("pause"),userInput.removeHitArea("steerLeft"),userInput.removeHitArea("steerRight"),userInput.removeKey("steerRight"),userInput.removeKey("steerLeft");var t=new Array;if(-1==challengeTime){var e={oImgData:assetLib.getData("uiButs"),aPos:[-100,-76],align:[1,1],id:oImageIds.retryBut,idOver:oImageIds.retryButOver,flash:!0},i={oImgData:assetLib.getData("uiButs"),aPos:[0,90],align:[.5,.45],id:oImageIds.copyLinkBut,idOver:oImageIds.copyLinkButOver,flash:!0};userInput.addHitArea("copyLinkFromGameEnd1",butEventHandler,null,"image",i),t.push(i)}else if(raceTime>challengeTime)e={oImgData:assetLib.getData("uiButs"),aPos:[-100,-76],align:[1,1],id:oImageIds.retryBut,idOver:oImageIds.retryButOver,flash:!0};else e={oImgData:assetLib.getData("uiButs"),aPos:[-100,-76],align:[1,1],id:oImageIds.playBut,idOver:oImageIds.playButOver,flash:!0};var s={oImgData:assetLib.getData("uiButs"),aPos:[-290,-76],align:[1,1],id:oImageIds.upgradeBut,idOver:oImageIds.upgradeButOver,flash:!0},h={oImgData:assetLib.getData("uiButs"),aPos:[55,-43],align:[0,1],id:oImageIds.backBut,idOver:oImageIds.backButOver};userInput.addHitArea("retryFromGameEnd1",butEventHandler,null,"image",e),userInput.addHitArea("upgradeFromGameEnd1",butEventHandler,null,"image",s),userInput.addHitArea("backFromGameEnd1",butEventHandler,null,"image",h),t.push(e,s,h),addMuteBut(t),panel=new Elements.Panel(gameState,t),aEffects=new Array,aEnemySkaters=new Array,aTrackObjects=new Array,ground=new Elements.Ground,userSkater=new Elements.UserSkater,panel.startTween1(),a&&panel.endScreenTween1(),previousTime=(new Date).getTime(),updateGameEnd1()}function initTournamentEnd(){gameState="tournamentEnd",playSound("endTourn");var a={oImgData:assetLib.getData("uiButs"),aPos:[-100,-76],align:[1,1],id:oImageIds.playBut,idOver:oImageIds.playButOver,flash:!0};userInput.addHitArea("nextFromTournamentEnd",butEventHandler,null,"image",a);var t=new Array(a);addMuteBut(t),panel=new Elements.Panel(gameState,t),aEffects=new Array,aEnemySkaters=new Array,aTrackObjects=new Array,aEffects=new Array;for(var e=0;e<50;e++){var i=new Elements.Confetti;aEffects.push(i)}ground=new Elements.Ground,userSkater=new Elements.UserSkater,panel.startTween1(),panel.endScreenTween0(),previousTime=(new Date).getTime(),updateTournamentEnd()}function updateGameEvent(){if("game"==gameState){if(delta=getDelta(),1==gameType&&ground.aRoad[0].id<raceLength&&userSkater.raceStarted&&(raceTime+=Math.min(Math.round(100*delta),59900),-1!=challengeTime)){var a=(raceLength-30)/challengeTime*raceTime+30;ghostSkater.segId=Math.floor(a),ghostSkater.segPerc=a-ghostSkater.segId}for(var t=0;t<aEnemySkaters.length;t++)0!=aEnemySkaters[t].offscreenState&&(aEnemySkaters[t].update(),aEnemySkaters[t].render());ground.update(),ground.render(),ground.aRoad[0].id<raceLength&&aRacePositions.sort(function(a,t){return t.segId-a.segId});for(t=0;t<aRacePositions.length;t++){if(!aRacePositions[t].isEnemy){userCharPos=t;break}aRacePositions[t].curPos=t}for(t=0;t<aRacePositions.length;t++)aRacePositions[t].isEnemy&&0==aRacePositions[t].offscreenState&&t>userCharPos-5&&aRacePositions[t].renderPointer();for(t=0;t<aTrackObjects.length;t++)aTrackObjects[t].hasHit&&(aTrackObjects[t].update(),aTrackObjects[t].render()),aTrackObjects[t].removeMe&&(aTrackObjects.splice(t,1),t-=1);for(t=0;t<aEffects.length;t++)aEffects[t].update(),aEffects[t].render(),aEffects[t].removeMe&&(aEffects.splice(t,1),t-=1);userSkater.update(),userSkater.render(),panel.update(),panel.render(),checkButtonsOver(),requestAnimFrame(updateGameEvent)}}function updateCreditsScreenEvent(){if("credits"==gameState){delta=getDelta();for(var a=0;a<aTrackObjects.length;a++)aTrackObjects[a].removeMe&&(aTrackObjects.splice(a,1),a-=1);ground.update(),ground.render(),userSkater.update(),userSkater.render(),panel.update(),panel.render(),checkButtonsOver(),requestAnimFrame(updateCreditsScreenEvent)}}function updateGameIntro(){if("gameIntro"==gameState){delta=getDelta();for(var a=0;a<aTrackObjects.length;a++)aTrackObjects[a].removeMe&&(aTrackObjects.splice(a,1),a-=1);ground.update(),ground.render(),userSkater.update(),userSkater.render(),panel.update(),panel.render();for(a=0;a<aEffects.length;a++)aEffects[a].update(),aEffects[a].render(),aEffects[a].removeMe&&(aEffects.splice(a,1),a-=1);checkButtonsOver(),requestAnimFrame(updateGameIntro)}}function updateRaceSelect(){if("raceSelect"==gameState){delta=getDelta();for(var a=0;a<aTrackObjects.length;a++)aTrackObjects[a].removeMe&&(aTrackObjects.splice(a,1),a-=1);ground.update(),ground.render(),userSkater.update(),userSkater.render(),panel.update(),panel.render();for(a=0;a<aEffects.length;a++)aEffects[a].update(),aEffects[a].render(),aEffects[a].removeMe&&(aEffects.splice(a,1),a-=1);checkButtonsOver(),requestAnimFrame(updateRaceSelect)}}function updateGameEnd0(){if("gameEnd0"==gameState){delta=getDelta();for(var a=0;a<aTrackObjects.length;a++)aTrackObjects[a].removeMe&&(aTrackObjects.splice(a,1),a-=1);ground.update(),ground.render(),userSkater.update(),userSkater.render(),panel.update(),panel.render();for(a=0;a<aEffects.length;a++)aEffects[a].update(),aEffects[a].render(),aEffects[a].removeMe&&(aEffects.splice(a,1),a-=1);checkButtonsOver(),requestAnimFrame(updateGameEnd0)}}function updateGameEnd1(){if("gameEnd1"==gameState){delta=getDelta();for(var a=0;a<aTrackObjects.length;a++)aTrackObjects[a].removeMe&&(aTrackObjects.splice(a,1),a-=1);ground.update(),ground.render(),userSkater.update(),userSkater.render(),panel.update(),panel.render();for(a=0;a<aEffects.length;a++)aEffects[a].update(),aEffects[a].render(),aEffects[a].removeMe&&(aEffects.splice(a,1),a-=1);checkButtonsOver(),requestAnimFrame(updateGameEnd1)}}function updateTournamentEnd(){if("tournamentEnd"==gameState){delta=getDelta();for(var a=0;a<aTrackObjects.length;a++)aTrackObjects[a].removeMe&&(aTrackObjects.splice(a,1),a-=1);ground.update(),ground.render(),userSkater.update(),userSkater.render(),panel.update(),panel.render();for(a=0;a<aEffects.length;a++)aEffects[a].update(),aEffects[a].render(),aEffects[a].removeMe&&(aEffects.splice(a,1),a-=1);checkButtonsOver(),requestAnimFrame(updateTournamentEnd)}}function updateSplashScreenEvent(){if("splash"==gameState){if(delta=getDelta(),(splashTimer+=delta)>2.5)return 1!=audioType||muted||(playMusic(),hasFocus||music.pause()),void initStartScreen();background.render(),panel.update(),panel.render(),checkButtonsOver(),requestAnimFrame(updateSplashScreenEvent)}}function updateStartScreenEvent(){if("start"==gameState){delta=getDelta();for(var a=0;a<aTrackObjects.length;a++)aTrackObjects[a].removeMe&&(aTrackObjects.splice(a,1),a-=1);ground.update(),ground.render(),userSkater.update(),userSkater.render(),panel.update(),panel.render(),checkButtonsOver(),requestAnimFrame(updateStartScreenEvent)}}function updateUpgradesEvent(){if("upgrades"==gameState){delta=getDelta();for(var a=0;a<aTrackObjects.length;a++)aTrackObjects[a].removeMe&&(aTrackObjects.splice(a,1),a-=1);ground.update(),ground.render(),userSkater.update(),userSkater.render(),panel.update(),panel.render();for(a=0;a<aEffects.length;a++)aEffects[a].update(),aEffects[a].render(),aEffects[a].removeMe&&(aEffects.splice(a,1),a-=1);checkButtonsOver(),requestAnimFrame(updateUpgradesEvent)}}function updateCharSelectEvent(){if("charSelect"==gameState){delta=getDelta();for(var a=0;a<aTrackObjects.length;a++)aTrackObjects[a].removeMe&&(aTrackObjects.splice(a,1),a-=1);ground.update(),ground.render(),userSkater.update(),userSkater.render(),panel.update(),panel.render();for(a=0;a<aEffects.length;a++)aEffects[a].update(),aEffects[a].render(),aEffects[a].removeMe&&(aEffects.splice(a,1),a-=1);checkButtonsOver(),requestAnimFrame(updateCharSelectEvent)}}function updateLoaderEvent(){"load"==gameState&&(delta=getDelta(),assetLib.render(),requestAnimFrame(updateLoaderEvent))}function updatePauseEvent(){"pause"==gameState&&(delta=getDelta(),background.render(),panel.update(),panel.render(),checkButtonsOver(),requestAnimFrame(updatePauseEvent))}function addDirectText(a,t,e,i,s,h,o,r){void 0===r&&(r="#202020"),ctx.fillStyle=r,ctx.textAlign=i,ctx.font=t+"px "+assetLib.textData.langText["font"+a][curLang],ctx.fillText(o,s,h)}function addText(a,t,e,i,s,h,o,r){if(void 0===r&&(r="#202020"),ctx.fillStyle=r,ctx.textAlign=i,e<getTextWidth(a,t,o)){for(t--;e<getTextWidth(a,t,o);)t--}"ar"==curLang&&(h-=t/15),ctx.font=t+"px "+assetLib.textData.langText["font"+a][curLang],ctx.fillText(getText(o),s,h)}function getText(a){return assetLib.textData.langText[a][curLang]}function getTextWidth(a,t,e){return ctx.font=t+"px "+assetLib.textData.langText["font"+a][curLang],ctx.measureText(getText(e)).width}function getCorrectedTextWidth(a,t,e,i){if(e<getTextWidth(a,t,i)){for(t--;e<getTextWidth(a,t,i);)t--}return ctx.font=t+"px "+assetLib.textData.langText["font"+a][curLang],ctx.measureText(getText(i)).width}function checkButtonsOver(){if(!isMobile)for(var a=0;a<panel.aButs.length;a++)panel.aButs[a].isOver=!1,userInput.mouseX>panel.aButs[a].aOverData[0]&&userInput.mouseX<panel.aButs[a].aOverData[2]&&userInput.mouseY>panel.aButs[a].aOverData[1]&&userInput.mouseY<panel.aButs[a].aOverData[3]&&(panel.aButs[a].isOver=!0)}function clearButtonOvers(){userInput.mouseX=-100,userInput.mouseY=-100}function getDelta(){var a=(new Date).getTime(),t=(a-previousTime)/1e3;return previousTime=a,t>.5&&(t=0),t}function checkSpriteCollision(a,t){var e=a.x,i=a.y,s=t.x,h=t.y;return(e-s)*(e-s)+(i-h)*(i-h)<a.radius*t.radius}function getScaleImageToMax(a,t){return a.isSpriteSheet?t[0]/a.oData.spriteWidth<t[1]/a.oData.spriteHeight?Math.min(t[0]/a.oData.spriteWidth,1):Math.min(t[1]/a.oData.spriteHeight,1):t[0]/a.img.width<t[1]/a.img.height?Math.min(t[0]/a.img.width,1):Math.min(t[1]/a.img.height,1)}function getCentreFromTopLeft(a,t,e){var i=new Array;return i.push(a[0]+t.oData.spriteWidth/2*e),i.push(a[1]+t.oData.spriteHeight/2*e),i}function loadPreAssets(){preAssetLib=new Utils.AssetLoader(curLang,[{id:"loader",file:"images/preloader.png",oAtlasData:{id0:{x:0,y:0,width:792,height:102},id1:{x:0,y:104,width:778,height:81},id2:{x:0,y:187,width:520,height:335}}}],ctx,canvas.width,canvas.height,!1),oImageIds.overBar="id0",oImageIds.underBar="id1",oImageIds.logo="id2",preAssetLib.onReady(initLoadAssets)}function initLangSelect(){for(var a,t,e,i,s=0,h=0;h<aLangs.length&&(h+1)*(1*(a=preAssetLib.getData("lang"+aLangs[h])).img.width)+10*(h+2)<canvas.width;h++)s++;i=Math.ceil(aLangs.length/s);for(h=0;h<aLangs.length;h++){a=preAssetLib.getData("lang"+aLangs[h]),t=canvas.width/2-s/2*(1*a.img.width)-(s-1)/2*10,t+=h%s*(1*a.img.width+10),e=canvas.height/2-i/2*(1*a.img.height)-(i-1)/2*10,e+=Math.floor(h/s)%i*(1*a.img.height+10),ctx.drawImage(a.img,0,0,a.img.width,a.img.height,t,e,1*a.img.width,1*a.img.height);var o={oImgData:a,aPos:[t+1*a.img.width/2,e+1*a.img.height/2],scale:1,id:"none",noMove:!0};userInput.addHitArea("langSelect",butEventHandler,{lang:aLangs[h]},"image",o)}}function initLoadAssets(){loadAssets()}function loadAssets(){assetLib=new Utils.AssetLoader(curLang,[{id:"info",file:"images/info.png"},{id:"flare",file:"images/flare.png"},{id:"uiButs",file:"images/uiButs.png",oAtlasData:{id0:{x:180,y:339,width:178,height:129},id1:{x:0,y:339,width:178,height:129},id10:{x:1044,y:1345,width:77,height:77},id100:{x:495,y:540,width:133,height:133},id101:{x:450,y:748,width:133,height:133},id102:{x:783,y:1346,width:89,height:89},id103:{x:874,y:1346,width:89,height:89},id104:{x:0,y:0,width:369,height:102},id105:{x:0,y:104,width:369,height:102},id106:{x:0,y:601,width:178,height:129},id107:{x:0,y:732,width:178,height:129},id108:{x:1303,y:213,width:77,height:78},id109:{x:1303,y:293,width:77,height:78},id11:{x:1303,y:134,width:77,height:77},id110:{x:1314,y:0,width:77,height:78},id111:{x:1360,y:1344,width:77,height:78},id12:{x:585,y:1345,width:97,height:77},id13:{x:684,y:1345,width:97,height:77},id14:{x:0,y:1125,width:178,height:129},id15:{x:0,y:1256,width:178,height:129},id16:{x:180,y:208,width:178,height:129},id17:{x:180,y:470,width:178,height:129},id18:{x:1123,y:1345,width:77,height:77},id19:{x:765,y:539,width:77,height:77},id2:{x:0,y:470,width:178,height:129},id20:{x:965,y:1346,width:77,height:77},id21:{x:360,y:748,width:77,height:77},id22:{x:1259,y:537,width:132,height:132},id23:{x:1259,y:403,width:132,height:132},id24:{x:1258,y:1210,width:132,height:132},id25:{x:1169,y:269,width:132,height:132},id26:{x:1180,y:0,width:132,height:132},id27:{x:1125,y:1076,width:132,height:132},id28:{x:855,y:539,width:133,height:132},id29:{x:855,y:1077,width:133,height:132},id3:{x:0,y:208,width:178,height:129},id30:{x:855,y:808,width:133,height:132},id31:{x:855,y:942,width:133,height:133},id32:{x:900,y:269,width:133,height:133},id33:{x:855,y:1211,width:133,height:133},id34:{x:900,y:135,width:133,height:132},id35:{x:990,y:941,width:133,height:132},id36:{x:990,y:807,width:133,height:132},id37:{x:765,y:404,width:133,height:133},id38:{x:765,y:269,width:133,height:133},id39:{x:990,y:672,width:133,height:133},id4:{x:0,y:863,width:178,height:129},id40:{x:855,y:673,width:133,height:133},id41:{x:776,y:0,width:133,height:133},id42:{x:990,y:1075,width:133,height:133},id43:{x:990,y:538,width:133,height:132},id44:{x:911,y:0,width:133,height:132},id45:{x:900,y:404,width:133,height:132},id46:{x:1035,y:268,width:132,height:132},id47:{x:1035,y:402,width:132,height:132},id48:{x:1046,y:0,width:132,height:132},id49:{x:1125,y:536,width:132,height:133},id5:{x:0,y:994,width:178,height:129},id50:{x:1125,y:671,width:132,height:133},id51:{x:1124,y:1210,width:132,height:133},id52:{x:1125,y:941,width:132,height:133},id53:{x:1169,y:134,width:132,height:133},id54:{x:1125,y:806,width:132,height:133},id55:{x:1035,y:134,width:132,height:132},id56:{x:1259,y:1073,width:132,height:132},id57:{x:990,y:1210,width:132,height:132},id58:{x:720,y:1210,width:133,height:132},id59:{x:720,y:1076,width:133,height:132},id6:{x:1281,y:1344,width:77,height:77},id60:{x:720,y:942,width:133,height:132},id61:{x:1259,y:939,width:132,height:132},id62:{x:1259,y:671,width:132,height:132},id63:{x:1259,y:805,width:132,height:132},id64:{x:630,y:538,width:133,height:132},id65:{x:765,y:135,width:133,height:132},id66:{x:630,y:269,width:133,height:132},id67:{x:630,y:135,width:133,height:132},id68:{x:585,y:1211,width:133,height:132},id69:{x:585,y:1077,width:133,height:132},id7:{x:1202,y:1345,width:77,height:77},id70:{x:585,y:943,width:133,height:132},id71:{x:585,y:809,width:133,height:132},id72:{x:585,y:675,width:133,height:132},id73:{x:180,y:732,width:178,height:129},id74:{x:180,y:601,width:178,height:129},id75:{x:495,y:270,width:133,height:133},id76:{x:506,y:0,width:133,height:133},id77:{x:495,y:135,width:133,height:133},id78:{x:450,y:1288,width:133,height:133},id79:{x:450,y:1153,width:133,height:133},id8:{x:1169,y:403,width:77,height:77},id80:{x:450,y:1018,width:133,height:133},id81:{x:450,y:883,width:133,height:133},id82:{x:641,y:0,width:133,height:133},id83:{x:630,y:403,width:133,height:133},id84:{x:360,y:613,width:133,height:133},id85:{x:360,y:478,width:133,height:133},id86:{x:720,y:807,width:133,height:133},id87:{x:720,y:672,width:133,height:133},id88:{x:315,y:1268,width:133,height:133},id89:{x:315,y:1133,width:133,height:133},id9:{x:1382,y:80,width:77,height:77},id90:{x:315,y:998,width:133,height:133},id91:{x:371,y:0,width:133,height:133},id92:{x:360,y:343,width:133,height:133},id93:{x:360,y:208,width:133,height:133},id94:{x:180,y:1268,width:133,height:133},id95:{x:315,y:863,width:133,height:133},id96:{x:180,y:863,width:133,height:133},id97:{x:180,y:998,width:133,height:133},id98:{x:180,y:1133,width:133,height:133},id99:{x:495,y:405,width:133,height:133}}},{id:"uiElements",file:"images/uiElements.png",oAtlasData:{id0:{x:0,y:0,width:700,height:700},id1:{x:2010,y:1196,width:182,height:296},id10:{x:0,y:702,width:661,height:278},id11:{x:848,y:1893,width:261,height:224},id12:{x:1584,y:1981,width:197,height:212},id13:{x:1401,y:720,width:218,height:207},id14:{x:1386,y:1260,width:222,height:209},id15:{x:1421,y:463,width:215,height:221},id16:{x:1358,y:1835,width:224,height:226},id17:{x:1529,y:0,width:192,height:215},id18:{x:1509,y:240,width:213,height:210},id19:{x:1401,y:929,width:218,height:187},id2:{x:880,y:1381,width:257,height:323},id20:{x:1358,y:1621,width:224,height:212},id21:{x:1282,y:240,width:225,height:221},id22:{x:2010,y:1494,width:159,height:231},id23:{x:1937,y:0,width:200,height:216},id24:{x:1937,y:218,width:199,height:215},id25:{x:667,y:1381,width:110,height:43},id26:{x:1724,y:0,width:211,height:253},id27:{x:1797,y:1883,width:211,height:253},id28:{x:1823,y:941,width:211,height:253},id29:{x:1797,y:1373,width:211,height:253},id3:{x:2036,y:751,width:151,height:200},id30:{x:1282,y:0,width:245,height:238},id31:{x:927,y:540,width:245,height:238},id32:{x:1111,y:1946,width:245,height:238},id33:{x:1797,y:1628,width:211,height:253},id34:{x:1154,y:780,width:245,height:238},id35:{x:1174,y:480,width:245,height:238},id36:{x:1139,y:1381,width:245,height:238},id37:{x:1724,y:255,width:211,height:253},id38:{x:1621,y:686,width:211,height:253},id39:{x:1154,y:1020,width:245,height:238},id4:{x:1834,y:510,width:207,height:239},id40:{x:1509,y:1118,width:98,height:99},id41:{x:555,y:1381,width:110,height:43},id42:{x:884,y:1159,width:257,height:220},id43:{x:555,y:1159,width:327,height:220},id44:{x:702,y:379,width:262,height:159},id45:{x:663,y:702,width:262,height:159},id46:{x:808,y:863,width:73,height:72},id47:{x:770,y:2051,width:74,height:72},id48:{x:779,y:1381,width:73,height:72},id49:{x:0,y:1895,width:422,height:154},id5:{x:2010,y:1727,width:159,height:265},id50:{x:0,y:2105,width:259,height:79},id51:{x:702,y:0,width:331,height:377},id52:{x:424,y:1895,width:422,height:154},id53:{x:0,y:1542,width:469,height:77},id54:{x:0,y:982,width:553,height:479},id55:{x:702,y:636,width:80,height:49},id56:{x:0,y:2051,width:371,height:52},id57:{x:770,y:2125,width:66,height:67},id58:{x:838,y:2125,width:66,height:66},id59:{x:1584,y:1471,width:211,height:253},id6:{x:897,y:863,width:255,height:290},id60:{x:1610,y:1118,width:211,height:253},id61:{x:1584,y:1726,width:211,height:253},id62:{x:1111,y:1706,width:245,height:238},id63:{x:1035,y:0,width:245,height:238},id64:{x:1035,y:240,width:245,height:238},id65:{x:1386,y:1471,width:107,height:142},id66:{x:832,y:540,width:93,height:146},id67:{x:1401,y:1118,width:106,height:139},id68:{x:1477,y:2063,width:98,height:99},id69:{x:663,y:863,width:143,height:95},id7:{x:624,y:2051,width:144,height:133},id70:{x:464,y:2051,width:158,height:100},id71:{x:261,y:2119,width:201,height:71},id72:{x:1621,y:941,width:89,height:103},id73:{x:702,y:540,width:128,height:94},id74:{x:1358,y:2063,width:117,height:100},id75:{x:0,y:1621,width:467,height:272},id76:{x:471,y:1463,width:407,height:428},id77:{x:1263,y:1260,width:118,height:119},id78:{x:1143,y:1260,width:118,height:119},id79:{x:373,y:2051,width:85,height:63},id8:{x:880,y:1706,width:183,height:184},id80:{x:555,y:982,width:340,height:175},id9:{x:0,y:1463,width:469,height:77}}},{id:"gameElements",file:"images/gameElements.png",oAtlasData:{id0:{x:948,y:822,width:143,height:425},id1:{x:0,y:376,width:320,height:336},id10:{x:1176,y:1545,width:127,height:146},id11:{x:1056,y:1397,width:127,height:146},id12:{x:1096,y:0,width:127,height:146},id13:{x:1047,y:1607,width:127,height:146},id14:{x:952,y:1249,width:127,height:146},id15:{x:1082,y:514,width:127,height:146},id16:{x:1096,y:296,width:127,height:146},id17:{x:1081,y:1249,width:127,height:146},id18:{x:1093,y:810,width:127,height:146},id19:{x:951,y:514,width:129,height:148},id2:{x:762,y:476,width:187,height:344},id20:{x:902,y:1608,width:143,height:143},id21:{x:766,y:1462,width:143,height:144},id22:{x:911,y:1462,width:143,height:143},id23:{x:0,y:1713,width:17,height:35},id24:{x:19,y:1713,width:12,height:35},id25:{x:0,y:0,width:501,height:35},id26:{x:766,y:1306,width:184,height:154},id27:{x:764,y:171,width:185,height:154},id28:{x:0,y:714,width:301,height:504},id29:{x:1650,y:1158,width:108,height:314},id3:{x:545,y:0,width:202,height:236},id30:{x:1567,y:772,width:113,height:384},id31:{x:1185,y:1397,width:114,height:118},id32:{x:1093,y:1106,width:114,height:118},id33:{x:322,y:606,width:215,height:88},id34:{x:764,y:327,width:173,height:80},id35:{x:322,y:506,width:221,height:98},id36:{x:303,y:1080,width:236,height:88},id37:{x:253,y:1696,width:195,height:80},id38:{x:301,y:1220,width:243,height:97},id39:{x:0,y:1350,width:276,height:256},id4:{x:951,y:427,width:133,height:85},id40:{x:564,y:476,width:196,height:328},id41:{x:303,y:714,width:259,height:364},id42:{x:278,y:1350,width:264,height:203},id43:{x:564,y:806,width:194,height:152},id44:{x:0,y:1220,width:299,height:128},id45:{x:546,y:1080,width:202,height:237},id46:{x:0,y:1608,width:251,height:103},id47:{x:506,y:1668,width:207,height:112},id48:{x:749,y:0,width:190,height:169},id49:{x:0,y:37,width:321,height:337},id5:{x:322,y:376,width:236,height:128},id50:{x:951,y:0,width:143,height:425},id51:{x:759,y:960,width:187,height:344},id52:{x:560,y:238,width:202,height:236},id53:{x:760,y:822,width:175,height:86},id54:{x:544,y:1319,width:220,height:347},id55:{x:564,y:960,width:193,height:98},id56:{x:253,y:1608,width:251,height:86},id57:{x:715,y:1668,width:185,height:104},id58:{x:323,y:37,width:220,height:291},id59:{x:1305,y:1216,width:113,height:384},id6:{x:951,y:664,width:129,height:148},id60:{x:1225,y:0,width:113,height:384},id61:{x:1567,y:386,width:113,height:384},id62:{x:1222,y:830,width:113,height:384},id63:{x:1455,y:0,width:113,height:384},id64:{x:1452,y:772,width:113,height:384},id65:{x:1452,y:386,width:113,height:384},id66:{x:1420,y:1158,width:113,height:384},id67:{x:1337,y:772,width:113,height:384},id68:{x:1535,y:1158,width:113,height:384},id69:{x:1337,y:386,width:113,height:384},id7:{x:1093,y:958,width:127,height:146},id70:{x:1222,y:444,width:113,height:384},id71:{x:1340,y:0,width:113,height:384},id72:{x:1570,y:0,width:113,height:384},id8:{x:1082,y:662,width:127,height:146},id9:{x:1096,y:148,width:127,height:146}}},{id:"vehicles",file:"images/vehicles.png",oAtlasData:{id0:{x:0,y:0,width:139,height:164},id1:{x:444,y:466,width:73,height:73},id10:{x:444,y:576,width:56,height:33},id11:{x:294,y:498,width:96,height:28},id12:{x:498,y:426,width:56,height:33},id13:{x:196,y:498,width:96,height:28},id14:{x:423,y:0,width:139,height:164},id15:{x:423,y:316,width:73,height:73},id16:{x:519,y:461,width:56,height:33},id17:{x:196,y:528,width:96,height:28},id18:{x:444,y:541,width:56,height:33},id19:{x:98,y:558,width:96,height:28},id2:{x:0,y:166,width:139,height:164},id20:{x:556,y:426,width:56,height:33},id21:{x:196,y:558,width:96,height:28},id22:{x:0,y:332,width:139,height:164},id23:{x:369,y:528,width:73,height:73},id24:{x:282,y:166,width:139,height:164},id25:{x:423,y:391,width:73,height:73},id26:{x:498,y:391,width:56,height:33},id27:{x:0,y:558,width:96,height:28},id28:{x:282,y:0,width:139,height:164},id29:{x:423,y:241,width:73,height:73},id3:{x:498,y:316,width:73,height:73},id30:{x:282,y:332,width:139,height:164},id31:{x:423,y:166,width:73,height:73},id32:{x:141,y:166,width:139,height:164},id33:{x:294,y:528,width:73,height:73},id34:{x:556,y:391,width:56,height:33},id35:{x:0,y:528,width:96,height:28},id36:{x:502,y:576,width:56,height:33},id37:{x:0,y:498,width:96,height:28},id38:{x:519,y:496,width:56,height:33},id39:{x:98,y:528,width:96,height:28},id4:{x:141,y:0,width:139,height:164},id5:{x:498,y:241,width:73,height:73},id6:{x:141,y:332,width:139,height:164},id7:{x:498,y:166,width:73,height:73},id8:{x:502,y:541,width:56,height:33},id9:{x:98,y:498,width:96,height:28}}},{id:"enemyChars",file:"images/enemyChars.png",oAtlasData:{id0:{x:603,y:880,width:219,height:350},id1:{x:1022,y:351,width:179,height:349},id10:{x:0,y:660,width:340,height:328},id11:{x:1329,y:676,width:111,height:346},id12:{x:1248,y:1030,width:118,height:319},id13:{x:824,y:861,width:186,height:320},id14:{x:603,y:528,width:219,height:350},id15:{x:1022,y:0,width:179,height:349},id16:{x:1200,y:702,width:127,height:326},id17:{x:342,y:1142,width:208,height:289},id18:{x:342,y:835,width:259,height:305},id19:{x:0,y:990,width:340,height:328},id2:{x:1203,y:0,width:127,height:326},id20:{x:342,y:0,width:287,height:262},id21:{x:1117,y:1183,width:129,height:294},id22:{x:824,y:291,width:196,height:283},id23:{x:824,y:1183,width:160,height:279},id24:{x:0,y:0,width:340,height:328},id25:{x:1323,y:328,width:111,height:346},id26:{x:1203,y:328,width:118,height:319},id27:{x:1012,y:861,width:186,height:320},id3:{x:631,y:0,width:208,height:289},id4:{x:342,y:528,width:259,height:305},id5:{x:0,y:330,width:340,height:328},id6:{x:342,y:264,width:287,height:262},id7:{x:986,y:1183,width:129,height:294},id8:{x:824,y:576,width:196,height:283},id9:{x:841,y:0,width:160,height:279}}},{id:"coin",file:"images/coin_84x84.png",oAnims:{spin0:[0,1,2,3,4,5,6,7,8,9],spin1:[1,2,3,4,5,6,7,8,9,0],spin2:[2,3,4,5,6,7,8,9,0,1],spin3:[3,4,5,6,7,8,9,0,1,2],spin4:[4,5,6,7,8,9,0,1,2,3],spin5:[5,6,7,8,9,0,1,2,3,4],spin6:[6,7,8,9,0,1,2,3,4,5],spin7:[7,8,9,0,1,2,3,4,5,6],spin8:[8,9,0,1,2,3,4,5,6,7],spin9:[9,0,1,2,3,4,5,6,7,8]}},{id:"charRider0",file:"images/char0_326x361.png",oAnims:{startPause:[0],startGo:[1,2,3,4,5,6,16],jump:[26,27,28,29,30,31,32,33,34,35,34,33,32,31,30,29,28,27,26]}},{id:"charRider1",file:"images/char1_256x370.png",oAnims:{startPause:[0],startGo:[1,2,3,4,5,6,16],jump:[26,27,28,29,30,31,32,33,34,35,34,33,32,31,30,29,28,27,26]}},{id:"charRider2",file:"images/char2_197x336.png",oAnims:{startPause:[0],startGo:[1,2,3,4,5,6,16],jump:[26,27,28,29,30,31,32,33,34,35,34,33,32,31,30,29,28,27,26]}},{id:"charRider3",file:"images/char3_432x303.png",oAnims:{startPause:[0],startGo:[1,2,3,4,5,6,16],jump:[26,27,28,29,30,31,32,33,34,35,34,33,32,31,30,29,28,27,26]}},{id:"charRider4",file:"images/char4_380x340.png",oAnims:{startPause:[0],startGo:[1,2,3,4,5,6,7,8,9,10,11,21],jump:[31,32,33,34,35,36,37,38,39,40,39,38,37,36,35,34,33,32,31]}},{id:"charRider5",file:"images/char5_441x354.png",oAnims:{startPause:[0],startGo:[1,2,3,4,5,6,16],jump:[26,27,28,29,30,31,32,33,34,35,34,33,32,31,30,29,28,27,26]}},{id:"charRider6",file:"images/char6_357x277.png",oAnims:{startPause:[0],startGo:[1,2,3,4,5,6,16],jump:[26,27,28,29,30,31,32,33,34,35,34,33,32,31,30,29,28,27,26]}},{id:"charRider7",file:"images/char7_217x295.png",oAnims:{startPause:[0],startGo:[1,2,3,4,5,6,16],jump:[26,27,28,29,30,31,32,33,34,35,34,33,32,31,30,29,28,27,26]}},{id:"charRider8",file:"images/char8_392x312.png",oAnims:{startPause:[0],startGo:[1,2,3,4,5,6,16],jump:[26,27,28,29,30,31,32,33,34,35,34,33,32,31,30,29,28,27,26]}},{id:"charRider9",file:"images/char9_262x297.png",oAnims:{startPause:[0],startGo:[1,2,3,4,5,6,16],jump:[26,27,28,29,30,31,32,33,34,35,34,33,32,31,30,29,28,27,26]}},{id:"charRider10",file:"images/char10_428x364.png",oAnims:{startPause:[0],startGo:[1,2,3,4,5,6,16],jump:[26,27,28,29,30,31,32,33,34,35,34,33,32,31,30,29,28,27,26]}},{id:"charRider11",file:"images/char11_180x365.png",oAnims:{startPause:[0],startGo:[1,2,3,4,5,6,16],jump:[26,27,28,29,30,31,32,33,34,35,34,33,32,31,30,29,28,27,26]}},{id:"charRider12",file:"images/char12_223x333.png",oAnims:{startPause:[0],startGo:[1,2,3,4,5,6,16],jump:[26,27,28,29,30,31,32,33,34,35,34,33,32,31,30,29,28,27,26]}},{id:"charRider13",file:"images/char13_262x340.png",oAnims:{startPause:[0],startGo:[1,2,3,4,5,6,16],jump:[26,27,28,29,30,31,32,33,34,35,34,33,32,31,30,29,28,27,26]}},{id:"langText",file:"json/text.json"},{id:"numbers0",file:"images/numbers0_75x97.png"},{id:"numbers1",file:"images/numbers1_75x97.png"},{id:"numbers2",file:"images/numbers2_75x99.png"},{id:"titleLogo",file:"images/title/"+curLang+".png"},{id:"horizon0",file:"images/horizon0.jpg"},{id:"horizon1",file:"images/horizon1.jpg"},{id:"horizon2",file:"images/horizon2.jpg"},{id:"horizon3",file:"images/horizon3.jpg"},{id:"horizon4",file:"images/horizon4.jpg"}],ctx,canvas.width,canvas.height),oImageIds.vehiclePart00="id0",oImageIds.vehiclePart10="id1",oImageIds.vehiclePart01="id2",oImageIds.vehiclePart11="id3",oImageIds.vehiclePart02="id4",oImageIds.vehiclePart12="id5",oImageIds.vehiclePart03="id6",oImageIds.vehiclePart13="id7",oImageIds.vehiclePart04="id8",oImageIds.vehiclePart14="id9",oImageIds.vehiclePart05="id10",oImageIds.vehiclePart15="id11",oImageIds.vehiclePart06="id12",oImageIds.vehiclePart16="id13",oImageIds.vehiclePart07="id14",oImageIds.vehiclePart17="id15",oImageIds.vehiclePart08="id16",oImageIds.vehiclePart18="id17",oImageIds.vehiclePart09="id18",oImageIds.vehiclePart19="id19",oImageIds.vehiclePart010="id20",oImageIds.vehiclePart110="id21",oImageIds.vehiclePart011="id22",oImageIds.vehiclePart111="id23",oImageIds.vehiclePart012="id24",oImageIds.vehiclePart112="id25",oImageIds.vehiclePart013="id26",oImageIds.vehiclePart113="id27",oImageIds.vehiclePart014="id28",oImageIds.vehiclePart114="id29",oImageIds.vehiclePart015="id30",oImageIds.vehiclePart115="id31",oImageIds.vehiclePart016="id32",oImageIds.vehiclePart116="id33",oImageIds.vehiclePart017="id34",oImageIds.vehiclePart117="id35",oImageIds.vehiclePart018="id36",oImageIds.vehiclePart118="id37",oImageIds.vehiclePart019="id38",oImageIds.vehiclePart119="id39",oImageIds.stillChar0="id0",oImageIds.stillChar1="id1",oImageIds.stillChar2="id2",oImageIds.stillChar3="id3",oImageIds.stillChar4="id4",oImageIds.stillChar5="id5",oImageIds.stillChar6="id6",oImageIds.stillChar7="id7",oImageIds.stillChar8="id8",oImageIds.stillChar9="id9",oImageIds.stillChar10="id10",oImageIds.stillChar11="id11",oImageIds.stillChar12="id12",oImageIds.stillChar13="id13",oImageIds.zapChar0="id14",oImageIds.zapChar1="id15",oImageIds.zapChar2="id16",oImageIds.zapChar3="id17",oImageIds.zapChar4="id18",oImageIds.zapChar5="id19",oImageIds.zapChar6="id20",oImageIds.zapChar7="id21",oImageIds.zapChar8="id22",oImageIds.zapChar9="id23",oImageIds.zapChar10="id24",oImageIds.zapChar11="id25",oImageIds.zapChar12="id26",oImageIds.zapChar13="id27",oImageIds.roadSide00="id0",oImageIds.roadSide01="id1",oImageIds.roadSide02="id2",oImageIds.roadSide03="id3",oImageIds.roadSide04="id4",oImageIds.testShadow="id5",oImageIds.charPointer0="id6",oImageIds.charPointer1="id7",oImageIds.charPointer2="id8",oImageIds.charPointer3="id9",oImageIds.charPointer4="id10",oImageIds.charPointer5="id11",oImageIds.charPointer6="id12",oImageIds.charPointer7="id13",oImageIds.charPointer8="id14",oImageIds.charPointer9="id15",oImageIds.charPointer10="id16",oImageIds.charPointer11="id17",oImageIds.charPointer12="id18",oImageIds.charPointer13="id19",oImageIds.pickUp0="id20",oImageIds.pickUp2="id21",oImageIds.pickUp1="id22",oImageIds.uiDistEnd="id23",oImageIds.uiDistCap="id24",oImageIds.uiDistBar="id25",oImageIds.raceFlag0="id26",oImageIds.raceFlag1="id27",oImageIds.lightning="id28",oImageIds.endBanner="id29",oImageIds.raceBanner14="id30",oImageIds.leftSign="id31",oImageIds.rightSign="id32",oImageIds.bonus00="id33",oImageIds.bonus10="id34",oImageIds.bonus20="id35",oImageIds.bonus01="id36",oImageIds.bonus11="id37",oImageIds.bonus21="id38",oImageIds.roadSide10="id39",oImageIds.roadSide11="id40",oImageIds.roadSide12="id41",oImageIds.roadSide13="id42",oImageIds.roadSide14="id43",oImageIds.roadSide20="id44",oImageIds.roadSide21="id45",oImageIds.roadSide22="id46",oImageIds.roadSide23="id47",oImageIds.roadSide24="id48",oImageIds.roadSide30="id49",oImageIds.roadSide31="id50",oImageIds.roadSide32="id51",oImageIds.roadSide33="id52",oImageIds.roadSide34="id53",oImageIds.roadSide40="id54",oImageIds.roadSide41="id55",oImageIds.roadSide42="id56",oImageIds.roadSide43="id57",oImageIds.roadSide44="id58",oImageIds.raceBanner1="id59",oImageIds.raceBanner2="id60",oImageIds.raceBanner3="id61",oImageIds.raceBanner4="id62",oImageIds.raceBanner5="id63",oImageIds.raceBanner6="id64",oImageIds.raceBanner7="id65",oImageIds.raceBanner8="id66",oImageIds.raceBanner9="id67",oImageIds.raceBanner10="id68",oImageIds.raceBanner11="id69",oImageIds.raceBanner12="id70",oImageIds.raceBanner13="id71",oImageIds.raceBanner0="id72",oImageIds.jaggedFrame="id0",oImageIds.titleChar0="id1",oImageIds.titleChar1="id2",oImageIds.titleChar2="id3",oImageIds.titleChar3="id4",oImageIds.titleChar4="id5",oImageIds.titleChar5="id6",oImageIds.titleChar6="id7",oImageIds.titleChar7="id8",oImageIds.screenTitlePanel0="id9",oImageIds.charPanel="id10",oImageIds.charZoom0="id11",oImageIds.charZoom1="id12",oImageIds.charZoom2="id13",oImageIds.charZoom3="id14",oImageIds.charZoom4="id15",oImageIds.charZoom5="id16",oImageIds.charZoom6="id17",oImageIds.charZoom7="id18",oImageIds.charZoom8="id19",oImageIds.charZoom9="id20",oImageIds.charZoom10="id21",oImageIds.charZoom11="id22",oImageIds.charZoom12="id23",oImageIds.charZoom13="id24",oImageIds.costPanel1="id25",oImageIds.vehicle0="id26",oImageIds.vehicle1="id27",oImageIds.vehicle2="id28",oImageIds.vehicle3="id29",oImageIds.vehicle4="id30",oImageIds.vehicle5="id31",oImageIds.vehicle6="id32",oImageIds.vehicle7="id33",oImageIds.vehicle8="id34",oImageIds.vehicle9="id35",oImageIds.vehicle10="id36",oImageIds.vehicle11="id37",oImageIds.vehicle12="id38",oImageIds.vehicle13="id39",oImageIds.uiCoin0="id40",oImageIds.costPanel0="id41",oImageIds.tutA0="id42",oImageIds.tutA1="id43",oImageIds.tutB0="id44",oImageIds.tutB1="id45",oImageIds.endCup0="id46",oImageIds.endCup1="id47",oImageIds.endCup2="id48",oImageIds.endPanel0B="id49",oImageIds.endPanel1="id50",oImageIds.endPanel2="id51",oImageIds.endPanel0A="id52",oImageIds.screenTitlePanel1="id53",oImageIds.map="id54",oImageIds.mapRaceCompletePanel="id55",oImageIds.mapSpeech="id56",oImageIds.mapCross0="id57",oImageIds.mapCross1="id58",oImageIds.vehicle140="id59",oImageIds.vehicle150="id60",oImageIds.vehicle160="id61",oImageIds.vehicle141="id62",oImageIds.vehicle151="id63",oImageIds.vehicle161="id64",oImageIds.upgradePreview0="id65",oImageIds.upgradePreview1="id66",oImageIds.upgradePreview2="id67",oImageIds.uiCoin1="id68",oImageIds.logo0="id69",oImageIds.logo1="id70",oImageIds.logo2="id71",oImageIds.logo3="id72",oImageIds.logo4="id73",oImageIds.logo5="id74",oImageIds.acceptChallengeBg="id75",oImageIds.makeChallengeBg="id76",oImageIds.orangeCharBg0="id77",oImageIds.orangeCharBg1="id78",oImageIds.soloPointer="id79",oImageIds.areYouSurePanel="id80",oImageIds.tournamentBut="id0",oImageIds.tournamentButOver="id1",oImageIds.quickGameBut="id2",oImageIds.quickGameButOver="id3",oImageIds.upgradeBut="id4",oImageIds.upgradeButOver="id5",oImageIds.infoBut="id6",oImageIds.infoButOver="id7",oImageIds.muteBut1="id8",oImageIds.muteBut1Over="id9",oImageIds.muteBut0="id10",oImageIds.muteBut0Over="id11",oImageIds.backBut="id12",oImageIds.backButOver="id13",oImageIds.playBut="id14",oImageIds.playButOver="id15",oImageIds.quitBut="id16",oImageIds.quitButOver="id17",oImageIds.pauseBut="id18",oImageIds.pauseButOver="id19",oImageIds.resetBut="id20",oImageIds.resetButOver="id21",oImageIds.char0But="id22",oImageIds.char0ButOver="id23",oImageIds.char0ButGrey="id24",oImageIds.char1But="id25",oImageIds.char1ButOver="id26",oImageIds.char1ButGrey="id27",oImageIds.char2But="id28",oImageIds.char2ButOver="id29",oImageIds.char2ButGrey="id30",oImageIds.char3But="id31",oImageIds.char3ButOver="id32",oImageIds.char3ButGrey="id33",oImageIds.char4But="id34",oImageIds.char4ButOver="id35",oImageIds.char4ButGrey="id36",oImageIds.char5But="id37",oImageIds.char5ButOver="id38",oImageIds.char5ButGrey="id39",oImageIds.char6But="id40",oImageIds.char6ButOver="id41",oImageIds.char6ButGrey="id42",oImageIds.char7But="id43",oImageIds.char7ButOver="id44",oImageIds.char7ButGrey="id45",oImageIds.char8But="id46",oImageIds.char8ButOver="id47",oImageIds.char8ButGrey="id48",oImageIds.char9But="id49",oImageIds.char9ButOver="id50",oImageIds.char9ButGrey="id51",oImageIds.char10But="id52",oImageIds.char10ButOver="id53",oImageIds.char10ButGrey="id54",oImageIds.char11But="id55",oImageIds.char11ButOver="id56",oImageIds.char11ButGrey="id57",oImageIds.char12But="id58",oImageIds.char12ButOver="id59",oImageIds.char12ButGrey="id60",oImageIds.char13But="id61",oImageIds.char13ButOver="id62",oImageIds.char13ButGrey="id63",oImageIds.upgrade0But="id64",oImageIds.upgrade0ButOver="id65",oImageIds.upgrade0ButGrey="id66",oImageIds.upgrade1But="id67",oImageIds.upgrade1ButOver="id68",oImageIds.upgrade1ButGrey="id69",oImageIds.upgrade2But="id70",oImageIds.upgrade2ButOver="id71",oImageIds.upgrade2ButGrey="id72",oImageIds.quitBut="id73",oImageIds.quitButOver="id74",oImageIds.upgrade30But="id75",oImageIds.upgrade30ButOver="id76",oImageIds.upgrade30ButGrey="id77",oImageIds.upgrade40But="id78",oImageIds.upgrade40ButOver="id79",oImageIds.upgrade40ButGrey="id80",oImageIds.upgrade50But="id81",oImageIds.upgrade50ButOver="id82",oImageIds.upgrade50ButGrey="id83",oImageIds.upgrade31But="id84",oImageIds.upgrade31ButOver="id85",oImageIds.upgrade31ButGrey="id86",oImageIds.upgrade41But="id87",oImageIds.upgrade41ButOver="id88",oImageIds.upgrade41ButGrey="id89",oImageIds.upgrade51But="id90",oImageIds.upgrade51ButOver="id91",oImageIds.upgrade51ButGrey="id92",oImageIds.upgrade6But="id93",oImageIds.upgrade6ButOver="id94",oImageIds.upgrade6ButGrey="id95",oImageIds.upgrade7But="id96",oImageIds.upgrade7ButOver="id97",oImageIds.upgrade7ButGrey="id98",oImageIds.upgrade8But="id99",oImageIds.upgrade8ButOver="id100",oImageIds.upgrade8ButGrey="id101",oImageIds.mapRaceBut="id102",oImageIds.mapRaceButOver="id103",oImageIds.copyLinkBut="id104",oImageIds.copyLinkButOver="id105",oImageIds.retryBut="id106",oImageIds.retryButOver="id107",oImageIds.yesBut="id108",oImageIds.yesButOver="id109",oImageIds.noBut="id110",oImageIds.noButOver="id111",oImageIds.titleLogo="id0",oImageIds.bgPanel="id1",assetLib.onReady(initSplash),gameState="load",previousTime=(new Date).getTime(),updateLoaderEvent()}function resizeCanvas(){var a,t,e,i=window.innerWidth,s=window.innerHeight;switch(canvas.height=s,canvas.width=i,canvas.style.width=i+"px",canvas.style.height=s+"px",canvasScale=1,i<s?(a=maxWidth,maxHeight,t=minWidth,e=minHeight):(a=maxHeight,maxWidth,t=minHeight,e=minWidth),canvas.width/canvas.height<t/e?(canvas.width=a,canvas.height=a*(s/i),canvasScale=a/i):(canvas.height=e,canvas.width=e*(i/s),canvasScale=e/s),ground&&(ground.horizonStretchWidth=Math.max(canvas.width,ground.oHorizonImgData.img.width),ground.horizonX0=0,ground.horizonX1=-ground.horizonStretchWidth),gameState){case"game":userInput.removeHitArea("steerLeft"),userInput.removeHitArea("steerRight"),userInput.removeHitArea("steerTouch"),isMobile&&(userInput.addHitArea("steerLeft",butEventHandler,{multiTouch:!0},"rect",{aRect:[0,60,canvas.width/2,canvas.height]},!0),userInput.addHitArea("steerRight",butEventHandler,{multiTouch:!0},"rect",{aRect:[canvas.width/2,60,canvas.width,canvas.height]},!0));break;case"charSelect":setCharSelectButs();break;case"upgrades":setUpgradeButs()}this.prevCanvasWidth=i,this.prevCanvasHeight=s,window.scrollTo(0,0)}function playSound(a){1==audioType&&sound.play(a)}function toggleMute(){muted=!muted,1==audioType?muted?(Howler.mute(!0),music.pause()):(Howler.mute(!1),playMusic(),"game"==gameState?music.volume(1):music.volume(.5)):2==audioType&&(muted?music.pause():playMusic())}